
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>tidypandas.tidyframe_class &#8212; tidypandas  documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="../../index.html">
<p class="title">tidypandas</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../using_tidypandas.html">
  Using
  <code class="docutils literal notranslate">
   <span class="pre">
    tidypandas
   </span>
  </code>
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../tour.html">
  A tour of
  <code class="docutils literal notranslate">
   <span class="pre">
    tidypandas
   </span>
  </code>
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../autoapi/index.html">
  API Reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../changelog.html">
  Changelog
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <h1>Source code for tidypandas.tidyframe_class</h1><div class="highlight"><pre>
<span></span><span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># This file is a part of tidypandas python package</span>
<span class="c1"># Find the dev version here: https://github.com/talegari/tidypandas</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">copy</span> <span class="k">as</span> <span class="nn">util_copy</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">importlib</span>
<span class="kn">import</span> <span class="nn">string</span> <span class="k">as</span> <span class="nn">string</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pandas.io.formats</span> <span class="kn">import</span> <span class="nb">format</span> <span class="k">as</span> <span class="n">fmt</span>
<span class="kn">from</span> <span class="nn">pandas._config</span> <span class="kn">import</span> <span class="n">get_option</span>
<span class="kn">from</span> <span class="nn">collections_extended</span> <span class="kn">import</span> <span class="n">setlist</span>

<span class="kn">import</span> <span class="nn">pandas.api.types</span> <span class="k">as</span> <span class="nn">dtypes</span>
<span class="kn">from</span> <span class="nn">tidypandas.tidy_utils</span> <span class="kn">import</span> <span class="n">simplify</span><span class="p">,</span> <span class="n">is_simple</span>
<span class="kn">from</span> <span class="nn">tidypandas._unexported_utils</span> <span class="kn">import</span> <span class="p">(</span>
                                            <span class="n">_is_kwargable</span><span class="p">,</span>
                                            <span class="n">_is_valid_colname</span><span class="p">,</span>
                                            <span class="n">_is_string_or_string_list</span><span class="p">,</span>
                                            <span class="n">_enlist</span><span class="p">,</span>
                                            <span class="n">_get_unique_names</span><span class="p">,</span>
                                            <span class="n">_is_unique_list</span><span class="p">,</span>
                                            <span class="n">_get_dtype_dict</span><span class="p">,</span>
                                            <span class="n">_generate_new_string</span><span class="p">,</span>
                                            <span class="n">_coerce_series</span><span class="p">,</span>
                                            <span class="n">_coerce_pdf</span><span class="p">,</span>
                                            <span class="n">_is_nested</span><span class="p">,</span>
                                            <span class="n">_flatten_strings</span><span class="p">,</span>
                                            <span class="n">_nested_is_unique</span>
                                        <span class="p">)</span>
<span class="kn">import</span> <span class="nn">tidypandas.format</span> <span class="k">as</span> <span class="nn">tidy_fmt</span>


<div class="viewcode-block" id="tidyframe"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe">[docs]</a><span class="k">class</span> <span class="nc">tidyframe</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    tidyframe class</span>
<span class="sd">    A tidy pandas dataframe is a wrapper over &#39;simple&#39; pandas </span>
<span class="sd">    DataFrame object with method similar to tidyverse.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    </span>
<span class="sd">    A pandas dataframe is said to be &#39;simple&#39; if:</span>
<span class="sd">    </span>
<span class="sd">    1. Column names (x.columns) are an unnamed pd.Index object of unique </span>
<span class="sd">       strings.</span>
<span class="sd">    2. Row names (x.index) are an unnamed pd.RangeIndex object with start = 0</span>
<span class="sd">       and step = 1.</span>
<span class="sd">    </span>
<span class="sd">    * Methods constitute a grammar of data manipulation mostly returning a </span>
<span class="sd">      tidy dataframe as a result. </span>
<span class="sd">    * When a method returns a tidy dataframe, it returns a copy and not </span>
<span class="sd">      a view, unless copy is set to False.</span>
<span class="sd">    * Methods &#39;to_pandas&#39; and &#39;to_series&#39; convert into pandas dataframe or </span>
<span class="sd">      series.</span>
<span class="sd">    * The only attribute of the class is the underlying pandas dataframe. This </span>
<span class="sd">      cannot be accessed by the user. Please use &#39;to_pandas&#39; method to obtain </span>
<span class="sd">      a copy of the underlying pandas dataframe.</span>
<span class="sd">    </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    nrow: Number of rows</span>
<span class="sd">    ncol: Number of columns</span>
<span class="sd">    shape(alias dim): tuple of number of rows and number of columns</span>
<span class="sd">    colnames: list of column names</span>
<span class="sd">    </span>
<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    init</span>
<span class="sd">        Creates a tidy dataframe from a &#39;simple&#39; pandas dataframe</span>
<span class="sd">        </span>
<span class="sd">    &#39;to&#39; methods:</span>
<span class="sd">        to_pandas</span>
<span class="sd">            Returns the underlying pandas dataframe</span>
<span class="sd">        to_series</span>
<span class="sd">            Returns selected column as pandas series</span>
<span class="sd">    </span>
<span class="sd">    &#39;pipe&#39; methods:</span>
<span class="sd">        pipe    </span>
<span class="sd">            A pipe method for tidy dataframe</span>
<span class="sd">        pipe_tee</span>
<span class="sd">            A pipe method called for side-effect and returns the input</span>

<span class="sd">    &#39;basic&#39; methods:</span>
<span class="sd">        select</span>
<span class="sd">            Returns a dataframe with selected columns</span>
<span class="sd">        arrange</span>
<span class="sd">            Returns a dataframe after sorting rows</span>
<span class="sd">        slice</span>
<span class="sd">            Returns a dataframe to subset by row numbers</span>
<span class="sd">        distinct</span>
<span class="sd">            Returns a distinct rows defined by selected columns</span>
<span class="sd">        filter</span>
<span class="sd">            Returns a dataframe with rows selected by some criteria</span>
<span class="sd">        mutate</span>
<span class="sd">            Returns a dataframe by adding or changing a few columns</span>
<span class="sd">        summarise (alias: summarize)</span>
<span class="sd">            Returns a dataframe after aggregating over selected columns</span>
<span class="sd">        </span>
<span class="sd">    &#39;count&#39; methods:</span>
<span class="sd">        count</span>
<span class="sd">            Returns a dataframe after counting over selected columns</span>
<span class="sd">        add_count</span>
<span class="sd">            Returns a dataframe by adding a new count column to input</span>
<span class="sd">            </span>
<span class="sd">    &#39;pivot&#39; methods:</span>
<span class="sd">        pivot_wider</span>
<span class="sd">            Returns a dataframe by converting from long to wide format</span>
<span class="sd">        pivot_longer</span>
<span class="sd">            Returns a dataframe by converting from wide to long format</span>
<span class="sd">            </span>
<span class="sd">    &#39;missing value&#39; methods:</span>
<span class="sd">        drop_na</span>
<span class="sd">            Returns a dataframe by dropping rows which have mssing values in</span>
<span class="sd">            selected columns</span>
<span class="sd">        replace_na</span>
<span class="sd">            Returns a dataframe by replacing missing values in selected columns</span>
<span class="sd">        fill_na</span>
<span class="sd">            Returns a dataframe by filling missing values from up, down or </span>
<span class="sd">            both directions for selected columns</span>
<span class="sd">    &#39;string&#39; methods:</span>
<span class="sd">        separate</span>
<span class="sd">            Returns a dataframe by splitting a string column into multiple </span>
<span class="sd">            columns</span>
<span class="sd">        unite</span>
<span class="sd">            Returns a dataframe by combining multiple string columns </span>
<span class="sd">        separate_rows</span>
<span class="sd">            Returns a dataframe by exploding a string column</span>
<span class="sd">    &#39;slice&#39; extensions:</span>
<span class="sd">        slice_head</span>
<span class="sd">            Returns a dataframe with top few rows of the input</span>
<span class="sd">        slice_tail</span>
<span class="sd">            Returns a dataframe with last few rows of the input</span>
<span class="sd">        slice_max</span>
<span class="sd">            Returns a dataframe with few rows corrsponding to maximum values of</span>
<span class="sd">            some columns</span>
<span class="sd">        slice_min</span>
<span class="sd">            Returns a dataframe with few rows corrsponding to maximum values of</span>
<span class="sd">            some columns</span>
<span class="sd">        slice_sample</span>
<span class="sd">            Returns a dataframe with a sample of rows</span>
<span class="sd">    </span>
<span class="sd">    &#39;join&#39; methods:</span>
<span class="sd">        join, inner_join, outer_join, left_join, right_join, anti_join:</span>
<span class="sd">            Returns a joined dataframe of a pair of dataframes</span>
<span class="sd">    &#39;set operations&#39; methods:</span>
<span class="sd">        union, intersection, setdiff:</span>
<span class="sd">            Returns a dataframe after set like operations over a pair of </span>
<span class="sd">            dataframes</span>
<span class="sd">    &#39;bind&#39; methods:</span>
<span class="sd">        rbind, cbind:</span>
<span class="sd">            Returns a dataframe by rowwise or column wise binding of a pair of </span>
<span class="sd">            dataframes</span>
<span class="sd">    </span>
<span class="sd">    &#39;misc&#39; methods:</span>
<span class="sd">        add_row_number:</span>
<span class="sd">            Returns a dataframe with rowids added</span>
<span class="sd">        add_group_number:</span>
<span class="sd">            Returns a dataframe with group ids added</span>
<span class="sd">    </span>
<span class="sd">    &#39;nest&#39; methods:</span>
<span class="sd">        nest_by:</span>
<span class="sd">            Returns a dataframe with nesting by the groupby columns</span>
<span class="sd">        nest:</span>
<span class="sd">            Returns a dataframe with nesting the columns</span>
<span class="sd">        unnest:</span>
<span class="sd">            Returns the unnested dataframe</span>
<span class="sd">            </span>
<span class="sd">    &#39;expand and complete&#39; methods:</span>
<span class="sd">        expand:</span>
<span class="sd">            Returns a dataframe with all combinations of columns</span>
<span class="sd">        complete:</span>
<span class="sd">            Returns a dataframe with combination of expand + full_join</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="c1">##########################################################################</span>
    <span class="c1"># init</span>
    <span class="c1">##########################################################################</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        init</span>
<span class="sd">        Create tidy dataframe from a &#39;simple&#39; ungrouped pandas dataframe</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : &#39;simple&#39; pandas dataframe</span>
<span class="sd">        check : bool, Default is True</span>
<span class="sd">            Whether to check if the input pandas dataframe is &#39;simple&#39;</span>
<span class="sd">        copy: bool, Default is True</span>
<span class="sd">            Whether the tidyframe object to be created should refer </span>
<span class="sd">            to a copy of the input pandas dataframe or the input itself</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. A pandas dataframe is said to be &#39;simple&#39; if:</span>
<span class="sd">            a. Column names (x.columns) are an unnamed pd.Index object of </span>
<span class="sd">               unique strings.</span>
<span class="sd">            b. Row names (x.index) are an unnamed pd.RangeIndex object with </span>
<span class="sd">               start = 0 and step = 1.</span>
<span class="sd">        2. Unless you are sure, in general usage:</span>
<span class="sd">            a. set arg &#39;check&#39; to `True`.</span>
<span class="sd">            b. set arg `copy` to `True`.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # create dataframe using dictionary</span>
<span class="sd">        &gt;&gt;&gt; df = tidyframe({&#39;one&#39;: [1,2,3], &#39;two&#39;: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]})</span>
<span class="sd">        &gt;&gt;&gt; df</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="n">check</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;check&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">copy</span>  <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;copy&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">check</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;check&#39; should be a bool&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">copy</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;copy&#39; should be a bool&quot;</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="n">check</span><span class="p">:</span>
            <span class="n">simple_flag</span> <span class="o">=</span> <span class="n">is_simple</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">simple_flag</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">((</span><span class="s2">&quot;Input pandas dataframe could not be simplified&quot;</span>
                                     <span class="s2">&quot; See to above warnings.&quot;</span>
                                    <span class="p">))</span>
            
        <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>                       
            <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">return</span> <span class="kc">None</span>
    
    <span class="c1">##########################################################################</span>
    <span class="c1"># repr</span>
    <span class="c1">##########################################################################</span>

<div class="viewcode-block" id="tidyframe.__repr__"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.__repr__">[docs]</a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a string representation for a particular DataFrame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if self._info_repr():</span>
        <span class="c1">#     buf = StringIO()</span>
        <span class="c1">#     self.info(buf=buf)</span>
        <span class="c1">#     return buf.getvalue()</span>

        <span class="c1"># repr_params = fmt.get_dataframe_repr_params()</span>
        <span class="c1"># return self.to_string(**repr_params)</span>

        <span class="c1">## to support pandas version prior to 1.4.0 avoiding get_dataframe_repr_params()</span>
        <span class="kn">from</span> <span class="nn">pandas.io.formats</span> <span class="kn">import</span> <span class="n">console</span>

        <span class="k">if</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.expand_frame_repr&quot;</span><span class="p">):</span>
            <span class="n">line_width</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">console</span><span class="o">.</span><span class="n">get_console_size</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">line_width</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">repr_params</span> <span class="o">=</span>  <span class="p">{</span>
            <span class="s2">&quot;max_rows&quot;</span><span class="p">:</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.max_rows&quot;</span><span class="p">),</span>
            <span class="s2">&quot;min_rows&quot;</span><span class="p">:</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.min_rows&quot;</span><span class="p">),</span>
            <span class="s2">&quot;max_cols&quot;</span><span class="p">:</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.max_columns&quot;</span><span class="p">),</span>
            <span class="s2">&quot;max_colwidth&quot;</span><span class="p">:</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.max_colwidth&quot;</span><span class="p">),</span>
            <span class="s2">&quot;show_dimensions&quot;</span><span class="p">:</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.show_dimensions&quot;</span><span class="p">),</span>
            <span class="s2">&quot;line_width&quot;</span><span class="p">:</span> <span class="n">line_width</span><span class="p">,</span>
        <span class="p">}</span>



        <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrow</span>
        <span class="n">nc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncol</span>

        <span class="n">header_line</span>   <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;# A tidy dataframe: </span><span class="si">{</span><span class="n">nr</span><span class="si">}</span><span class="s2"> X </span><span class="si">{</span><span class="n">nc</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">option_context</span>

        <span class="k">with</span> <span class="n">option_context</span><span class="p">(</span><span class="s2">&quot;display.max_colwidth&quot;</span><span class="p">,</span><span class="n">repr_params</span><span class="p">[</span><span class="s2">&quot;max_colwidth&quot;</span><span class="p">]):</span>
            <span class="n">row_truncated</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">show_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
            <span class="k">if</span> <span class="n">repr_params</span><span class="p">[</span><span class="s2">&quot;min_rows&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">repr_params</span><span class="p">[</span><span class="s2">&quot;min_rows&quot;</span><span class="p">]:</span>
                <span class="n">row_truncated</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">show_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">repr_params</span><span class="p">[</span><span class="s2">&quot;min_rows&quot;</span><span class="p">],</span> <span class="p">:]</span>

            <span class="n">formatter</span> <span class="o">=</span> <span class="n">tidy_fmt</span><span class="o">.</span><span class="n">TidyDataFrameFormatter</span><span class="p">(</span>
                <span class="c1"># self.__data,</span>
                <span class="n">show_frame</span><span class="p">,</span>
                <span class="c1"># min_rows=repr_params[&quot;min_rows&quot;],</span>
                <span class="n">max_rows</span><span class="o">=</span><span class="n">repr_params</span><span class="p">[</span><span class="s2">&quot;max_rows&quot;</span><span class="p">],</span>
                <span class="n">max_cols</span><span class="o">=</span><span class="n">repr_params</span><span class="p">[</span><span class="s2">&quot;max_cols&quot;</span><span class="p">],</span>
                <span class="c1"># show_dimensions=repr_params[&quot;show_dimensions&quot;]</span>
            <span class="p">)</span>
            <span class="n">formatted_str</span> <span class="o">=</span> <span class="n">header_line</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">fmt</span><span class="o">.</span><span class="n">DataFrameRenderer</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>\
                                               <span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">line_width</span><span class="o">=</span><span class="n">repr_params</span><span class="p">[</span><span class="s2">&quot;line_width&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">row_truncated</span><span class="p">:</span>
                <span class="n">footer_str</span> <span class="o">=</span> <span class="s2">&quot;#... with </span><span class="si">{}</span><span class="s2"> more rows&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">repr_params</span><span class="p">[</span><span class="s2">&quot;min_rows&quot;</span><span class="p">])</span>
                <span class="n">formatted_str</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">footer_str</span>

            <span class="n">max_footer_cols_print</span> <span class="o">=</span> <span class="mi">100</span>
            <span class="k">if</span> <span class="n">formatter</span><span class="o">.</span><span class="n">is_truncated_horizontally</span> <span class="ow">and</span> <span class="n">formatter</span><span class="o">.</span><span class="n">tr_col_num</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncol</span><span class="p">:</span>
                <span class="n">more_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncol</span> <span class="o">-</span> <span class="n">formatter</span><span class="o">.</span><span class="n">tr_col_num</span>
                <span class="n">footer_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> &lt;</span><span class="si">{}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">[</span><span class="n">cname</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> 
                                  <span class="k">for</span> <span class="n">cname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">[</span><span class="n">formatter</span><span class="o">.</span><span class="n">tr_col_num</span><span class="p">:]</span>
                              <span class="p">]</span>
                <span class="n">footer_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> more columns: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">more_cols</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">footer_cols</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">max_footer_cols_print</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">more_cols</span> <span class="o">&gt;</span> <span class="n">max_footer_cols_print</span><span class="p">:</span>
                    <span class="n">footer_str</span> <span class="o">+=</span> <span class="s2">&quot;...&quot;</span>
                <span class="k">if</span> <span class="n">row_truncated</span><span class="p">:</span>
                    <span class="n">formatted_str</span> <span class="o">+=</span> <span class="s2">&quot;, and &quot;</span> <span class="o">+</span> <span class="n">footer_str</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">formatted_str</span> <span class="o">+=</span> <span class="s2">&quot;#... with &quot;</span> <span class="o">+</span> <span class="n">footer_str</span>
            <span class="k">return</span> <span class="n">formatted_str</span></div>


<div class="viewcode-block" id="tidyframe._repr_html_"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe._repr_html_">[docs]</a>    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a html representation for a particular DataFrame.</span>
<span class="sd">        Mainly for IPython notebook.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if self._info_repr():</span>
        <span class="c1">#     buf = StringIO()</span>
        <span class="c1">#     self.info(buf=buf)</span>
        <span class="c1">#     # need to escape the &lt;class&gt;, should be the first line.</span>
        <span class="c1">#     val = buf.getvalue().replace(&quot;&lt;&quot;, r&quot;&amp;lt;&quot;, 1)</span>
        <span class="c1">#     val = val.replace(&quot;&gt;&quot;, r&quot;&amp;gt;&quot;, 1)</span>
        <span class="c1">#     return &quot;&lt;pre&gt;&quot; + val + &quot;&lt;/pre&gt;&quot;</span>
        
        <span class="k">if</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.notebook_repr_html&quot;</span><span class="p">):</span>
            <span class="n">max_rows</span> <span class="o">=</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.max_rows&quot;</span><span class="p">)</span>
            <span class="n">min_rows</span> <span class="o">=</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.min_rows&quot;</span><span class="p">)</span>
            <span class="n">max_cols</span> <span class="o">=</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.max_columns&quot;</span><span class="p">)</span>
            <span class="n">show_dimensions</span> <span class="o">=</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.show_dimensions&quot;</span><span class="p">)</span>

            <span class="n">formatter</span> <span class="o">=</span> <span class="n">tidy_fmt</span><span class="o">.</span><span class="n">TidyDataFrameFormatter</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">,</span>
                <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">col_space</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">na_rep</span><span class="o">=</span><span class="s2">&quot;&lt;NA&gt;&quot;</span><span class="p">,</span>
                <span class="n">formatters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">float_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">sparsify</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">justify</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">index_names</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">bold_rows</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">escape</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">max_rows</span><span class="o">=</span><span class="n">max_rows</span><span class="p">,</span>
                <span class="n">min_rows</span><span class="o">=</span><span class="n">min_rows</span><span class="p">,</span>
                <span class="n">max_cols</span><span class="o">=</span><span class="n">max_cols</span><span class="p">,</span>
                <span class="n">show_dimensions</span><span class="o">=</span><span class="n">show_dimensions</span><span class="p">,</span>
                <span class="n">decimal</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">tidy_fmt</span><span class="o">.</span><span class="n">TidyDataFrameRenderer</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">notebook</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="tidyframe.show"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="c1"># def is_interactive():</span>
        <span class="c1">#     import __main__ as main</span>
        <span class="c1">#     return not hasattr(main, &#39;__file__&#39;)</span>
        <span class="k">def</span> <span class="nf">in_notebook</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">IPython</span> <span class="kn">import</span> <span class="n">get_ipython</span>
                <span class="k">if</span> <span class="s1">&#39;IPKernelApp&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">True</span>


        <span class="n">max_rows</span> <span class="o">=</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.max_rows&quot;</span><span class="p">)</span>
        <span class="n">min_rows</span> <span class="o">=</span> <span class="n">get_option</span><span class="p">(</span><span class="s2">&quot;display.min_rows&quot;</span><span class="p">)</span>

        <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.min_rows&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_rows&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

        
        <span class="k">if</span> <span class="n">in_notebook</span><span class="p">():</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">_repr_html_</span><span class="p">()</span>
            <span class="kn">from</span> <span class="nn">IPython</span> <span class="kn">import</span> <span class="n">display</span>
            <span class="n">display</span><span class="o">.</span><span class="n">display_html</span><span class="p">(</span><span class="n">display</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

        <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.min_rows&quot;</span><span class="p">,</span> <span class="n">min_rows</span><span class="p">)</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_rows&quot;</span><span class="p">,</span> <span class="n">max_rows</span><span class="p">)</span></div>


<div class="viewcode-block" id="tidyframe.glimpse"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.glimpse">[docs]</a>    <span class="k">def</span> <span class="nf">glimpse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">get_terminal_size</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">get_terminal_size</span><span class="p">()</span>

        <span class="n">nrow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrow</span>
        <span class="n">ncol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncol</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Rows: </span><span class="si">{</span><span class="n">nrow</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Columns: </span><span class="si">{</span><span class="n">ncol</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>

        <span class="n">col_strs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">n_ljust</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">t_ljust</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">all_dtypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">dtypes</span>
        <span class="k">for</span> <span class="n">acol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">]:</span>
            <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acol</span><span class="p">)</span>
            <span class="n">n_ljust</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">n_ljust</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">dtypes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;</span><span class="si">{</span><span class="n">all_dtypes</span><span class="p">[</span><span class="n">acol</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&gt;&#39;</span><span class="p">)</span>
            <span class="n">t_ljust</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">t_ljust</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtypes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

        <span class="n">max_values_to_glimpse</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">float_vals_precision</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">):</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">max_values_to_glimpse</span><span class="p">,</span> <span class="n">name</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dtype</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;float&quot;</span><span class="p">:</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">float_vals_precision</span><span class="p">)</span>
            <span class="n">val_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">vals</span><span class="p">)))</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">val_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">w</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="n">n_ljust</span><span class="o">-</span><span class="n">t_ljust</span> <span class="ow">or</span> <span class="n">nrow</span> <span class="o">&gt;</span> <span class="n">max_values_to_glimpse</span><span class="p">:</span>
                <span class="n">val_str</span> <span class="o">=</span> <span class="n">val_str</span><span class="p">[</span><span class="mi">0</span><span class="p">:(</span><span class="n">w</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="n">n_ljust</span><span class="o">-</span><span class="n">t_ljust</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;...&quot;</span>
            <span class="n">res_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">n_ljust</span><span class="p">)</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">dtype</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">t_ljust</span><span class="p">)</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">val_str</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res_str</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ncol</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">:</span>
            <span class="n">footer</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">more columns: </span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">[</span><span class="n">n</span><span class="p">:(</span><span class="n">n</span><span class="o">+</span><span class="mi">50</span><span class="p">)])</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="k">if</span> <span class="n">ncol</span> <span class="o">&gt;=</span> <span class="n">n</span><span class="o">+</span><span class="mi">50</span><span class="p">:</span>
                <span class="n">footer</span> <span class="o">+=</span> <span class="s2">&quot;...&quot;</span>

            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">footer</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">res</span><span class="p">))</span></div>
            
    <span class="c1">##########################################################################</span>
    <span class="c1"># to_pandas methods</span>
    <span class="c1">##########################################################################</span>
    
<div class="viewcode-block" id="tidyframe.to_pandas"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.to_pandas">[docs]</a>    <span class="k">def</span> <span class="nf">to_pandas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return copy of underlying pandas dataframe</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        copy: bool, default is True</span>
<span class="sd">            Whether to return a copy of pandas dataframe held by</span>
<span class="sd">            tidyframe object or to return the underlying</span>
<span class="sd">            pandas dataframe itself</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pandas dataframe</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.to_pandas()</span>
<span class="sd">        &gt;&gt;&gt; # check whether the dataframes are same</span>
<span class="sd">        &gt;&gt;&gt; penguins.equals(penguins_tidy.to_pandas())</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">copy</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;copy&#39; should be a bool&quot;</span>
        <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
            
        <span class="k">return</span> <span class="n">res</span></div>
    
    <span class="c1">##########################################################################</span>
    <span class="c1"># to_series or pull</span>
    <span class="c1">##########################################################################</span>
<div class="viewcode-block" id="tidyframe.pull"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.pull">[docs]</a>    <span class="k">def</span> <span class="nf">pull</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        pull (aka to_series)</span>
<span class="sd">        Returns a copy of column as pandas series</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        column_name : str or None</span>
<span class="sd">            Name of the column to be returned as pandas series. When there is</span>
<span class="sd">            only one column, it can be None.</span>
<span class="sd">        copy: bool, default is True</span>
<span class="sd">            Whether to return a copy of the pandas series object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pandas series</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.pull(&quot;species&quot;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="n">column_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;column_name&#39;should be a string&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncol</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>\
                <span class="s2">&quot;Column to pull should be specified&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">column_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">column_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="k">assert</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> \
            <span class="s2">&quot;arg &#39;column_name&#39; should be an existing column name&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">copy</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;copy&#39; should be a bool&quot;</span>
        
        <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">res</span></div>
    
    <span class="n">to_series</span> <span class="o">=</span> <span class="n">pull</span>
    
    <span class="c1">##########################################################################</span>
    <span class="c1"># pipe methods</span>
    <span class="c1">##########################################################################</span>
    
    <span class="c1"># pipe</span>
<div class="viewcode-block" id="tidyframe.pipe"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.pipe">[docs]</a>    <span class="k">def</span> <span class="nf">pipe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns func(self)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func : callable</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Depends on the return type of `func`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="n">callable</span><span class="p">(</span><span class="n">func</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;func&#39; should be callable&quot;</span>
        
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
    
    <span class="c1"># pipe_tee</span>
<div class="viewcode-block" id="tidyframe.pipe_tee"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.pipe_tee">[docs]</a>    <span class="k">def</span> <span class="nf">pipe_tee</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        pipe for side-effect</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func : callable</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="n">callable</span><span class="p">(</span><span class="n">func</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;func&#39; should be callable&quot;</span>
            
        <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="c1"># side-effect</span>
        
        <span class="k">return</span> <span class="bp">self</span></div>
    
    
    <span class="c1">##########################################################################</span>
    <span class="c1"># attributes</span>
    <span class="c1">##########################################################################</span>
            
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nrow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ncol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">shape</span>
      
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">shape</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">colnames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    
    <span class="c1">##########################################################################</span>
    <span class="c1"># summarizers -- skim, glimpse</span>
    <span class="c1">##########################################################################</span>
    
<div class="viewcode-block" id="tidyframe.skim"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.skim">[docs]</a>    <span class="k">def</span> <span class="nf">skim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_self</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Skim the tidy dataframe.</span>
<span class="sd">        Provides a meaningful summary of the dataframe</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        return_self : bool (default is False)</span>
<span class="sd">            Whether to return the input</span>
<span class="sd">            This is helpful while piping the input to next method while skim is</span>
<span class="sd">            a side-effect</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None when return_self is False, input otherwise</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. skim is done via &#39;skimpy&#39; package is expected to be installed.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">find_spec</span><span class="p">(</span><span class="s2">&quot;skimpy&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">skimpy</span> <span class="kn">import</span> <span class="n">skim</span>
            <span class="n">skim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;skim output is not printed. Please install skimpy package.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">return_self</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>
        
    <span class="c1">##########################################################################</span>
    <span class="c1"># validators</span>
    <span class="c1">##########################################################################</span>
    
<div class="viewcode-block" id="tidyframe._validate_by"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe._validate_by">[docs]</a>    <span class="k">def</span> <span class="nf">_validate_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">by</span><span class="p">):</span>
        
        <span class="k">assert</span> <span class="n">_is_string_or_string_list</span><span class="p">(</span><span class="n">by</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;by&#39; should be a string or a list of strings&quot;</span>
            
        <span class="n">by</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
        
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">by</span><span class="p">))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">by</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;by&#39; should have unique strings&quot;</span>
        
        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span><span class="o">.</span><span class="n">issuperset</span><span class="p">(</span><span class="n">by</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;by&#39; should contain valid column names&quot;</span>
            
        <span class="k">return</span> <span class="kc">None</span></div>
    
<div class="viewcode-block" id="tidyframe._validate_column_names"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe._validate_column_names">[docs]</a>    <span class="k">def</span> <span class="nf">_validate_column_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_names</span><span class="p">):</span>
        
        <span class="k">assert</span> <span class="n">_is_string_or_string_list</span><span class="p">(</span><span class="n">column_names</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;column_names&#39; should be a string or a list of strings&quot;</span>
            
        <span class="n">column_names</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span>
        
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">column_names</span><span class="p">))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">column_names</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;column_names&#39; should have unique strings&quot;</span>
        
        <span class="n">cols_not_found</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span><span class="o">.</span><span class="n">issuperset</span><span class="p">(</span><span class="n">column_names</span><span class="p">),</span>\
            <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;arg &#39;column_names&#39; should contain valid column names&quot;</span>
             <span class="sa">f</span><span class="s2">&quot;These column(s) do not exist: </span><span class="si">{</span><span class="n">cols_not_found</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        
        <span class="k">return</span> <span class="kc">None</span></div>
      
<div class="viewcode-block" id="tidyframe._clean_order_by"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe._clean_order_by">[docs]</a>    <span class="k">def</span> <span class="nf">_clean_order_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order_by</span><span class="p">):</span>
        
        <span class="n">cns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">order_by</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">order_by</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">order_by</span><span class="p">)</span>
            
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">order_by</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)),</span>\
            <span class="s2">&quot;&#39;order_by&#39; should be a string, list or a tuple&quot;</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">order_by</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">order_by</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">order_by</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">order_by</span><span class="p">):</span>           
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">order_by</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">order_by</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;asc&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">((</span><span class="s2">&quot;An element of &#39;order_by&#39; should be a list &quot;</span>
                                 <span class="s2">&quot;or a tuple or a string&quot;</span><span class="p">))</span>
        
        <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">order_by</span><span class="p">):</span>
            <span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">),</span>\
                <span class="s2">&quot;An element of &#39;order_by&#39; should have length between 1 and 2&quot;</span>
            <span class="k">assert</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">cns</span><span class="p">,</span>\
                <span class="sa">f</span><span class="s2">&quot;Non-existing column name provided in &#39;order_by&#39;. Input: </span><span class="si">{</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;asc&#39;</span><span class="p">)</span>
                <span class="n">order_by</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;asc&#39;</span>
            <span class="k">assert</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;asc&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">],</span>\
                <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ordering specification in &#39;order_by&#39; should be one among &quot;</span>
                 <span class="sa">f</span><span class="s2">&quot;(&#39;asc&#39;, &#39;desc&#39;). Input: </span><span class="si">{</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                 <span class="p">)</span>
            
        <span class="c1"># check for unique names</span>
        <span class="k">assert</span> <span class="n">_is_unique_list</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">order_by</span><span class="p">]),</span>\
            <span class="s2">&quot;Ordering columns should be unique&quot;</span>
        
        <span class="k">return</span> <span class="n">order_by</span></div>
    
    <span class="c1">##########################################################################</span>
    <span class="c1"># add_group_number</span>
    <span class="c1">##########################################################################</span>
<div class="viewcode-block" id="tidyframe.add_group_number"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.add_group_number">[docs]</a>    <span class="k">def</span> <span class="nf">add_group_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;group_number&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add a group number column to tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Name for the group number column</span>
<span class="sd">        by : str or list of strings</span>
<span class="sd">            Columns to group by</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. Row order is preserved.</span>
<span class="sd">        2. Column indicating group number is added as the first column </span>
<span class="sd">           (to the left).</span>
<span class="sd">        3. Number for the group is based on the first appearance of a</span>
<span class="sd">           group combination.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>

<span class="sd">        &gt;&gt;&gt; penguins_tidy.add_group_number(by = &#39;sex&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrow</span>
        <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>
        
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;name&#39; should be a string&quot;</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;&#39;name&#39; should not start with an underscore&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">cn</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;&#39;name&#39; should not be an existing column name.&quot;</span><span class="p">)</span>
          
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_by</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
        <span class="n">by</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
            
        <span class="n">group_order_frame</span> <span class="o">=</span> <span class="p">(</span>
               <span class="bp">self</span>
               <span class="o">.</span><span class="n">__data</span>
               <span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">by</span><span class="p">]</span>
               <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
               <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])})</span>
               <span class="p">)</span>
        
        <span class="n">row_name</span> <span class="o">=</span> <span class="n">_generate_new_string</span><span class="p">(</span><span class="n">cn</span> <span class="o">+</span> <span class="p">[</span><span class="n">name</span><span class="p">])</span>
        
        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                   <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">row_name</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])})</span>
                   <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">group_order_frame</span>
                          <span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="n">by</span>
                          <span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                          <span class="p">)</span>
                   <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="n">row_name</span><span class="p">)</span>
                   <span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">+</span> <span class="n">cn</span><span class="p">]</span>
                   <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                   <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></div>
    
    <span class="c1">##########################################################################</span>
    <span class="c1"># add_row_number</span>
    <span class="c1">##########################################################################</span>
<div class="viewcode-block" id="tidyframe.add_row_number"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.add_row_number">[docs]</a>    <span class="k">def</span> <span class="nf">add_row_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;row_number&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        add_row_number (aka rowid_to_column)</span>
<span class="sd">        Add a row number column to tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Name for the row number column</span>
<span class="sd">        by : str or list of strings</span>
<span class="sd">            Columns to group by</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. Row order is preserved.</span>
<span class="sd">        2. Column indicating row number is added as the first column </span>
<span class="sd">           (to the left).</span>
<span class="sd">        3. Alias: rowid_to_column</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>

<span class="sd">        &gt;&gt;&gt; penguins_tidy.add_row_number() # equivalently penguins_tidy.add_rowid()</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; # add row number per group in the order of appearance</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.add_row_number(by = &#39;sex&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrow</span>
        <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>
        
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;name&#39; should be a string&quot;</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;&#39;name&#39; should not start with an underscore&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">cn</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Expection</span><span class="p">(</span><span class="s2">&quot;&#39;name&#39; should not be an existing column name.&quot;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">by</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">po</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">name</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nr</span><span class="p">)})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">by</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_by</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
            
            <span class="n">grp_colname</span> <span class="o">=</span> <span class="n">_generate_new_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colnames</span> <span class="o">+</span> <span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_group_number</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="n">by</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">grp_colname</span><span class="p">)</span>
            <span class="n">po</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">po</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">grp_colname</span><span class="p">)</span><span class="o">.</span><span class="n">cumcount</span><span class="p">()</span>
            <span class="n">po</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">grp_colname</span><span class="p">],</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            
        <span class="n">name_col</span> <span class="o">=</span> <span class="n">po</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">po</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">name_col</span><span class="p">)</span> <span class="c1"># in-place</span>
        
        <span class="k">return</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">po</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></div>
    
    <span class="n">rowid_to_column</span> <span class="o">=</span> <span class="n">add_row_number</span>
    
    <span class="c1">##########################################################################</span>
    <span class="c1"># group_modify</span>
    <span class="c1">##########################################################################</span>
<div class="viewcode-block" id="tidyframe.group_modify"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.group_modify">[docs]</a>    <span class="k">def</span> <span class="nf">group_modify</span><span class="p">(</span><span class="bp">self</span>
                     <span class="p">,</span> <span class="n">func</span>
                     <span class="p">,</span> <span class="n">by</span>
                     <span class="p">,</span> <span class="n">preserve_row_order</span> <span class="o">=</span> <span class="kc">False</span>
                     <span class="p">,</span> <span class="n">row_order_column_name</span> <span class="o">=</span> <span class="s2">&quot;rowid_temp&quot;</span>
                     <span class="p">,</span> <span class="n">is_pandas_udf</span> <span class="o">=</span> <span class="kc">False</span>
                     <span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
                     <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Split by some columns, apply a function per chunk which returns a </span>
<span class="sd">        dataframe and combine it back into a single dataframe</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func: callable</span>
<span class="sd">            Type 1. A function: TidyDataFrame --&gt; TidyDataFrame</span>
<span class="sd">            Type 2. A function: simple pandas df --&gt; simple pandas df</span>
<span class="sd">            In latter case, set &#39;is_pandas_udf&#39; to True</span>
<span class="sd">        </span>
<span class="sd">        by: string or list of strings</span>
<span class="sd">            Column names to group by</span>
<span class="sd">        </span>
<span class="sd">        preserve_row_order: bool (default is False)</span>
<span class="sd">            Whether to preserve the row order of the input dataframe</span>
<span class="sd">        </span>
<span class="sd">        row_order_column_name: string</span>
<span class="sd">            Temporary column name to be created to maintain row order</span>
<span class="sd">            </span>
<span class="sd">        is_pandas_udf: bool (default is False)</span>
<span class="sd">            Whether the &#39;func&#39; argument is of type 2</span>
<span class="sd">            </span>
<span class="sd">        **kwargs: arguments to &#39;func&#39;</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. Chunks will always include the grouping columns.</span>
<span class="sd">        2. If grouping columns are found in output of &#39;func&#39;, then they are</span>
<span class="sd">           removed and replaced with value in input chunk.</span>
<span class="sd">        3. When &#39;preserve_row_order&#39; is True, a temporary column is added</span>
<span class="sd">           to each chunk. udf should pass it through without modification.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # pick a sample of rows per chunk defined by &#39;species&#39;</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.group_modify(lambda x: x.sample(n = 3)</span>
<span class="sd">        &gt;&gt;&gt;                             , by = &#39;species&#39;</span>
<span class="sd">        &gt;&gt;&gt;                             )</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # apply a pandas udf per chunk defined by &#39;species&#39;</span>
<span class="sd">        &gt;&gt;&gt; # groupby columns are always added to the left</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.group_modify(lambda x: x.select(&#39;year&#39;)</span>
<span class="sd">        &gt;&gt;&gt;                             , by = [&#39;species&#39;, &#39;sex&#39;]</span>
<span class="sd">        &gt;&gt;&gt;                             )</span>
<span class="sd">        &gt;&gt;&gt;                                 </span>
<span class="sd">        &gt;&gt;&gt; # preserve row order</span>
<span class="sd">        &gt;&gt;&gt; # a temporary column (default: &#39;rowid_temp&#39;) is added to each chunk</span>
<span class="sd">        &gt;&gt;&gt; # udf should not meddle with the temporary column</span>
<span class="sd">        &gt;&gt;&gt; (penguins_tidy</span>
<span class="sd">        &gt;&gt;&gt;     .select(&#39;sex&#39;)</span>
<span class="sd">        &gt;&gt;&gt;     # add &#39;row_number&#39; column to illustrate row preservation</span>
<span class="sd">        &gt;&gt;&gt;     .add_row_number()</span>
<span class="sd">        &gt;&gt;&gt;     # print the output of each chunk</span>
<span class="sd">        &gt;&gt;&gt;     # sample 2 rows</span>
<span class="sd">        &gt;&gt;&gt;     .group_modify(lambda x: x.pipe_tee(print).sample(2)</span>
<span class="sd">        &gt;&gt;&gt;                   , by = &#39;sex&#39;</span>
<span class="sd">        &gt;&gt;&gt;                   , preserve_row_order = True</span>
<span class="sd">        &gt;&gt;&gt;                   )</span>
<span class="sd">        &gt;&gt;&gt;   )</span>
<span class="sd">        &gt;&gt;&gt;   </span>
<span class="sd">        &gt;&gt;&gt; # use kwargs</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.group_modify(lambda x, **kwargs: x.sample(n = kwargs[&#39;size&#39;])</span>
<span class="sd">        &gt;&gt;&gt;                             , by = &#39;species&#39;</span>
<span class="sd">        &gt;&gt;&gt;                             , size = 3</span>
<span class="sd">        &gt;&gt;&gt;                             )</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_by</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
        <span class="n">by</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
        <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>
        <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrow</span>
        
        <span class="k">assert</span> <span class="n">callable</span><span class="p">(</span><span class="n">func</span><span class="p">),</span>\
            <span class="s2">&quot;&#39;func&#39; should be a function: tidy df --&gt; tidy df&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">preserve_row_order</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;preserve_row_order&#39; should be a bool&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row_order_column_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;row_order_column_name&#39; should be a string&quot;</span>
        <span class="k">assert</span> <span class="n">row_order_column_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">,</span>\
            <span class="s2">&quot;arg &#39;row_order_column_name&#39; should not be a existing column name&quot;</span>
        
        <span class="n">group_cn</span> <span class="o">=</span> <span class="n">_generate_new_string</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span>
        
        <span class="n">group_id_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">by</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
        <span class="n">group_id_frame</span><span class="p">[</span><span class="n">group_cn</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">group_id_frame</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      
        <span class="c1"># create wrapper function</span>
        <span class="k">if</span> <span class="n">is_pandas_udf</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">wrapper_func</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">group_cn</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                           <span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
                           <span class="p">)</span>
                <span class="n">by_left</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">by</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">by_left</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">by_left</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">by</span><span class="p">:</span>
                    <span class="n">res</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">chunk</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                
                <span class="n">cols_in_order</span> <span class="o">=</span> <span class="n">util_copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
                <span class="n">cols_in_order</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">by</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">cols_in_order</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">wrapper_func</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="c1"># i/o are pdfs</span>
                <span class="n">chunk_tidy</span> <span class="o">=</span> <span class="p">(</span><span class="n">tidyframe</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                                                 <span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span>
                                                 <span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span>
                                                 <span class="p">)</span>
                              <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">group_cn</span><span class="p">,</span> <span class="n">include</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                              <span class="p">)</span>
                <span class="n">res</span>        <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">chunk_tidy</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                <span class="n">by_left</span>    <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">by</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">by_left</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">by_left</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">by</span><span class="p">:</span>
                    <span class="n">res</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">chunk</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                
                <span class="n">cols_in_order</span> <span class="o">=</span> <span class="n">util_copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
                <span class="n">cols_in_order</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">by</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">cols_in_order</span><span class="p">]</span> 
        
        <span class="k">if</span> <span class="n">preserve_row_order</span><span class="p">:</span>
            
            <span class="k">assert</span> <span class="n">row_order_column_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cn</span><span class="p">,</span>\
                <span class="p">(</span><span class="s2">&quot;arg &#39;row_order_column_name&#39; should not be an exisiting column &quot;</span>
                 <span class="s2">&quot;name&quot;</span>
                 <span class="p">)</span>
            
            <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                        <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">row_order_column_name</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nr</span><span class="p">)})</span>
                        <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">group_id_frame</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="n">by</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">group_cn</span><span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dropna</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">wrapper_func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                        <span class="p">)</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">simplify</span><span class="p">)</span>
                          <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">group_cn</span><span class="p">)</span>
                          <span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">((</span><span class="s2">&quot;Result of apply is too complex to be simplified &quot;</span>
                                 <span class="s2">&quot;by `simplify` function&quot;</span>
                                 <span class="p">)</span>
                                <span class="p">)</span>
            
            <span class="k">if</span> <span class="n">row_order_column_name</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
                <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">row_order_column_name</span>
                                       <span class="p">,</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span>
                                       <span class="p">)</span>
                          <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">row_order_column_name</span><span class="p">)</span>
                          <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="p">(</span><span class="s2">&quot;&#39;row_order_column_name&#39; in each chunk should &quot;</span>
                     <span class="s2">&quot;be retained, when &#39;preserve_row_order&#39; is True&quot;</span>
                     <span class="p">))</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># do not preserve row order</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                       <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">group_id_frame</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="n">by</span><span class="p">)</span>
                       <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">group_cn</span><span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dropna</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                       <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">wrapper_func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                       <span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">simplify</span><span class="p">)</span>
                          <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">group_cn</span><span class="p">)</span>
                          <span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">((</span><span class="s2">&quot;Result of apply is too complex to be simplified &quot;</span>
                                 <span class="s2">&quot;by `simplify` function&quot;</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">res</span>
                         <span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span>
                         <span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span>
                         <span class="p">)</span></div>
    
    <span class="c1">##########################################################################</span>
    <span class="c1"># basic verbs</span>
    <span class="c1">##########################################################################</span>
    
    
    <span class="c1">##########################################################################</span>
    <span class="c1"># select</span>
    <span class="c1">##########################################################################</span>
    
<div class="viewcode-block" id="tidyframe.select"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.select">[docs]</a>    <span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_names</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">predicate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">include</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Select a subset of columns by name or predicate</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        column_names : str or a list of strings</span>
<span class="sd">            list of column names to be selected</span>
<span class="sd">        predicate : callable, series --&gt; bool</span>
<span class="sd">            function which returns a bool</span>
<span class="sd">        include : bool, default is True</span>
<span class="sd">            When True, column_names are selected, else dropped</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. Select works by either specifying column names or a predicate,</span>
<span class="sd">           not both.</span>
<span class="sd">        2. When predicate is used, predicate should accept a pandas series and</span>
<span class="sd">           return a bool. Each column is passed to the predicate and the result</span>
<span class="sd">           indicates whether the column should be selected or not.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import re</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # select with names</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.select([&#39;sex&#39;, &#39;species&#39;])</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # select using a predicate: only non-numeric columns</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.select(predicate = lambda x: x.dtype != &quot;string&quot;)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # select columns ending with &#39;mm&#39;</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.select(</span>
<span class="sd">        &gt;&gt;&gt;     predicate = lambda x: bool(re.match(&quot;.*mm$&quot;, x.name))</span>
<span class="sd">        &gt;&gt;&gt;     )</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # invert the selection</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.select([&#39;sex&#39;, &#39;species&#39;], include = False)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">column_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">predicate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">((</span><span class="s2">&quot;Exactly one among &#39;column_names&#39; and &#39;predicate&#39; &quot;</span>
                             <span class="s2">&quot;should not be None&quot;</span><span class="p">)</span>
                            <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">column_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">predicate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">((</span><span class="s2">&quot;Exactly one among &#39;column_names&#39; and &#39;predicate&#39; &quot;</span>
                             <span class="s2">&quot;should not be None&quot;</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">column_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">callable</span><span class="p">(</span><span class="n">predicate</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;predicate&#39;(series --&gt; bool) should be a function&quot;</span>
            <span class="n">col_bool_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">predicate</span>
                                                            <span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="s2">&quot;index&quot;</span>
                                                            <span class="p">)</span>
                                         <span class="p">)</span>
                                    <span class="p">)</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cn</span><span class="p">)[</span><span class="n">col_bool_list</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_column_names</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">include</span><span class="p">:</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">setlist</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">column_names</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;At least one column should be selected&quot;</span><span class="p">)</span>
            
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">column_names</span><span class="p">]</span>
        <span class="c1"># return a copy due to loc</span>
        <span class="k">return</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span></div>
    
    <span class="c1">##########################################################################</span>
    <span class="c1"># relocate</span>
    <span class="c1">##########################################################################</span>
    
<div class="viewcode-block" id="tidyframe.relocate"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.relocate">[docs]</a>    <span class="k">def</span> <span class="nf">relocate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_names</span><span class="p">,</span> <span class="n">before</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">after</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        relocate the columns of the tidy pandas dataframe</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        column_names : string or a list of strings</span>
<span class="sd">            column names to be moved</span>
<span class="sd">        before : string, optional</span>
<span class="sd">            column before which the column are to be moved. The default is None.</span>
<span class="sd">        after : TYPE, optional</span>
<span class="sd">            column after which the column are to be moved. The default is None.</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Only one among &#39;before&#39; and &#39;after&#39; can be not None. When both are None,</span>
<span class="sd">        the columns are added to the begining of the dataframe (leftmost)</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # move &quot;island&quot; and &quot;species&quot; columns to the left of the dataframe</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.relocate([&quot;island&quot;, &quot;species&quot;])</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # move &quot;sex&quot; and &quot;year&quot; columns to the left of &quot;island&quot; column</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.relocate([&quot;sex&quot;, &quot;year&quot;], before = &quot;island&quot;)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # move &quot;island&quot; and &quot;species&quot; columns to the right of &quot;year&quot; column</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.relocate([&quot;island&quot;, &quot;species&quot;], after = &quot;year&quot;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_column_names</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span> 
        <span class="n">column_names</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span>
        <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>
         
        <span class="k">assert</span> <span class="ow">not</span> <span class="p">((</span><span class="n">before</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">after</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)),</span>\
            <span class="s2">&quot;Atleast one arg among &#39;before&#39; and &#39;after&#39; should be None&quot;</span>
            
        <span class="k">if</span> <span class="n">after</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">after</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;after&#39; should be a string&quot;</span>
            <span class="k">assert</span> <span class="n">after</span> <span class="ow">in</span> <span class="n">cn</span><span class="p">,</span>\
                <span class="s2">&quot;arg &#39;after&#39; should be a exisiting column name&quot;</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span><span class="n">after</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;after&#39; should be an element of &#39;column_names&#39;&quot;</span>
        
        <span class="k">if</span> <span class="n">before</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;before&#39; should be a string&quot;</span>
            <span class="k">assert</span> <span class="n">before</span> <span class="ow">in</span> <span class="n">cn</span><span class="p">,</span>\
                <span class="s2">&quot;arg &#39;before&#39; should be a exisiting column name&quot;</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span><span class="n">before</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;before&#39; should be an element of &#39;column_names&#39;&quot;</span>
        
        <span class="n">cc_setlist</span>       <span class="o">=</span> <span class="n">setlist</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span>
        <span class="n">cc_trunc_setlist</span> <span class="o">=</span> <span class="n">cc_setlist</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span>
            
        <span class="c1"># case 1: relocate to start when both before and after are None</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">before</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">after</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">new_colnames</span> <span class="o">=</span> <span class="n">column_names</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">cc_trunc_setlist</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">before</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="c1"># case 2: before is not None</span>
            <span class="n">pos_before</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cc_trunc_setlist</span><span class="p">)</span> <span class="o">==</span> <span class="n">before</span><span class="p">)</span>
            <span class="n">pos_before</span>   <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pos_before</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">cc_left</span>      <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cc_trunc_setlist</span><span class="p">[:</span><span class="n">pos_before</span><span class="p">])</span>
            <span class="n">cc_right</span>     <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cc_trunc_setlist</span><span class="p">[</span><span class="n">pos_before</span><span class="p">:])</span>
            <span class="n">new_colnames</span> <span class="o">=</span> <span class="n">cc_left</span> <span class="o">+</span> <span class="n">column_names</span> <span class="o">+</span> <span class="n">cc_right</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># case 3: after is not None</span>
            <span class="n">pos_after</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cc_trunc_setlist</span><span class="p">)</span> <span class="o">==</span> <span class="n">after</span><span class="p">)</span>
            <span class="n">pos_after</span>   <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pos_after</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>    
            <span class="n">cc_left</span>      <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cc_trunc_setlist</span><span class="p">[</span> <span class="p">:(</span><span class="n">pos_after</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
            <span class="n">cc_right</span>     <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cc_trunc_setlist</span><span class="p">[(</span><span class="n">pos_after</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span> <span class="p">])</span>
            <span class="n">new_colnames</span> <span class="o">=</span> <span class="n">cc_left</span> <span class="o">+</span> <span class="n">column_names</span> <span class="o">+</span> <span class="n">cc_right</span>
      
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">new_colnames</span><span class="p">]</span>
        <span class="c1"># return a copy due to loc</span>
        <span class="k">return</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span></div>
    
    <span class="c1">##########################################################################</span>
    <span class="c1"># rename</span>
    <span class="c1">##########################################################################</span>
    
<div class="viewcode-block" id="tidyframe.rename"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.rename">[docs]</a>    <span class="k">def</span> <span class="nf">rename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_new_dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">predicate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">func</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Rename columns of the tidy pandas dataframe</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        old_new_dict: dict</span>
<span class="sd">            A dict with old names as keys and new names as values</span>
<span class="sd">        predicate: callable</span>
<span class="sd">            function with series input and bool output to identify a column</span>
<span class="sd">        func: callable</span>
<span class="sd">            function to apply on columns identified by predicate</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.rename({&#39;species&#39;: &#39;species_2&#39;})</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.rename(predicate = lambda x: bool(re.match(&quot;^spe&quot;, x.name)),</span>
<span class="sd">        &gt;&gt;&gt;                      func = lambda x: x.name + &quot;_two&quot;</span>
<span class="sd">        &gt;&gt;&gt;                      )</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">old_new_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">predicate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;provide exactly one among old_new_dict and predicate&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">old_new_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">predicate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;provide exactly one among old_new_dict and predicate&quot;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="n">predicate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;both predicate and func should be provided&quot;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="n">predicate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;both predicate and func should be provided&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">old_new_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">old_new_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;old_new_dict&#39; should be a dict&quot;</span>
            <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span><span class="o">.</span><span class="n">issuperset</span><span class="p">(</span><span class="n">old_new_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>\
                <span class="s2">&quot;keys of the input dict should be existing column names&quot;</span>
            <span class="k">assert</span> <span class="n">_is_string_or_string_list</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">old_new_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())),</span>\
                <span class="s2">&quot;values of the dict should be strings&quot;</span>
            <span class="k">assert</span> <span class="n">_is_unique_list</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">old_new_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())),</span>\
                <span class="s2">&quot;values of the dict should be unique&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">callable</span><span class="p">(</span><span class="n">predicate</span><span class="p">),</span>\
                <span class="s2">&quot;predicate should be a function&quot;</span>
            <span class="k">assert</span> <span class="n">callable</span><span class="p">(</span><span class="n">func</span><span class="p">),</span>\
                <span class="s2">&quot;func should be a function&quot;</span>
        
        <span class="c1"># create old_new_dict in predicate case</span>
        <span class="k">if</span> <span class="n">old_new_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">col_bool_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">predicate</span>
                                                            <span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="s2">&quot;index&quot;</span>
                                                            <span class="p">)</span>
                                         <span class="p">)</span>
                                    <span class="p">)</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cn</span><span class="p">)[</span><span class="n">col_bool_list</span><span class="p">])</span>
            <span class="n">column_names_renamed</span> <span class="o">=</span> <span class="p">[</span><span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">]</span>
            <span class="n">old_new_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">column_names</span><span class="p">,</span> <span class="n">column_names_renamed</span><span class="p">))</span>
        
        <span class="c1"># new names should not intersect with &#39;remaining&#39; names</span>
        <span class="n">remaining</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">old_new_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">remaining</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">old_new_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>\
            <span class="p">(</span><span class="s2">&quot;New intended column names (values of the dict) lead to duplicate &quot;</span>
             <span class="s2">&quot;column names&quot;</span>
             <span class="p">)</span>
        
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">old_new_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></div>
    
    <span class="c1">##########################################################################</span>
    <span class="c1"># slice</span>
    <span class="c1">##########################################################################</span>
    
<div class="viewcode-block" id="tidyframe.slice"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.slice">[docs]</a>    <span class="k">def</span> <span class="nf">slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row_numbers</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Subset rows of a tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        row_numbers : int or list or range or 1-D numpy array of positive integers</span>
<span class="sd">            list/array of row numbers.</span>
<span class="sd">        by : list of strings, optional</span>
<span class="sd">            Column names to groupby. The default is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. Grouped slice preserves the row order.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>

<span class="sd">        &gt;&gt;&gt; # pick first three rows of the dataframe</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice(np.arange(3))</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # pick these row numbers: [0, 3, 8]</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice([0, 3, 8])</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # pick first three rows per specie</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice([0,1,2], by = &quot;species&quot;)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # pick first three rows for each species and sex combination</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice(np.arange(3), by = [&quot;species&quot;, &quot;sex&quot;])</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row_numbers</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">row_numbers</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">row_numbers</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row_numbers</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">row_numbers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">row_numbers</span><span class="p">)</span>
            
        <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">dtypes</span><span class="o">.</span><span class="n">is_integer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">row_numbers</span><span class="p">]),</span>\
            <span class="s2">&quot;arg &#39;row_numbers&#39; should be a list or array of positive integers&quot;</span>
        
        <span class="k">if</span> <span class="n">by</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">minval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">row_numbers</span><span class="p">)</span>
            <span class="n">maxval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">row_numbers</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">minval</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">maxval</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrow</span><span class="p">,</span>\
                <span class="p">(</span><span class="s2">&quot;row numbers to slice should be in a range the max and min &quot;</span>
                 <span class="s2">&quot;rows of the dataframe&quot;</span>
                 <span class="p">)</span>
            
            <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                       <span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row_numbers</span><span class="p">,</span> <span class="p">:]</span>
                       <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                       <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">))</span>
                       <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_by</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
            <span class="n">by</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
            
            <span class="n">min_group_size</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                                  <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dropna</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                                  <span class="o">.</span><span class="n">size</span><span class="p">()</span>
                                  <span class="o">.</span><span class="n">min</span><span class="p">()</span>
                                  <span class="p">)</span>
                                  
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">row_numbers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">min_group_size</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Minimum group size is: &quot;</span><span class="p">,</span> <span class="n">min_group_size</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">((</span><span class="s2">&quot;Maximum row number to slice per group should&quot;</span> 
                                 <span class="s2">&quot;not exceed the number of rows of the group&quot;</span>
                                 <span class="p">))</span>
            
            <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_modify</span><span class="p">(</span><span class="k">lambda</span> <span class="n">chunk</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row_numbers</span><span class="p">,</span> <span class="p">:]</span>
                                     <span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">by</span>
                                     <span class="p">,</span> <span class="n">is_pandas_udf</span> <span class="o">=</span> <span class="kc">True</span>
                                     <span class="p">,</span> <span class="n">preserve_row_order</span> <span class="o">=</span> <span class="kc">True</span>
                                     <span class="p">,</span> <span class="n">row_order_column_name</span> <span class="o">=</span> <span class="n">_generate_new_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span>
                                     <span class="p">)</span>
                       <span class="o">.</span><span class="n">relocate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span>
                       <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">res</span></div>
    
    <span class="c1">##########################################################################</span>
    <span class="c1"># arrange</span>
    <span class="c1">##########################################################################</span>
        
<div class="viewcode-block" id="tidyframe.arrange"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.arrange">[docs]</a>    <span class="k">def</span> <span class="nf">arrange</span><span class="p">(</span><span class="bp">self</span>
                <span class="p">,</span> <span class="n">order_by</span>
                <span class="p">,</span> <span class="n">na_position</span> <span class="o">=</span> <span class="s1">&#39;last&#39;</span>
                <span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Orders the rows by the values of selected columns</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        column_names : list of strings</span>
<span class="sd">            column names to order by.</span>
<span class="sd">        order_by: str, list, tuple</span>
<span class="sd">            column names and asc/desc tuples. See examples.</span>
<span class="sd">        na_position : str, optional</span>
<span class="sd">            One among: &#39;first&#39;, &#39;last&#39;. The default is &#39;last&#39;.</span>
<span class="sd">        by: str, list of strings (default: None)</span>
<span class="sd">            Column names to group by</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # arrange by ascending order of column &#39;bill_length_mm&#39;</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.arrange(&#39;bill_length_mm&#39;)</span>
<span class="sd">        &gt;&gt;&gt; # equivalent to below:</span>
<span class="sd">        &gt;&gt;&gt; # penguins_tidy.arrange([(&#39;bill_length_mm&#39;, &#39;asc&#39;)])</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # arrange by descding order of column &#39;bill_length_mm&#39;</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.arrange([(&#39;bill_length_mm&#39;, &#39;desc&#39;)])</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # arrange by ascending order of column &#39;body_mass_g&#39; and break ties with</span>
<span class="sd">        &gt;&gt;&gt; # ascending order to &#39;bill_length_mm&#39;</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.arrange([(&#39;body_mass_g&#39;, &#39;asc&#39;), (&#39;bill_length_mm&#39;, &#39;asc&#39;)])</span>
<span class="sd">        &gt;&gt;&gt; # equivalent to below:</span>
<span class="sd">        &gt;&gt;&gt; # penguins_tidy.arrange([&#39;body_mass_g&#39;, &#39;bill_length_mm&#39;])</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # arrange by ascending order of column &#39;body_mass_g&#39; and break ties with</span>
<span class="sd">        &gt;&gt;&gt; # descending order to &#39;bill_length_mm&#39;</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.arrange([(&#39;body_mass_g&#39;, &#39;asc&#39;), (&#39;bill_length_mm&#39;, &#39;desc&#39;)])</span>
<span class="sd">        &gt;&gt;&gt; # equivalent to below:</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.arrange([&#39;body_mass_g&#39;, (&#39;bill_length_mm&#39;, &#39;desc&#39;)])</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # determine where NA has to appear</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.arrange(&#39;sex&#39;, na_position = &#39;first&#39;)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # grouped arrange: rearranges within the group</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.arrange(&#39;bill_length_mm&#39;, by = &#39;sex&#39;)</span>
<span class="sd">        &gt;&gt;&gt; # notice that order of &#39;sex&#39; column does not change while row corresponding</span>
<span class="sd">        &gt;&gt;&gt; # to &#39;bill_length_mm&#39; per group is sorted in ascending order</span>
<span class="sd">        &gt;&gt;&gt; # This preserves the relative position of groups</span>
<span class="sd">        &gt;&gt;&gt; # If you intend to not preserve the row order, then simply</span>
<span class="sd">        &gt;&gt;&gt; # include the grouping variable(s) in order</span>
<span class="sd">        &gt;&gt;&gt; # ex: penguins_tidy.arrange([&#39;sex&#39;, &#39;bill_length_mm&#39;])</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. Grouped arrange rearranges the rows within a group without</span>
<span class="sd">        changing the relative position of groups in the dataframe.</span>
<span class="sd">        </span>
<span class="sd">        2. When multiple columns are provided in order_by, second column is</span>
<span class="sd">        used to break the ties after sorting by first column and so on.</span>
<span class="sd">        </span>
<span class="sd">        3. If the column(s) provided in arrange are not sufficient to order </span>
<span class="sd">        the rows of the dataframe, then row number is implicitly used to</span>
<span class="sd">        deterministically break ties.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>
        <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrow</span>
        
        <span class="n">order_by</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_order_by</span><span class="p">(</span><span class="n">order_by</span><span class="p">)</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">order_by</span><span class="p">]</span>
        <span class="n">ascending</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;asc&quot;</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">order_by</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_by</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
            <span class="n">by</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">by</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">column_names</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>\
                <span class="s2">&quot;&#39;by&#39; and column names in &#39;order_by&#39; should not have common names&quot;</span>
        
        <span class="k">def</span> <span class="nf">pdf_sortit</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span>             <span class="o">=</span> <span class="n">column_names</span>
                                <span class="p">,</span> <span class="n">axis</span>         <span class="o">=</span> <span class="mi">0</span>
                                <span class="p">,</span> <span class="n">ascending</span>    <span class="o">=</span> <span class="n">ascending</span>
                                <span class="p">,</span> <span class="n">inplace</span>      <span class="o">=</span> <span class="kc">False</span>
                                <span class="p">,</span> <span class="n">kind</span>         <span class="o">=</span> <span class="s1">&#39;quicksort&#39;</span>
                                <span class="p">,</span> <span class="n">na_position</span>  <span class="o">=</span> <span class="n">na_position</span>
                                <span class="p">,</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="p">)</span>
            <span class="k">return</span> <span class="n">res</span>
        
        <span class="k">if</span> <span class="n">by</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">pdf_sortit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rn_org</span> <span class="o">=</span> <span class="n">_generate_new_string</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span>
            <span class="n">g_id</span>   <span class="o">=</span> <span class="n">_generate_new_string</span><span class="p">(</span><span class="n">cn</span> <span class="o">+</span> <span class="p">[</span><span class="n">rn_org</span><span class="p">])</span>
            <span class="n">wgn</span>    <span class="o">=</span> <span class="n">_generate_new_string</span><span class="p">(</span><span class="n">cn</span> <span class="o">+</span> <span class="p">[</span><span class="n">rn_org</span><span class="p">,</span> <span class="n">g_id</span><span class="p">])</span>
            <span class="n">rn_arr</span> <span class="o">=</span> <span class="n">_generate_new_string</span><span class="p">(</span><span class="n">cn</span> <span class="o">+</span> <span class="p">[</span><span class="n">rn_org</span><span class="p">,</span> <span class="n">g_id</span><span class="p">,</span> <span class="n">wgn</span><span class="p">])</span>
            
            <span class="n">lam</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])})</span>
            
            <span class="c1"># org: rn_org &lt;-&gt; g_id &lt;-&gt; wgn</span>
            <span class="n">org_order</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_row_number</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">rn_org</span><span class="p">)</span>
                             <span class="o">.</span><span class="n">add_group_number</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">g_id</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">by</span><span class="p">)</span>
                             <span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">rn_org</span><span class="p">,</span> <span class="n">g_id</span><span class="p">])</span>
                             <span class="o">.</span><span class="n">add_row_number</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">wgn</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">g_id</span><span class="p">)</span>
                             <span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                             <span class="p">)</span>
                               
            <span class="c1"># arranged: rn_arr &lt;-&gt; g_id &lt;-&gt; wgn</span>
            <span class="n">arranged_order</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_group_number</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">g_id</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">by</span><span class="p">)</span>
                                  <span class="o">.</span><span class="n">add_row_number</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">rn_arr</span><span class="p">)</span>
                                  <span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                                  <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">g_id</span><span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                                  <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pdf_sortit</span><span class="p">)</span>
                                  <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                                  <span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="n">g_id</span><span class="p">,</span> <span class="n">rn_arr</span><span class="p">]]</span>
                                  <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">g_id</span><span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                                  <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">lam</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">wgn</span><span class="p">))</span>
                                  <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                                  <span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="n">g_id</span><span class="p">,</span> <span class="n">wgn</span><span class="p">,</span> <span class="n">rn_arr</span><span class="p">]]</span>
                                  <span class="p">)</span>
            
            <span class="c1"># rn_org &lt;-&gt; rn_arr                   </span>
            <span class="n">order_df</span> <span class="o">=</span> <span class="p">(</span><span class="n">org_order</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">arranged_order</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="p">[</span><span class="n">g_id</span><span class="p">,</span> <span class="n">wgn</span><span class="p">])</span>
                                 <span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="n">rn_org</span><span class="p">,</span> <span class="n">rn_arr</span><span class="p">]]</span>
                                 <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">rn_org</span><span class="p">)</span>
                                 <span class="p">)</span>
            
            <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                       <span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">order_df</span><span class="p">[</span><span class="n">rn_arr</span><span class="p">]),</span> <span class="p">:]</span>
                       <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                       <span class="p">)</span>
            
        <span class="k">return</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></div>
    
    <span class="c1">##########################################################################</span>
    <span class="c1"># filter</span>
    <span class="c1">##########################################################################</span>
        
<div class="viewcode-block" id="tidyframe.filter"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.filter">[docs]</a>    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        subset some rows</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        query: str or a function</span>
<span class="sd">            when str, query string parsable by pandas eval</span>
<span class="sd">            when function, should output an array of booleans</span>
<span class="sd">            of length equal to numbers of rows of the input dataframe</span>
<span class="sd">        mask: list of booleans or</span>
<span class="sd">              numpy array or pandas Series of booleans</span>
<span class="sd">              of length equal to numbers of rows of the input dataframe</span>
<span class="sd">        by: Optional, str or list of strings</span>
<span class="sd">            column names to group by </span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. Exactly one arg among &#39;query&#39; and &#39;mask&#39; should be provided</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # query with pandas eval. pandas eval does not support complicated expressions.</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.filter(&quot;body_mass_g &gt; 4000&quot;)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # subset with a mask -- list or array or pandas Series of precomputed booleans</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.filter(mask = (penguins_tidy.pull(&quot;year&quot;) == 2007))</span>
<span class="sd">        &gt;&gt;&gt; # equivalently:</span>
<span class="sd">        &gt;&gt;&gt; # penguins_tidy.filter(lambda x: x.year == 2007)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # use complex expressions as a lambda function and filter</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.filter(lambda x: x[&#39;bill_length_mm&#39;] &gt; np.mean(x[&#39;bill_length_mm&#39;]))</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # per group filter retains the row order</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.filter(lambda x: x[&#39;bill_length_mm&#39;] &gt; np.mean(x[&#39;bill_length_mm&#39;]), by = &#39;sex&#39;)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # using kwargs</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.filter(lambda x, **kwargs: x.year == kwargs[&#39;some_kwarg&#39;],</span>
<span class="sd">        &gt;&gt;&gt;                      some_kwarg = 2009</span>
<span class="sd">        &gt;&gt;&gt;                      )</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">query</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Both &#39;query&#39; and &#39;mask&#39; cannot be None&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">query</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;One among &#39;query&#39; and &#39;mask&#39; should be None&quot;</span><span class="p">)</span>
        
        <span class="c1"># validate query</span>
        <span class="k">if</span> <span class="n">query</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">callable</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            
        <span class="c1"># validate mask</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span>
            
        <span class="c1"># validate &#39;by&#39;</span>
        <span class="k">if</span> <span class="n">by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">by</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_by</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
        
        <span class="k">def</span> <span class="nf">handle_mask</span><span class="p">(</span><span class="n">ser</span><span class="p">):</span>
            <span class="n">ser</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ser</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">query</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">by</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">_is_kwargable</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
                        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                                   <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;__mask&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">handle_mask</span><span class="p">(</span><span class="n">query</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))})</span>
                                   <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;__mask&quot;</span><span class="p">)</span>
                                   <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="s2">&quot;__mask&quot;</span><span class="p">)</span>
                                   <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                               <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;__mask&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">handle_mask</span><span class="p">(</span><span class="n">query</span><span class="p">(</span><span class="n">x</span><span class="p">))})</span>
                               <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;__mask&quot;</span><span class="p">)</span>
                               <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="s2">&quot;__mask&quot;</span><span class="p">)</span>
                               <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># grouped case</span>
                <span class="n">ro_name</span> <span class="o">=</span> <span class="n">_generate_new_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_modify</span><span class="p">(</span><span class="k">lambda</span> <span class="n">chunk</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
                                             <span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">by</span>
                                             <span class="p">,</span> <span class="n">is_pandas_udf</span> <span class="o">=</span> <span class="kc">True</span>
                                             <span class="p">,</span> <span class="n">preserve_row_order</span> <span class="o">=</span> <span class="kc">True</span>
                                             <span class="p">,</span> <span class="n">row_order_column_name</span> <span class="o">=</span> <span class="n">ro_name</span>
                                             <span class="p">)</span>
                               <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">_is_kwargable</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
                        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_modify</span><span class="p">(</span><span class="k">lambda</span> <span class="n">chunk</span><span class="p">:</span> <span class="p">(</span>
                                                     <span class="n">chunk</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;__mask&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">handle_mask</span><span class="p">(</span><span class="n">query</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))})</span>
                                                          <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;__mask&quot;</span><span class="p">)</span>
                                                          <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="s2">&quot;__mask&quot;</span><span class="p">)</span>
                                                          <span class="p">)</span>
                                                 <span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">by</span>
                                                 <span class="p">,</span> <span class="n">is_pandas_udf</span> <span class="o">=</span> <span class="kc">True</span>
                                                 <span class="p">,</span> <span class="n">preserve_row_order</span> <span class="o">=</span> <span class="kc">True</span>
                                                 <span class="p">,</span> <span class="n">row_order_column_name</span> <span class="o">=</span> <span class="n">ro_name</span>
                                                 <span class="p">)</span>
                                   <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_modify</span><span class="p">(</span><span class="k">lambda</span> <span class="n">chunk</span><span class="p">:</span> <span class="p">(</span>
                                                     <span class="n">chunk</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;__mask&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">handle_mask</span><span class="p">(</span><span class="n">query</span><span class="p">(</span><span class="n">x</span><span class="p">))})</span>
                                                          <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;__mask&quot;</span><span class="p">)</span>
                                                          <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="s2">&quot;__mask&quot;</span><span class="p">)</span>
                                                          <span class="p">)</span>
                                                 <span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">by</span>
                                                 <span class="p">,</span> <span class="n">is_pandas_udf</span> <span class="o">=</span> <span class="kc">True</span>
                                                 <span class="p">,</span> <span class="n">preserve_row_order</span> <span class="o">=</span> <span class="kc">True</span>
                                                 <span class="p">,</span> <span class="n">row_order_column_name</span> <span class="o">=</span> <span class="n">ro_name</span>
                                                 <span class="p">)</span>
                                   <span class="p">)</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">relocate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1">#query is None and mask is not None:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="p">:]</span>
            
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>     
            <span class="k">return</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span></div>
    
    <span class="c1">##########################################################################</span>
    <span class="c1"># distinct</span>
    <span class="c1">##########################################################################</span>
        
<div class="viewcode-block" id="tidyframe.distinct"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.distinct">[docs]</a>    <span class="k">def</span> <span class="nf">distinct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_names</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">keep_all</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        subset unique rows from the dataframe</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        column_names: string or a list of strings</span>
<span class="sd">            Names of the column for distinct</span>
<span class="sd">        keep_all: bool (default: False)</span>
<span class="sd">            Whether to keep all the columns or only the &#39;column_names&#39;</span>
<span class="sd">        by: Optional, string or a list of strings</span>
<span class="sd">            Column names to groupby</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. distinct preserves the order of the rows of the input dataframe.</span>
<span class="sd">        2. &#39;column_names&#39; and &#39;by&#39; should not have common column names.</span>
<span class="sd">        3. When keep_all is True, first rows corresponding a unique combination</span>
<span class="sd">           is preserved.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; tidy_penguins.distinct() # distinct over all columns</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; tidy_penguins.distinct(&#39;species&#39;) # keep only &#39;distinct&#39; columns</span>
<span class="sd">        &gt;&gt;&gt; tidy_penguins.distinct(&#39;species&#39;, keep_all = True) # keep all columns</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; tidy_penguins.distinct([&#39;bill_length_mm&#39;, &#39;bill_depth_mm&#39;])</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>
        <span class="k">if</span> <span class="n">column_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">_is_string_or_string_list</span><span class="p">(</span><span class="n">column_names</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;column_names&#39; should be a string or a list of strings&quot;</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">setlist</span><span class="p">(</span><span class="n">_enlist</span><span class="p">(</span><span class="n">column_names</span><span class="p">)))</span>
            <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">cn</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;column_names&#39; should contain valid column names&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="n">cn</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keep_all</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
        
        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                   <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span> <span class="o">=</span> <span class="n">column_names</span>
                                    <span class="p">,</span> <span class="n">keep</span> <span class="o">=</span> <span class="s2">&quot;first&quot;</span>
                                    <span class="p">,</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span>
                                    <span class="p">)</span>
                   <span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">keep_all</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">column_names</span><span class="p">]</span>
                       
        <span class="k">return</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></div>
    
    <span class="c1">##########################################################################</span>
    <span class="c1"># mutate</span>
    <span class="c1">##########################################################################</span>
    
<div class="viewcode-block" id="tidyframe._mutate"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe._mutate">[docs]</a>    <span class="k">def</span> <span class="nf">_mutate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dictionary</span><span class="p">,</span> <span class="n">order_by</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrow</span>
        <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>
        
        <span class="c1"># strategy</span>
        <span class="c1"># created &#39;mutated&#39; copy and keep adding/modifying columns</span>
        
        <span class="n">keys</span> <span class="o">=</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="c1"># ensure new column names to be created are valid (do not start with &#39;_&#39;)</span>
        <span class="n">keys_flattened</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
          <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">x</span><span class="p">]</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">])</span>
          <span class="p">)</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="n">_is_valid_colname</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">keys_flattened</span><span class="p">]),</span>\
          <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;column names to be created/modified should be valid column names. &quot;</span>
           <span class="s2">&quot;A valid column name should be a string not starting from &#39;_&#39;&quot;</span>
           <span class="p">)</span>
        
        <span class="c1"># handle &#39;order_by&#39;:</span>
        <span class="c1"># Orders the dataframe for &#39;mutate&#39; and keeps a row order column</span>
        <span class="c1"># at the end of mutate operation, the dataframe is sorted in original </span>
        <span class="c1"># order and row order column is deleted</span>
        <span class="n">rn_name</span> <span class="o">=</span> <span class="n">_generate_new_string</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">cn</span> <span class="o">+</span> <span class="n">keys_flattened</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">order_by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">order_by</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_order_by</span><span class="p">(</span><span class="n">order_by</span><span class="p">)</span>
            <span class="n">mutated</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                           <span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                           <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">rn_name</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])})</span>
                           <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">order_by</span><span class="p">],</span>
                                        <span class="n">ascending</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;asc&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">order_by</span><span class="p">]</span>
                                        <span class="p">)</span>
                           <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mutated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        
        <span class="n">keys</span> <span class="o">=</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="c1"># ensure new column names to be created are valid (do not start with &#39;_&#39;)</span>
        <span class="n">keys_flattened</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
          <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">x</span><span class="p">]</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">])</span>
          <span class="p">)</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="n">_is_valid_colname</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">keys_flattened</span><span class="p">]),</span>\
          <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;column names to be created/modified should be valid column names. &quot;</span>
           <span class="s2">&quot;A valid column name should be a string not starting from &#39;_&#39;&quot;</span>
           <span class="p">)</span>
        
        <span class="k">for</span> <span class="n">akey</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="p">:</span>
            
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">akey</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)),</span>\
                <span class="s2">&quot;LHS (dict keys) should be a string or a tuple of strings&quot;</span>
            <span class="k">assert</span> <span class="n">_is_string_or_string_list</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">akey</span><span class="p">)),</span>\
                <span class="s2">&quot;LHS (dict keys) should be a string or a tuple of strings&quot;</span>
            
            <span class="n">rhs</span> <span class="o">=</span> <span class="n">dictionary</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span>
            
            <span class="c1"># akey is a string or a list of strings</span>
            <span class="c1"># no longer a tuple</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">akey</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">akey</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">akey</span> <span class="o">=</span> <span class="n">akey</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">akey</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">akey</span><span class="p">)),</span>\
                        <span class="s2">&quot;LHS should have unique strings&quot;</span>
                    <span class="n">akey</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">akey</span><span class="p">)</span>
         
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">akey</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="c1"># three cases:</span>
                <span class="c1">#   1. direct assign</span>
                <span class="c1">#   2. assign via function</span>
                <span class="c1">#   3. assign via simple function</span>
                <span class="c1">#       3a. assign a preexisting column</span>
                <span class="c1">#       3b. assign with column args</span>
                
                <span class="c1"># 1. direct assign</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rhs</span><span class="p">,</span> <span class="p">((</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> 
                                    <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">rhs</span><span class="p">)):</span>
                    <span class="n">mutated</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhs</span>
                
                <span class="c1"># 2. assign via function -- pandas style UDF</span>
                <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rhs</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">rhs</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">_is_kwargable</span><span class="p">(</span><span class="n">rhs</span><span class="p">):</span>
                            <span class="n">mutated</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">(</span><span class="n">mutated</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">mutated</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">(</span><span class="n">mutated</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rhs</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;lambda x, **kwargs: &quot;</span> <span class="o">+</span> <span class="n">rhs</span><span class="p">)</span>
                        <span class="n">mutated</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">(</span><span class="n">mutated</span><span class="p">)</span>
                                 
                <span class="c1"># 3. assign via simple function</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rhs</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">,</span>\
                        <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;When RHS is a tuple, RHS should not have more than &quot;</span>
                         <span class="s2">&quot;two elements&quot;</span>
                         <span class="p">)</span>
                    <span class="k">assert</span> <span class="n">callable</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">),</span>\
                        <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;When RHS is a tuple, first element of RHS should be &quot;</span>
                         <span class="s2">&quot;a function or a string which can be enclosed in a &quot;</span>
                         <span class="s2">&quot;lambda function and evaluated&quot;</span>
                         <span class="p">)</span>
                    <span class="c1"># 3a. assign a preexisting column</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                            <span class="k">assert</span> <span class="n">akey</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">mutated</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span>\
                                <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;When RHS is a tuple with function alone, &quot;</span>
                                 <span class="s2">&quot;</span><span class="si">{akey}</span><span class="s2"> should be an exisiting column&quot;</span>
                                 <span class="p">)</span>
                            <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                                <span class="k">if</span> <span class="n">_is_kwargable</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                                    <span class="n">mutated</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">mutated</span><span class="p">[</span><span class="n">akey</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">mutated</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">mutated</span><span class="p">[</span><span class="n">akey</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># string case</span>
                            <span class="n">fun</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;lambda x, **kwargs: &quot;</span> <span class="o">+</span> <span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="n">mutated</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">mutated</span><span class="p">[</span><span class="n">akey</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="c1"># 3b. assign with column args</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="n">_is_string_or_string_list</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>\
                            <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;When RHS tuple has two elements, the second &quot;</span>
                             <span class="s2">&quot;element should be a string or a list of strings&quot;</span>
                             <span class="p">)</span>
                        <span class="n">cols</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">mutated</span><span class="o">.</span><span class="n">columns</span><span class="p">)),</span>\
                            <span class="sa">f</span><span class="s2">&quot;RHS should contain valid columns for LHS &#39;</span><span class="si">{</span><span class="n">akey</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
                        
                        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                            <span class="k">if</span> <span class="n">_is_kwargable</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                                <span class="n">mutated</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="o">*</span><span class="p">[</span><span class="n">mutated</span><span class="p">[</span><span class="n">acol</span><span class="p">]</span> <span class="k">for</span> <span class="n">acol</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">mutated</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="o">*</span><span class="p">[</span><span class="n">mutated</span><span class="p">[</span><span class="n">acol</span><span class="p">]</span> <span class="k">for</span> <span class="n">acol</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># string case</span>
                            <span class="n">chars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> 
                                         <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
                                         <span class="p">)[:</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)]</span>
                            <span class="n">fun</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">((</span><span class="s2">&quot;lambda &quot;</span> 
                                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span> 
                                        <span class="o">+</span> <span class="s2">&quot;, **kwargs: &quot;</span> 
                                        <span class="o">+</span> <span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                        <span class="p">)</span>
                                       <span class="p">)</span>
                            <span class="n">mutated</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">mutated</span><span class="p">[</span><span class="n">acol</span><span class="p">]</span> <span class="k">for</span> <span class="n">acol</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                                <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">((</span><span class="sa">f</span><span class="s2">&quot;RHS for key &#39;</span><span class="si">{</span><span class="n">akey</span><span class="si">}</span><span class="s2">&#39; should be in some &quot;</span>
                                     <span class="s2">&quot;standard form&quot;</span>
                                     <span class="p">))</span>
            
            <span class="c1"># multiple assignments</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># 1. direct assign is not supported for multi assignment</span>
                
                <span class="c1"># 2. assign via function</span>
                <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rhs</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    
                    <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">rhs</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">_is_kwargable</span><span class="p">(</span><span class="n">rhs</span><span class="p">):</span>
                            <span class="n">rhs_res</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">(</span><span class="n">mutated</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">rhs_res</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">(</span><span class="n">mutated</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rhs</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;lambda x, **kwargs: &quot;</span> <span class="o">+</span> <span class="n">rhs</span><span class="p">)</span>
                        <span class="n">rhs_res</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">(</span><span class="n">mutated</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                        
                    <span class="k">assert</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">rhs_res</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> 
                            <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rhs_res</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">akey</span><span class="p">)</span>
                            <span class="p">),</span>\
                        <span class="p">(</span><span class="s2">&quot;RHS should output a list of length equal to &quot;</span>
                         <span class="s2">&quot;length of LHS for key: </span><span class="si">{akey}</span><span class="s2">&quot;</span>
                         <span class="p">)</span>
                         
                    <span class="k">for</span> <span class="n">apair</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">akey</span><span class="p">,</span> <span class="n">rhs_res</span><span class="p">):</span>
                        <span class="n">mutated</span><span class="p">[</span><span class="n">apair</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">apair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        
                <span class="c1"># 3. assign via simple function</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rhs</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">,</span>\
                        <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;When RHS is a tuple, RHS should not have more &quot;</span>
                         <span class="s2">&quot;than two elements&quot;</span>
                         <span class="p">)</span>
                    <span class="k">assert</span> <span class="n">callable</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">),</span>\
                        <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;When RHS is a tuple, first element of RHS should be &quot;</span>
                         <span class="s2">&quot;a function or a string which can be enclosed in a &quot;</span>
                         <span class="s2">&quot;lambda function and evaluated&quot;</span>
                         <span class="p">)</span>
                    <span class="c1"># 3a. assign a preexisting columns</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">akey</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">mutated</span><span class="o">.</span><span class="n">columns</span><span class="p">)),</span>\
                            <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;When RHS is a tuple with function alone, </span><span class="si">{</span><span class="n">akey</span><span class="si">}</span><span class="s2">&quot;</span>
                             <span class="s2">&quot;should be an exisiting columns&quot;</span>
                             <span class="p">)</span>
                        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                            <span class="k">if</span> <span class="n">_is_kwargable</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                                <span class="n">rhs_res</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="o">*</span><span class="p">[</span><span class="n">mutated</span><span class="p">[</span><span class="n">acol</span><span class="p">]</span> <span class="k">for</span> <span class="n">acol</span> <span class="ow">in</span> <span class="n">akey</span><span class="p">]</span>
                                                 <span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
                                                 <span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">rhs_res</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="o">*</span><span class="p">[</span><span class="n">mutated</span><span class="p">[</span><span class="n">acol</span><span class="p">]</span> <span class="k">for</span> <span class="n">acol</span> <span class="ow">in</span> <span class="n">akey</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">chars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> 
                                         <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
                                         <span class="p">)[:</span><span class="nb">len</span><span class="p">(</span><span class="n">akey</span><span class="p">)]</span>
                            <span class="n">fun</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">((</span><span class="s2">&quot;lambda &quot;</span> 
                                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span> 
                                        <span class="o">+</span> <span class="s2">&quot;, **kwargs: &quot;</span> 
                                        <span class="o">+</span> <span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                        <span class="p">)</span>
                                       <span class="p">)</span>  
                            <span class="n">rhs_res</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">mutated</span><span class="p">[</span><span class="n">acol</span><span class="p">]</span> <span class="k">for</span> <span class="n">acol</span> <span class="ow">in</span> <span class="n">akey</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                            
                        <span class="k">assert</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">rhs_res</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
                                <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rhs_res</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">akey</span><span class="p">)</span>
                                <span class="p">),</span>\
                            <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RHS should output a list of length equal &quot;</span>
                             <span class="s2">&quot;to length of LHS for key: </span><span class="si">{akey}</span><span class="s2">&quot;</span>
                             <span class="p">)</span>
                        <span class="k">for</span> <span class="n">apair</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">akey</span><span class="p">,</span> <span class="n">rhs_res</span><span class="p">):</span>
                            <span class="n">mutated</span><span class="p">[</span><span class="n">apair</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">apair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="c1"># 3b. assign with column args</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="n">_is_string_or_string_list</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>\
                            <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;When RHS tuple has two elements, the second &quot;</span>
                             <span class="s2">&quot;element should be a string or a list of strings&quot;</span>
                             <span class="p">)</span>
                        <span class="n">cols</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">mutated</span><span class="o">.</span><span class="n">columns</span><span class="p">)),</span>\
                            <span class="sa">f</span><span class="s2">&quot;RHS should contain valid columns for LHS &#39;</span><span class="si">{</span><span class="n">akey</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
                        
                        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                            <span class="k">if</span> <span class="n">_is_kwargable</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                                <span class="n">rhs_res</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="o">*</span><span class="p">[</span><span class="n">mutated</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">rhs_res</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="o">*</span><span class="p">[</span><span class="n">mutated</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">chars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> 
                                         <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
                                         <span class="p">)[:</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)]</span>
                            <span class="n">fun</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">((</span><span class="s2">&quot;lambda &quot;</span> 
                                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span> 
                                        <span class="o">+</span> <span class="s2">&quot;, **kwargs: &quot;</span> 
                                        <span class="o">+</span> <span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                        <span class="p">)</span>
                                       <span class="p">)</span>  
                            <span class="n">rhs_res</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">mutated</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                        
                        <span class="k">assert</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">rhs_res</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> 
                                <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rhs_res</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">akey</span><span class="p">)</span>
                                <span class="p">),</span>\
                            <span class="p">(</span><span class="s2">&quot;RHS should output a list of length equal &quot;</span>
                             <span class="s2">&quot;to length of LHS for key: </span><span class="si">{akey}</span><span class="s2">&quot;</span>
                             <span class="p">)</span>
                        <span class="k">for</span> <span class="n">apair</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">akey</span><span class="p">,</span> <span class="n">rhs_res</span><span class="p">):</span>
                            <span class="n">mutated</span><span class="p">[</span><span class="n">apair</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">apair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">((</span><span class="sa">f</span><span class="s2">&quot;RHS for key &#39;</span><span class="si">{</span><span class="n">akey</span><span class="si">}</span><span class="s2">&#39; should be in some &quot;</span>
                                     <span class="s2">&quot;standard form&quot;</span>
                                     <span class="p">))</span>
        
        <span class="k">if</span> <span class="n">order_by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mutated</span> <span class="o">=</span> <span class="n">mutated</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">rn_name</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">rn_name</span><span class="p">])</span>
              
        <span class="k">return</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">mutated</span>
                          <span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span>
                          <span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span>
                          <span class="p">)</span></div>

    <span class="c1"># mutate_across    </span>
<div class="viewcode-block" id="tidyframe._mutate_across"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe._mutate_across">[docs]</a>    <span class="k">def</span> <span class="nf">_mutate_across</span><span class="p">(</span><span class="bp">self</span>
                       <span class="p">,</span> <span class="n">func</span>
                       <span class="p">,</span> <span class="n">column_names</span> <span class="o">=</span> <span class="kc">None</span>
                       <span class="p">,</span> <span class="n">predicate</span> <span class="o">=</span> <span class="kc">None</span>
                       <span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                       <span class="p">,</span> <span class="n">order_by</span> <span class="o">=</span> <span class="kc">None</span>
                       <span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
                       <span class="p">):</span>
        
        <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>
        <span class="k">assert</span> <span class="n">callable</span><span class="p">(</span><span class="n">func</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>\
            <span class="p">(</span><span class="s2">&quot;arg &#39;func&#39; should be a function or a string which is convertible &quot;</span>
             <span class="s2">&quot;to a lambda function&quot;</span>
             <span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">order_by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">order_by</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_order_by</span><span class="p">(</span><span class="n">order_by</span><span class="p">)</span>
            <span class="n">cn_prefix</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="n">prefix</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cn</span><span class="p">]</span>
            <span class="n">rn_name</span> <span class="o">=</span> <span class="n">_generate_new_string</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">cn</span> <span class="o">+</span> <span class="n">cn_prefix</span><span class="p">)))</span>
            <span class="n">mutated</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                           <span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                           <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">rn_name</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])})</span>
                           <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">order_by</span><span class="p">],</span>
                                        <span class="n">ascending</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;asc&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">order_by</span><span class="p">]</span>
                                        <span class="p">)</span>
                           <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mutated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">column_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">predicate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">((</span><span class="s2">&quot;Exactly one among &#39;column_names&#39; and &#39;predicate&#39; &quot;</span>
                             <span class="s2">&quot;should be None&quot;</span><span class="p">)</span>
                             <span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">column_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">predicate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Exactly one among &#39;column_names&#39; and &#39;predicate&#39; &quot;</span>
                            <span class="s2">&quot;should be None&quot;</span>
                            <span class="p">)</span>
        
        <span class="c1"># use column_names</span>
        <span class="k">if</span> <span class="n">column_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column_names</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">acol</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">acol</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">])</span>
        <span class="c1"># use predicate to assign appropriate column_names</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">predicate</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">))</span>
            <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">])(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_modify</span><span class="p">(</span><span class="k">lambda</span> <span class="n">chunk</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
                                             <span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">by</span>
                                             <span class="p">,</span> <span class="n">is_pandas_udf</span> <span class="o">=</span> <span class="kc">True</span>
                                             <span class="p">,</span> <span class="n">preserve_row_order</span> <span class="o">=</span> <span class="kc">True</span>
                                             <span class="p">,</span> <span class="n">row_order_column_name</span> <span class="o">=</span> <span class="n">ro_name</span>
                                             <span class="p">)</span>
                               <span class="p">)</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        
        <span class="c1"># make a copy of the dataframe and apply mutate in order</span>
        <span class="k">for</span> <span class="n">acol</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">_is_kwargable</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
                    <span class="n">mutated</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">acol</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">mutated</span><span class="p">[</span><span class="n">acol</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mutated</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">acol</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">mutated</span><span class="p">[</span><span class="n">acol</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>    
                <span class="n">func</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;lambda x, **kwargs: &quot;</span> <span class="o">+</span> <span class="n">func</span><span class="p">)</span>
                <span class="n">mutated</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">acol</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">mutated</span><span class="p">[</span><span class="n">acol</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">order_by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mutated</span> <span class="o">=</span> <span class="n">mutated</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">rn_name</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">rn_name</span><span class="p">])</span>
            
        <span class="k">return</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">mutated</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="tidyframe.mutate"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.mutate">[docs]</a>    <span class="k">def</span> <span class="nf">mutate</span><span class="p">(</span><span class="bp">self</span>
               <span class="p">,</span> <span class="n">dictionary</span> <span class="o">=</span> <span class="kc">None</span>
               <span class="p">,</span> <span class="n">func</span> <span class="o">=</span> <span class="kc">None</span>
               <span class="p">,</span> <span class="n">column_names</span> <span class="o">=</span> <span class="kc">None</span>
               <span class="p">,</span> <span class="n">predicate</span> <span class="o">=</span> <span class="kc">None</span>
               <span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
               <span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="kc">None</span>
               <span class="p">,</span> <span class="n">order_by</span> <span class="o">=</span> <span class="kc">None</span>
               <span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
               <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add or modify some columns</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dictionary: dict</span>
<span class="sd">            A dictionary of mutating operations. This supports multiple </span>
<span class="sd">            styles, see the examples</span>
<span class="sd">        func: callable</span>
<span class="sd">            A function to apply on the &#39;column_names&#39; or the columns chosen by</span>
<span class="sd">            the &#39;predicate&#39;.</span>
<span class="sd">        column_names: string or a list of strings</span>
<span class="sd">            Names of the columns to apply &#39;func&#39; on</span>
<span class="sd">        predicate: callable</span>
<span class="sd">            A function to choose columns. Input: pandas series, output: bool</span>
<span class="sd">        prefix: string</span>
<span class="sd">            Prefix the resulting summarization column after applying &#39;func&#39;</span>
<span class="sd">        by: string or a list of strings</span>
<span class="sd">            column names to group by</span>
<span class="sd">        order_by: string or a list of strings</span>
<span class="sd">            Names of columns to order by, before applying the mutating function</span>
<span class="sd">        **kwargs</span>
<span class="sd">            for lambda functions in dictionary or func</span>
<span class="sd">          </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. mutate works in two modes:</span>
<span class="sd">            a. direct assign: A series or 1-D array is assignged as a column</span>
<span class="sd">            b. dictionary mode: A key should be a resulting column name. Value</span>
<span class="sd">                should be a specification of the mutating operation. See the </span>
<span class="sd">                examples for various sytles.</span>
<span class="sd">            c. across mode: A function is applied across a set of columns or </span>
<span class="sd">                columns selected by a predicate function.</span>
<span class="sd">        2. mutate preserves row order.</span>
<span class="sd">        3. &#39;by&#39;(groupby) and &#39;order_by&#39; columns should not be mutated.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # mutate with dict</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.mutate({</span>
<span class="sd">        &gt;&gt;&gt;   # 1. direct assign</span>
<span class="sd">        &gt;&gt;&gt;   &#39;ind&#39; : np.arange(344), </span>
<span class="sd">        &gt;&gt;&gt;   </span>
<span class="sd">        &gt;&gt;&gt;   # 2. using pandas style lambda function</span>
<span class="sd">        &gt;&gt;&gt;   &quot;yp1&quot;: lambda x: x[&#39;year&#39;] + 1,</span>
<span class="sd">        &gt;&gt;&gt;   </span>
<span class="sd">        &gt;&gt;&gt;   # 2a. pass the content of lambda function as a string</span>
<span class="sd">        &gt;&gt;&gt;   &quot;yp1_string&quot;: &quot;x[&#39;year&#39;] + 1&quot;,</span>
<span class="sd">        &gt;&gt;&gt;   </span>
<span class="sd">        &gt;&gt;&gt;   # 3. pass a tuple of function and column list</span>
<span class="sd">        &gt;&gt;&gt;   &quot;yp1_abstract&quot;: (lambda x: x + 1, &quot;year&quot;),</span>
<span class="sd">        &gt;&gt;&gt;   </span>
<span class="sd">        &gt;&gt;&gt;   # 3a. pass the tuple of function content as string and the column list</span>
<span class="sd">        &gt;&gt;&gt;   &quot;yp2_abstract&quot;: (&quot;x + 1&quot;, &quot;year&quot;),</span>
<span class="sd">        &gt;&gt;&gt;   </span>
<span class="sd">        &gt;&gt;&gt;   # 4. pass multiple columns</span>
<span class="sd">        &gt;&gt;&gt;   &quot;x_plus_y&quot;: (&quot;x + y&quot;, [&quot;bill_length_mm&quot;, &quot;bill_depth_mm&quot;]),</span>
<span class="sd">        &gt;&gt;&gt;   # the above is equivalent to:</span>
<span class="sd">        &gt;&gt;&gt;   # &quot;x_plus_y&quot;: (lambda x, y: x + y, [&quot;bill_length_mm&quot;, &quot;bill_depth_mm&quot;]),</span>
<span class="sd">        &gt;&gt;&gt;   </span>
<span class="sd">        &gt;&gt;&gt;   # 5. output multiple columns as a list</span>
<span class="sd">        &gt;&gt;&gt;   (&#39;x&#39;, &#39;y&#39;): lambda x: [x[&#39;year&#39;] - 1, x[&#39;year&#39;] + 1],</span>
<span class="sd">        &gt;&gt;&gt;   # the above is equivalent to:</span>
<span class="sd">        &gt;&gt;&gt;   # (&#39;x2&#39;, &#39;y2&#39;): &quot;[x[&#39;year&#39;] - 1, x[&#39;year&#39;] + 1]&quot;,</span>
<span class="sd">        &gt;&gt;&gt;   </span>
<span class="sd">        &gt;&gt;&gt;   # change an existing column: add one to &#39;bill_length_mm&#39;</span>
<span class="sd">        &gt;&gt;&gt;   &#39;bill_length_mm&#39;: (&quot;x + 1&quot;, )</span>
<span class="sd">        &gt;&gt;&gt;   # the above is equivalent to these:</span>
<span class="sd">        &gt;&gt;&gt;   # &#39;bill_length_mm&#39;: (&quot;x + 1&quot;, &#39;bill_length_mm&#39;),</span>
<span class="sd">        &gt;&gt;&gt;   # &#39;bill_length_mm&#39;: (lambda x: x + 1, &#39;bill_length_mm&#39;)</span>
<span class="sd">        &gt;&gt;&gt;   })</span>
<span class="sd">        &gt;&gt;&gt;     </span>
<span class="sd">        &gt;&gt;&gt; # mutate with dict and groupby    </span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.mutate({&#39;x&#39; : &quot;x[&#39;year&#39;] + np.mean(x[&#39;year&#39;]) - 4015&quot;}</span>
<span class="sd">        &gt;&gt;&gt;                      , by = &#39;sex&#39;</span>
<span class="sd">        &gt;&gt;&gt;                      )</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # mutate can use columns created in the dict before</span>
<span class="sd">        &gt;&gt;&gt; (penguins_tidy.select(&#39;year&#39;)</span>
<span class="sd">        &gt;&gt;&gt;               .mutate({&#39;yp1&#39;: (&quot;x + 1&quot;, &#39;year&#39;),</span>
<span class="sd">        &gt;&gt;&gt;                        &#39;yp1m1&#39;: (&quot;x - 1&quot;, &#39;yp1&#39;)</span>
<span class="sd">        &gt;&gt;&gt;                       })</span>
<span class="sd">        &gt;&gt;&gt;               )</span>
<span class="sd">        &gt;&gt;&gt;                         </span>
<span class="sd">        &gt;&gt;&gt; # use kwargs</span>
<span class="sd">        &gt;&gt;&gt; (penguins_tidy</span>
<span class="sd">        &gt;&gt;&gt;  .select(&#39;year&#39;)</span>
<span class="sd">        &gt;&gt;&gt;  .mutate({&#39;yp1&#39;: (&quot;x + kwargs[&#39;akwarg&#39;]&quot;, &#39;year&#39;)}, akwarg = 10)</span>
<span class="sd">        &gt;&gt;&gt;  )</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # &#39;order_by&#39; some column before the mutate opeation</span>
<span class="sd">        &gt;&gt;&gt; # order_by column &#39;bill_length_mm&#39; before computing cumsum over &#39;year&#39; columns</span>
<span class="sd">        &gt;&gt;&gt; # row order is preserved</span>
<span class="sd">        &gt;&gt;&gt; cumsum_df = (penguins_tidy.select([&#39;year&#39;, &#39;species&#39;, &#39;bill_length_mm&#39;])</span>
<span class="sd">        &gt;&gt;&gt;                           .mutate({&#39;year_cumsum&#39;: (np.cumsum, &#39;year&#39;)},</span>
<span class="sd">        &gt;&gt;&gt;                                   order_by = &#39;bill_length_mm&#39;</span>
<span class="sd">        &gt;&gt;&gt;                                   )</span>
<span class="sd">        &gt;&gt;&gt;                           )</span>
<span class="sd">        &gt;&gt;&gt; cumsum_df</span>
<span class="sd">        &gt;&gt;&gt; # confirm the computation:</span>
<span class="sd">        &gt;&gt;&gt; cumsum_df.arrange(&#39;bill_length_mm&#39;)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # across mode with column names</span>
<span class="sd">        &gt;&gt;&gt; (penguins_tidy.select([&#39;bill_length_mm&#39;, &#39;body_mass_g&#39;])</span>
<span class="sd">        &gt;&gt;&gt;               .mutate(column_names = [&#39;bill_length_mm&#39;, &#39;body_mass_g&#39;]</span>
<span class="sd">        &gt;&gt;&gt;                       , func = lambda x: x - np.mean(x)</span>
<span class="sd">        &gt;&gt;&gt;                       , prefix = &quot;demean_&quot;</span>
<span class="sd">        &gt;&gt;&gt;                       )</span>
<span class="sd">        &gt;&gt;&gt;               )</span>
<span class="sd">        &gt;&gt;&gt;               </span>
<span class="sd">        &gt;&gt;&gt; # grouped across with column names</span>
<span class="sd">        &gt;&gt;&gt; (penguins_tidy.select([&#39;bill_length_mm&#39;, &#39;body_mass_g&#39;, &#39;species&#39;])</span>
<span class="sd">        &gt;&gt;&gt;               .mutate(column_names = [&#39;bill_length_mm&#39;, &#39;body_mass_g&#39;],</span>
<span class="sd">        &gt;&gt;&gt;                       func = lambda x: x - np.mean(x),</span>
<span class="sd">        &gt;&gt;&gt;                       prefix = &quot;demean_&quot;,</span>
<span class="sd">        &gt;&gt;&gt;                       by = &#39;species&#39;</span>
<span class="sd">        &gt;&gt;&gt;                       )</span>
<span class="sd">        &gt;&gt;&gt;               )</span>
<span class="sd">        &gt;&gt;&gt;   </span>
<span class="sd">        &gt;&gt;&gt; # across mode with predicate</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.mutate(func = lambda x: x - np.mean(x),</span>
<span class="sd">        &gt;&gt;&gt;                      predicate = dtypes.is_numeric_dtype,</span>
<span class="sd">        &gt;&gt;&gt;                      prefix = &quot;demean_&quot;</span>
<span class="sd">        &gt;&gt;&gt;                      )</span>
<span class="sd">        &gt;&gt;&gt;   </span>
<span class="sd">        &gt;&gt;&gt; # grouped across with predicate without prefix</span>
<span class="sd">        &gt;&gt;&gt; # this will return a copy with columns changed without changing names</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.mutate(func = lambda x: x - np.mean(x),</span>
<span class="sd">        &gt;&gt;&gt;                      predicate = dtypes.is_numeric_dtype,</span>
<span class="sd">        &gt;&gt;&gt;                      by = &#39;species&#39;</span>
<span class="sd">        &gt;&gt;&gt;                      )</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">dictionary</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">((</span><span class="s2">&quot;Either dictionary or func with &quot;</span>
                             <span class="s2">&quot;predicate/column_names should be provided.&quot;</span>
                            <span class="p">))</span>
        <span class="k">if</span> <span class="n">by</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dictionary</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutate</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="n">order_by</span> <span class="o">=</span> <span class="n">order_by</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutate_across</span><span class="p">(</span><span class="n">func</span>
                                          <span class="p">,</span> <span class="n">column_names</span> <span class="o">=</span> <span class="n">column_names</span>
                                          <span class="p">,</span> <span class="n">predicate</span> <span class="o">=</span> <span class="n">predicate</span>
                                          <span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span>
                                          <span class="p">,</span> <span class="n">order_by</span> <span class="o">=</span> <span class="n">order_by</span>
                                          <span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
                                          <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_by</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
            <span class="n">by</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
            <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>
            
            <span class="k">if</span> <span class="n">dictionary</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                
                <span class="n">keys</span> <span class="o">=</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="n">keys_flattened</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                  <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                    <span class="p">[[</span><span class="n">x</span><span class="p">]</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>
                    <span class="p">)</span>
                  <span class="p">)</span>
                <span class="c1"># keys should not intersect with &#39;by&#39; columns</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">by</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">keys_flattened</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>\
                    <span class="p">(</span><span class="s2">&quot;column names to be created by &#39;mutate&#39; should not &quot;</span>
                     <span class="s2">&quot;intersect with &#39;by&#39; columns&quot;</span>
                     <span class="p">)</span>
                <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_modify</span><span class="p">(</span>
                    <span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">chunk</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">_mutate</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="n">order_by</span> <span class="o">=</span> <span class="n">order_by</span><span class="p">)</span>
                    <span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">by</span>
                    <span class="p">,</span> <span class="n">preserve_row_order</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="p">,</span> <span class="n">row_order_column_name</span> <span class="o">=</span> <span class="n">_generate_new_string</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span>
                    <span class="p">,</span> <span class="n">is_pandas_udf</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
                    <span class="p">)</span>
                <span class="c1"># set the column order</span>
                <span class="c1"># original columns in old order</span>
                <span class="c1"># new column come next in dict order</span>
                <span class="n">col_order</span> <span class="o">=</span> <span class="n">cn</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">setlist</span><span class="p">(</span><span class="n">keys_flattened</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">cn</span><span class="p">))</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">col_order</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_modify</span><span class="p">(</span>
                    <span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">chunk</span><span class="p">:</span> <span class="p">(</span>
                        <span class="n">chunk</span><span class="o">.</span><span class="n">_mutate_across</span><span class="p">(</span><span class="n">func</span>
                                             <span class="p">,</span> <span class="n">column_names</span> <span class="o">=</span> <span class="n">column_names</span>
                                             <span class="p">,</span> <span class="n">predicate</span> <span class="o">=</span> <span class="n">predicate</span>
                                             <span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span>
                                             <span class="p">,</span> <span class="n">order_by</span> <span class="o">=</span> <span class="n">order_by</span>
                                             <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">by</span>
                    <span class="p">,</span> <span class="n">preserve_row_order</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="p">,</span> <span class="n">row_order_column_name</span> <span class="o">=</span> <span class="n">_generate_new_string</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span>
                    <span class="p">,</span> <span class="n">is_pandas_udf</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
                    <span class="p">)</span>
                <span class="c1"># set the column order</span>
                <span class="n">col_order</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">colnames</span>
                <span class="n">col_order</span> <span class="o">=</span> <span class="n">cn</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">setlist</span><span class="p">(</span><span class="n">col_order</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">cn</span><span class="p">))</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">col_order</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">res</span></div>
    
    
    <span class="c1">##########################################################################</span>
    <span class="c1"># summarise</span>
    <span class="c1">##########################################################################</span>
 
<div class="viewcode-block" id="tidyframe._summarise"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe._summarise">[docs]</a>    <span class="k">def</span> <span class="nf">_summarise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dictionary</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrow</span>
        <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>
        <span class="n">summary_dict</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">def</span> <span class="nf">_validate_rhs_val</span><span class="p">(</span><span class="n">akey</span><span class="p">,</span> <span class="n">rhs_val</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">rhs_val</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">rhs_val</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rhs_val</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">rhs_val</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">((</span><span class="sa">f</span><span class="s2">&quot;Summarised value for key </span><span class="si">{</span><span class="n">akey</span><span class="si">}</span><span class="s2"> does not&quot;</span>
                                         <span class="s2">&quot; turn out to be a scalar or cannot be &quot;</span>
                                         <span class="s2">&quot;converted to a scalar&quot;</span><span class="p">)</span>
                                        <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        
        <span class="k">for</span> <span class="n">akey</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="p">:</span>
            
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">akey</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)),</span>\
                <span class="s2">&quot;LHS (dict keys) should be a string or a tuple of strings&quot;</span>
            <span class="k">assert</span> <span class="n">_is_string_or_string_list</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">akey</span><span class="p">)),</span>\
                <span class="s2">&quot;LHS (dict keys) should be a string or a tuple of strings&quot;</span>
            
            <span class="n">rhs</span> <span class="o">=</span> <span class="n">dictionary</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span>
            
            <span class="c1"># akey is a string or a list of strings</span>
            <span class="c1"># no longer a tuple</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">akey</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">akey</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">akey</span> <span class="o">=</span> <span class="n">akey</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">akey</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">akey</span><span class="p">)),</span>\
                        <span class="s2">&quot;LHS should have unique strings&quot;</span>
                    <span class="n">akey</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">akey</span><span class="p">)</span>
         
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">akey</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="c1"># two cases:</span>
                <span class="c1">#   1. assign via function</span>
                <span class="c1">#   2. assign with column args</span>
                
                <span class="c1"># 1. assign via function</span>
                <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rhs</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">rhs</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">_is_kwargable</span><span class="p">(</span><span class="n">rhs</span><span class="p">):</span>
                            <span class="n">rhs_val</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">rhs_val</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">)</span>
                            
                        <span class="n">_validate_rhs_val</span><span class="p">(</span><span class="n">akey</span><span class="p">,</span> <span class="n">rhs_val</span><span class="p">)</span>
                        <span class="n">summary_dict</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhs_val</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rhs</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;lambda x, **kwargs: &quot;</span> <span class="o">+</span> <span class="n">rhs</span><span class="p">)</span>
                        <span class="n">rhs_val</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                        <span class="n">_validate_rhs_val</span><span class="p">(</span><span class="n">akey</span><span class="p">,</span> <span class="n">rhs_val</span><span class="p">)</span>
                        <span class="n">summary_dict</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhs_val</span>
                                 
                <span class="c1"># 2. assign via simple function</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rhs</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">rhs</span> <span class="o">=</span> <span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">akey</span><span class="p">)</span>
                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span>\
                        <span class="sa">f</span><span class="s2">&quot;When RHS is a tuple, RHS should have two elements&quot;</span>
                    <span class="k">assert</span> <span class="n">callable</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">),</span>\
                        <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;When RHS is a tuple, first element of RHS should be &quot;</span>
                         <span class="s2">&quot;a function or a string which can be enclosed in a &quot;</span>
                         <span class="s2">&quot;lambda function and evaluated&quot;</span>
                         <span class="p">)</span>
                    <span class="k">assert</span> <span class="n">_is_string_or_string_list</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>\
                            <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;When RHS is a tuple, the second &quot;</span>
                             <span class="s2">&quot;element should be a string or a list of strings&quot;</span>
                             <span class="p">)</span>
                    <span class="n">cols</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">cn</span><span class="p">),</span>\
                        <span class="sa">f</span><span class="s2">&quot;RHS should contain valid columns for LHS &#39;</span><span class="si">{</span><span class="n">akey</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
                    
                    <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                        <span class="k">if</span> <span class="n">_is_kwargable</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                            <span class="n">rhs_val</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="o">*</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">[</span><span class="n">acol</span><span class="p">]</span> <span class="k">for</span> <span class="n">acol</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">]</span>
                                             <span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
                                             <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">rhs_val</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="o">*</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">[</span><span class="n">acol</span><span class="p">]</span> <span class="k">for</span> <span class="n">acol</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">])</span>
                            
                        <span class="n">_validate_rhs_val</span><span class="p">(</span><span class="n">akey</span><span class="p">,</span> <span class="n">rhs_val</span><span class="p">)</span>
                        <span class="n">summary_dict</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhs_val</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># string case</span>
                        <span class="n">chars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> 
                                     <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
                                     <span class="p">)[:</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)]</span>
                        <span class="n">fun</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">((</span><span class="s2">&quot;lambda &quot;</span> 
                                    <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span> 
                                    <span class="o">+</span> <span class="s2">&quot;, **kwargs: &quot;</span> 
                                    <span class="o">+</span> <span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                    <span class="p">)</span>
                                   <span class="p">)</span>
                      
                        <span class="n">rhs_val</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">[</span><span class="n">acol</span><span class="p">]</span> <span class="k">for</span> <span class="n">acol</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                        <span class="n">_validate_rhs_val</span><span class="p">(</span><span class="n">akey</span><span class="p">,</span> <span class="n">rhs_val</span><span class="p">)</span>
                        <span class="n">summary_dict</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhs_val</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">((</span><span class="sa">f</span><span class="s2">&quot;RHS for key &#39;</span><span class="si">{</span><span class="n">akey</span><span class="si">}</span><span class="s2">&#39; should be in some &quot;</span>
                                     <span class="s2">&quot;standard form&quot;</span>
                                     <span class="p">))</span>
            
            <span class="c1"># multiple assignments</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># 1. assign via function</span>
                <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rhs</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">rhs</span><span class="p">):</span>
                        <span class="n">rhs</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;lambda x, **kwargs: &quot;</span> <span class="o">+</span> <span class="n">rhs</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="n">_is_kwargable</span><span class="p">(</span><span class="n">rhs</span><span class="p">):</span>
                        <span class="n">rhs_val</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rhs_val</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">)</span>
                        
                    <span class="p">[</span><span class="n">_validate_rhs_val</span><span class="p">(</span><span class="n">akey</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rhs_val</span><span class="p">]</span>
                        
                    <span class="k">assert</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">rhs_val</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> 
                            <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rhs_val</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">akey</span><span class="p">)</span>
                            <span class="p">),</span>\
                        <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RHS should output a list of length equal to &quot;</span>
                         <span class="s2">&quot;length of LHS for key: </span><span class="si">{akey}</span><span class="s2">&quot;</span>
                         <span class="p">)</span>
                         
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">akey</span><span class="p">)):</span>
                      <span class="n">summary_dict</span><span class="p">[</span><span class="n">akey</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">rhs_val</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        
                <span class="c1"># 3. assign via simple function</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rhs</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span>\
                        <span class="sa">f</span><span class="s2">&quot;When RHS is a tuple, RHS should have two elements&quot;</span>
                    <span class="k">assert</span> <span class="n">callable</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">),</span>\
                        <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;When RHS is a tuple, first element of RHS should be &quot;</span>
                         <span class="s2">&quot;a function or a string which can be enclosed in a &quot;</span>
                         <span class="s2">&quot;lambda function and evaluated&quot;</span>
                         <span class="p">)</span>
                    <span class="k">assert</span> <span class="n">_is_string_or_string_list</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>\
                            <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;When RHS is a tuple, the second &quot;</span>
                             <span class="s2">&quot;element should be a string or a list of strings&quot;</span>
                             <span class="p">)</span>
                    <span class="n">cols</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">cn</span><span class="p">),</span>\
                        <span class="sa">f</span><span class="s2">&quot;RHS should contain valid columns for LHS &#39;</span><span class="si">{</span><span class="n">akey</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
                    
                    <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                        <span class="k">if</span> <span class="n">_is_kwargable</span><span class="p">(</span><span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                            <span class="n">rhs_val</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="o">*</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">[</span><span class="n">acol</span><span class="p">]</span> <span class="k">for</span> <span class="n">acol</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">]</span>
                                             <span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
                                             <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">rhs_val</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="o">*</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">[</span><span class="n">acol</span><span class="p">]</span> <span class="k">for</span> <span class="n">acol</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">chars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> 
                                     <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
                                     <span class="p">)[:</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)]</span>
                        <span class="n">fun</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">((</span><span class="s2">&quot;lambda &quot;</span> 
                                    <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span> 
                                    <span class="o">+</span> <span class="s2">&quot;, **kwargs: &quot;</span> 
                                    <span class="o">+</span> <span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                    <span class="p">)</span>
                                   <span class="p">)</span>  
                        <span class="n">rhs_val</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">[</span><span class="n">acol</span><span class="p">]</span> <span class="k">for</span> <span class="n">acol</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                        
                    <span class="p">[</span><span class="n">_validate_rhs_val</span><span class="p">(</span><span class="n">akey</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rhs_val</span><span class="p">]</span>
                    
                    <span class="k">assert</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">rhs_val</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> 
                            <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rhs_val</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">akey</span><span class="p">)</span>
                            <span class="p">),</span>\
                        <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RHS should output a list of length equal &quot;</span>
                         <span class="s2">&quot;to length of LHS for key: </span><span class="si">{akey}</span><span class="s2">&quot;</span>
                         <span class="p">)</span>
                         
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">akey</span><span class="p">)):</span>
                      <span class="n">summary_dict</span><span class="p">[</span><span class="n">akey</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">rhs_val</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">((</span><span class="sa">f</span><span class="s2">&quot;RHS for key &#39;</span><span class="si">{</span><span class="n">akey</span><span class="si">}</span><span class="s2">&#39; should be in some &quot;</span>
                                     <span class="s2">&quot;standard form&quot;</span>
                                     <span class="p">))</span>
                                     
        <span class="n">res</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">summary_dict</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></div>
  
<div class="viewcode-block" id="tidyframe.summarise"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.summarise">[docs]</a>    <span class="k">def</span> <span class="nf">summarise</span><span class="p">(</span><span class="bp">self</span>
                  <span class="p">,</span> <span class="n">dictionary</span> <span class="o">=</span> <span class="kc">None</span>
                  <span class="p">,</span> <span class="n">func</span> <span class="o">=</span> <span class="kc">None</span>
                  <span class="p">,</span> <span class="n">column_names</span> <span class="o">=</span> <span class="kc">None</span>
                  <span class="p">,</span> <span class="n">predicate</span> <span class="o">=</span> <span class="kc">None</span>
                  <span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                  <span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="kc">None</span>
                  <span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
                  <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Creates one row per group summarising the input dataframe</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dictionary: dict</span>
<span class="sd">            A dictionary of summarising operations. This supports multiple </span>
<span class="sd">            styles, see the examples</span>
<span class="sd">        func: callable</span>
<span class="sd">            A function to apply on the &#39;column_names&#39; or the columns chosen by</span>
<span class="sd">            the &#39;predicate&#39;. func should return a scalar.</span>
<span class="sd">        column_names: string or a list of strings</span>
<span class="sd">            Names of the columns to apply &#39;func&#39; on</span>
<span class="sd">        predicate: callable</span>
<span class="sd">            A function to choose columns. Input: pandas series, output: bool</span>
<span class="sd">        prefix: string</span>
<span class="sd">            Prefix the resulting summarization column after applying &#39;func&#39;</span>
<span class="sd">        by: string or a list of strings</span>
<span class="sd">            column names to group by</span>
<span class="sd">        **kwargs</span>
<span class="sd">            for lambda functions in dictionary or func</span>
<span class="sd">          </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. When by is None, summarise outputs a single row dataframe.</span>
<span class="sd">        2. summarise function works in two modes:</span>
<span class="sd">            a. dictionary mode: A key should be a resulting column name. Value</span>
<span class="sd">                should be a specification of the summarising operation. See the </span>
<span class="sd">                examples for various sytles.</span>
<span class="sd">            b. across mode: A function is applied across a set of columns or </span>
<span class="sd">                columns selected by a predicate function.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pandas.api.types as dtypes</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # summarise in dict mode</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.summarise({</span>
<span class="sd">        &gt;&gt;&gt;     # using pandas style lambda function</span>
<span class="sd">        &gt;&gt;&gt;     &quot;a_mean&quot;: lambda x: x[&#39;year&#39;].mean(),</span>
<span class="sd">        &gt;&gt;&gt;     </span>
<span class="sd">        &gt;&gt;&gt;     # pass the content of lambda function as a string</span>
<span class="sd">        &gt;&gt;&gt;     &quot;b_mean&quot;: &quot;x[&#39;year&#39;].mean()&quot;,</span>
<span class="sd">        &gt;&gt;&gt;     </span>
<span class="sd">        &gt;&gt;&gt;     # pass a tuple of function and column list</span>
<span class="sd">        &gt;&gt;&gt;     &quot;a_median&quot;: (np.median, &quot;year&quot;),</span>
<span class="sd">        &gt;&gt;&gt;     </span>
<span class="sd">        &gt;&gt;&gt;     # pass a tuple of function to retain same column name</span>
<span class="sd">        &gt;&gt;&gt;     &quot;year&quot;: (np.median, ),</span>
<span class="sd">        &gt;&gt;&gt;     </span>
<span class="sd">        &gt;&gt;&gt;     # pass multiple columns as a string</span>
<span class="sd">        &gt;&gt;&gt;     &quot;x_plus_y_mean&quot;: (&quot;np.mean(x + y)&quot;, [&quot;bill_length_mm&quot;, &quot;bill_depth_mm&quot;]),</span>
<span class="sd">        &gt;&gt;&gt;     </span>
<span class="sd">        &gt;&gt;&gt;     # output multiple columns as a list (pandas style)</span>
<span class="sd">        &gt;&gt;&gt;     (&#39;x&#39;, &#39;y&#39;): lambda x: list(np.quantile(x[&#39;year&#39;], [0.25, 0.75])),</span>
<span class="sd">        &gt;&gt;&gt;     </span>
<span class="sd">        &gt;&gt;&gt;     # same as above in string style</span>
<span class="sd">        &gt;&gt;&gt;     (&#39;x2&#39;, &#39;y2&#39;): &quot;list(np.quantile(x[&#39;year&#39;], [0.25, 0.75]))&quot;,</span>
<span class="sd">        &gt;&gt;&gt;     </span>
<span class="sd">        &gt;&gt;&gt;     # tuple style with multiple output</span>
<span class="sd">        &gt;&gt;&gt;     (&#39;A&#39;, &#39;B&#39;): (&quot;[np.mean(x + y), np.mean(x - y)]&quot;</span>
<span class="sd">        &gt;&gt;&gt;                  , [&quot;bill_length_mm&quot;, &quot;bill_depth_mm&quot;]</span>
<span class="sd">        &gt;&gt;&gt;                  )</span>
<span class="sd">        &gt;&gt;&gt;     })</span>
<span class="sd">        &gt;&gt;&gt;     </span>
<span class="sd">        &gt;&gt;&gt; # grouped summarise in dict mode</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.summarise({&quot;a_mean&quot;: (np.mean, &#39;year&#39;)},</span>
<span class="sd">        &gt;&gt;&gt;                         by = [&#39;species&#39;, &#39;sex&#39;]</span>
<span class="sd">        &gt;&gt;&gt;                         )</span>
<span class="sd">        &gt;&gt;&gt;                         </span>
<span class="sd">        &gt;&gt;&gt; # use kwargs</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.summarise(</span>
<span class="sd">        &gt;&gt;&gt;   {&quot;a_mean&quot;: lambda x, **kwargs: x[&#39;year&#39;].mean() + kwargs[&#39;leap&#39;]},</span>
<span class="sd">        &gt;&gt;&gt;   by = [&#39;species&#39;, &#39;sex&#39;],</span>
<span class="sd">        &gt;&gt;&gt;   leap = 4</span>
<span class="sd">        &gt;&gt;&gt;   )</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # equivalently:</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.summarise(</span>
<span class="sd">        &gt;&gt;&gt;   {&quot;a_mean&quot;: &quot;x[&#39;year&#39;].mean() + kwargs[&#39;leap&#39;]&quot;},</span>
<span class="sd">        &gt;&gt;&gt;   by = [&#39;species&#39;, &#39;sex&#39;],</span>
<span class="sd">        &gt;&gt;&gt;   leap = 4</span>
<span class="sd">        &gt;&gt;&gt;   )</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # across mode with column names</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.summarise(</span>
<span class="sd">        &gt;&gt;&gt;   func = np.mean,</span>
<span class="sd">        &gt;&gt;&gt;   column_names = [&#39;bill_length_mm&#39;, &#39;bill_depth_mm&#39;]</span>
<span class="sd">        &gt;&gt;&gt;   )</span>
<span class="sd">        &gt;&gt;&gt;   </span>
<span class="sd">        &gt;&gt;&gt; # across mode with predicate</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.summarise(</span>
<span class="sd">        &gt;&gt;&gt;   func = np.mean,</span>
<span class="sd">        &gt;&gt;&gt;   predicate = dtypes.is_numeric_dtype,</span>
<span class="sd">        &gt;&gt;&gt;   prefix = &quot;avg_&quot;</span>
<span class="sd">        &gt;&gt;&gt;   )</span>
<span class="sd">        &gt;&gt;&gt;   </span>
<span class="sd">        &gt;&gt;&gt; # grouped across with predicate</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.summarise(</span>
<span class="sd">        &gt;&gt;&gt;   func = np.mean,</span>
<span class="sd">        &gt;&gt;&gt;   predicate = dtypes.is_numeric_dtype,</span>
<span class="sd">        &gt;&gt;&gt;   prefix = &quot;avg_&quot;,</span>
<span class="sd">        &gt;&gt;&gt;   by = [&#39;species&#39;, &#39;sex&#39;]</span>
<span class="sd">        &gt;&gt;&gt;   )</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="n">dictionary</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">((</span><span class="s2">&quot;Either dictionary or func with &quot;</span>
                             <span class="s2">&quot;predicate/column_names should be provided&quot;</span>
                            <span class="p">))</span>
        
        <span class="c1"># assertions for across case                    </span>
        <span class="k">if</span> <span class="n">dictionary</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">callable</span><span class="p">(</span><span class="n">func</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>\
                <span class="p">(</span><span class="s2">&quot;arg &#39;func&#39; should be a function or a string which is convertible &quot;</span>
                 <span class="s2">&quot;to a lambda function&quot;</span>
                 <span class="p">)</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">column_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">predicate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">((</span><span class="s2">&quot;Exactly one among &#39;column_names&#39; and &#39;predicate&#39; &quot;</span>
                                 <span class="s2">&quot;should be None&quot;</span><span class="p">)</span>
                                 <span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">column_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">predicate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Exactly one among &#39;column_names&#39; and &#39;predicate&#39; &quot;</span>
                                <span class="s2">&quot;should be None&quot;</span>
                                <span class="p">)</span>
            
            <span class="c1"># use column_names</span>
            <span class="k">if</span> <span class="n">column_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_validate_column_names</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span>
                <span class="n">column_names</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span>
            <span class="c1"># use predicate to assign appropriate column_names</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">predicate</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">))</span>
                <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">]),</span>\
                    <span class="s2">&quot;predicate should return a boolean per column&quot;</span>
                <span class="n">column_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">func</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;lambda x, **kwargs: &quot;</span> <span class="o">+</span> <span class="n">func</span><span class="p">)</span>
            <span class="n">prefixed_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">]</span>
            
        <span class="c1"># simple summarise</span>
        <span class="k">if</span> <span class="n">by</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dictionary</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summarise</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">[</span><span class="n">column_names</span><span class="p">]</span>
                           <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                           <span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
                           <span class="o">.</span><span class="n">T</span>
                           <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">column_names</span><span class="p">,</span> <span class="n">prefixed_names</span><span class="p">)))</span>
                           <span class="p">)</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_by</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
            <span class="n">by</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
            <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>
            
            <span class="k">if</span> <span class="n">dictionary</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># agg column names should not intersect with by columns</span>
                <span class="n">keys</span> <span class="o">=</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="n">keys_flattened</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                  <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                    <span class="p">[[</span><span class="n">x</span><span class="p">]</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>
                    <span class="p">)</span>
                  <span class="p">)</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">by</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">keys_flattened</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>\
                    <span class="p">(</span><span class="s2">&quot;column names to be created by &#39;summarise&#39; should not &quot;</span>
                     <span class="s2">&quot;intersect with &#39;by&#39; columns&quot;</span>
                     <span class="p">)</span>
                <span class="c1"># special case to bypass _summarise when the agg is over a </span>
                <span class="c1"># single column</span>
                <span class="n">dv</span> <span class="o">=</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> 
                <span class="n">special_case</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dv</span><span class="p">]):</span>
                    <span class="c1"># cover these: </span>
                    <span class="c1"># {&#39;new_col&#39;: (np.mean, &#39;col&#39;)}</span>
                    <span class="c1"># {&#39;col&#39;: (np.mean, )}</span>
                    <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">_enlist</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dv</span><span class="p">]):</span>
                        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">callable</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dv</span><span class="p">]):</span>
                            <span class="n">special_case</span> <span class="o">=</span> <span class="kc">True</span>
                
                <span class="k">if</span> <span class="n">special_case</span><span class="p">:</span>
                    <span class="k">def</span> <span class="nf">create_summary</span><span class="p">(</span><span class="n">anitem</span><span class="p">):</span>
                        <span class="c1"># case: {&#39;col&#39;: (np.mean, )}</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">anitem</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                                       <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="p">,</span> <span class="n">dropna</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)[</span><span class="n">anitem</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                                       <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">anitem</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                                       <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
                                       <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># case: {&#39;new_col&#39;: (np.mean, &#39;col&#39;)}</span>
                            <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                                       <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="p">,</span> <span class="n">dropna</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)[</span><span class="n">anitem</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
                                       <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">anitem</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                                       <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
                                       <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="n">anitem</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span> <span class="n">anitem</span><span class="p">[</span><span class="mi">0</span><span class="p">]})</span>
                                       <span class="p">)</span>
                        <span class="k">return</span> <span class="n">res</span>
                      
                    <span class="n">aggs</span> <span class="o">=</span> <span class="p">[</span><span class="n">create_summary</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">aggs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">res</span> <span class="o">=</span> <span class="n">aggs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">res</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">:</span> <span class="n">df1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="n">by</span><span class="p">)</span>
                                               <span class="p">,</span> <span class="n">aggs</span>
                                               <span class="p">)</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span> <span class="c1"># regular case</span>
                    <span class="n">lam</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">chunk</span><span class="p">:</span> <span class="n">chunk</span><span class="o">.</span><span class="n">_summarise</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_modify</span><span class="p">(</span><span class="n">func</span> <span class="o">=</span> <span class="n">lam</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">by</span><span class="p">)</span>
                    
                <span class="c1"># set the column order</span>
                <span class="c1"># by columns come first</span>
                <span class="c1"># aggreagated columns come next</span>
                <span class="n">col_order</span> <span class="o">=</span> <span class="n">by</span> <span class="o">+</span> <span class="n">keys_flattened</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">col_order</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rowid_name</span> <span class="o">=</span> <span class="n">_generate_new_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span>
                <span class="n">group_mapper</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
                                    <span class="o">.</span><span class="n">add_row_number</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">rowid_name</span><span class="p">)</span>
                                    <span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
                                    <span class="p">)</span>
                <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                           <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">group_mapper</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="n">by</span><span class="p">)</span>
                           <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">by</span><span class="p">)</span>
                           <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">rowid_name</span><span class="p">,</span> <span class="n">dropna</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)[</span><span class="n">column_names</span><span class="p">]</span>
                           <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                           <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
                           <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">group_mapper</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="n">rowid_name</span><span class="p">)</span>
                           <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">rowid_name</span><span class="p">)</span>
                           <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">column_names</span><span class="p">,</span> <span class="n">prefixed_names</span><span class="p">)))</span>
                           <span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">by</span> <span class="o">+</span> <span class="n">prefixed_names</span><span class="p">]</span>
                           <span class="p">)</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>          
                <span class="c1"># column order is set with &#39;by&#39; column in the begining</span>

        <span class="k">return</span> <span class="n">res</span></div>
    
    <span class="n">summarize</span> <span class="o">=</span> <span class="n">summarise</span>
    
    <span class="c1">##########################################################################</span>
    <span class="c1"># Joins</span>
    <span class="c1">##########################################################################</span>
    
    <span class="c1"># validate join args</span>
<div class="viewcode-block" id="tidyframe._validate_join"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe._validate_join">[docs]</a>    <span class="k">def</span> <span class="nf">_validate_join</span><span class="p">(</span><span class="bp">self</span>
                       <span class="p">,</span> <span class="n">y</span>
                       <span class="p">,</span> <span class="n">how</span>
                       <span class="p">,</span> <span class="n">on</span>
                       <span class="p">,</span> <span class="n">on_x</span>
                       <span class="p">,</span> <span class="n">on_y</span>
                       <span class="p">,</span> <span class="n">sort</span>
                       <span class="p">,</span> <span class="n">suffix_y</span>
                       <span class="p">):</span>
                           
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">tidyframe</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;y&#39; should be a tidy pandas dataframe&quot;</span>
        
        <span class="n">cn_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>
        <span class="n">cn_y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">colnames</span>
        
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">how</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;how&#39; should be a string&quot;</span>
        <span class="k">assert</span> <span class="n">how</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="s1">&#39;outer&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">],</span>\
            <span class="s2">&quot;arg &#39;how&#39; should be one among: &#39;inner&#39;, &#39;outer&#39;, &#39;left&#39;, &#39;right&#39;&quot;</span>
        
        <span class="k">if</span> <span class="n">on</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">on_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">on_y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>\
                <span class="p">(</span><span class="s2">&quot;When arg &#39;on&#39; is None, &quot;</span> 
                 <span class="s2">&quot;both args&#39;on_x&#39; and &#39;on_y&#39; should not be None&quot;</span>
                 <span class="p">)</span>
            <span class="k">assert</span> <span class="n">_is_string_or_string_list</span><span class="p">(</span><span class="n">on_x</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;on_x&#39; should be a string or a list of strings&quot;</span>
            <span class="k">assert</span> <span class="n">_is_string_or_string_list</span><span class="p">(</span><span class="n">on_y</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;on_y&#39; should be a string or a list of strings&quot;</span>
            
            <span class="n">on_x</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">on_x</span><span class="p">)</span>
            <span class="n">on_y</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">on_y</span><span class="p">)</span>
            
            <span class="k">assert</span> <span class="n">_is_unique_list</span><span class="p">(</span><span class="n">on_x</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;on_x&#39; should not have duplicates&quot;</span>
            <span class="k">assert</span> <span class="n">_is_unique_list</span><span class="p">(</span><span class="n">on_y</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;on_y&#39; should not have duplicates&quot;</span>    
            <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">on_x</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">cn_x</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;on_x&#39; should be a subset of column names of x&quot;</span>
            <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">on_y</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">cn_y</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;on_y&#39; should be a subset of column names of y&quot;</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">on_x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">on_y</span><span class="p">),</span>\
                <span class="s2">&quot;Lengths of arg &#39;on_x&#39; and arg &#39;on_y&#39; should match&quot;</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># on is provided</span>
            <span class="k">assert</span> <span class="n">on_x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">on_y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span>\
                <span class="p">(</span><span class="s2">&quot;When arg &#39;on&#39; is not None, &quot;</span> 
                 <span class="s2">&quot;both args&#39;on_x&#39; and &#39;on_y&#39; should be None&quot;</span>
                 <span class="p">)</span>
            <span class="k">assert</span> <span class="n">_is_string_or_string_list</span><span class="p">(</span><span class="n">on</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;on&#39; should be a string or a list of strings&quot;</span>
            <span class="n">on</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">on</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">_is_unique_list</span><span class="p">(</span><span class="n">on</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;on&#39; should not have duplicates&quot;</span>
            <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">on</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">cn_x</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;on&#39; should be a subset of column names of x&quot;</span>
            <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">on</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">cn_y</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;on&#39; should be a subset of column names of y&quot;</span>
        
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">suffix_y</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;suffix_y&#39; should be a string&quot;</span>
            
        <span class="k">assert</span> <span class="n">suffix_y</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>\
            <span class="s2">&quot;arg &#39;suffix_y&#39; should be a non-empty string&quot;</span>
            
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sort</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;sort&#39; should be a boolean&quot;</span>
        
        <span class="k">return</span> <span class="kc">None</span></div>
        
    <span class="c1"># join methods</span>
<div class="viewcode-block" id="tidyframe._join"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe._join">[docs]</a>    <span class="k">def</span> <span class="nf">_join</span><span class="p">(</span><span class="bp">self</span>
              <span class="p">,</span> <span class="n">y</span>
              <span class="p">,</span> <span class="n">how</span>
              <span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="kc">None</span>
              <span class="p">,</span> <span class="n">on_x</span> <span class="o">=</span> <span class="kc">None</span>
              <span class="p">,</span> <span class="n">on_y</span> <span class="o">=</span> <span class="kc">None</span>
              <span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">True</span>
              <span class="p">,</span> <span class="n">suffix_y</span> <span class="o">=</span> <span class="s2">&quot;_y&quot;</span>
              <span class="p">,</span> <span class="n">validate</span> <span class="o">=</span> <span class="kc">True</span>
              <span class="p">):</span>
        
        <span class="k">if</span> <span class="n">validate</span><span class="p">:</span>               
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_join</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
                                <span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="n">how</span>
                                <span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="n">on</span>
                                <span class="p">,</span> <span class="n">on_x</span> <span class="o">=</span> <span class="n">on_x</span>
                                <span class="p">,</span> <span class="n">on_y</span> <span class="o">=</span> <span class="n">on_y</span>
                                <span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="n">sort</span>
                                <span class="p">,</span> <span class="n">suffix_y</span> <span class="o">=</span> <span class="n">suffix_y</span>
                                <span class="p">)</span>
        
        <span class="n">cn_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>
        <span class="n">cn_y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">colnames</span>
        <span class="n">nr_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrow</span>
        <span class="n">nr_y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">nrow</span>
        
        <span class="c1"># degenerate case</span>
        <span class="k">if</span> <span class="n">on</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">on_x</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">on_x</span><span class="p">)</span>
            <span class="n">on_y</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">on_y</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">on_x</span> <span class="o">==</span> <span class="n">on_y</span><span class="p">:</span>
                <span class="n">on</span> <span class="o">=</span> <span class="n">util_copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">on_x</span><span class="p">)</span>
                <span class="n">on_x</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">on_y</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="k">if</span> <span class="n">on</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">on_x</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">on_x</span><span class="p">)</span>
            <span class="n">on_y</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">on_y</span><span class="p">)</span>
            <span class="n">new_colnames</span> <span class="o">=</span> <span class="n">cn_x</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">setlist</span><span class="p">(</span><span class="n">cn_y</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">on_y</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">on</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">on</span><span class="p">)</span>
            <span class="n">new_colnames</span> <span class="o">=</span> <span class="n">cn_x</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">setlist</span><span class="p">(</span><span class="n">cn_y</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">on</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">sort</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">on</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span>
                       <span class="o">.</span><span class="n">__data</span>
                       <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;__rn_x&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nr_x</span><span class="p">)})</span>
                       <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">right</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                                        <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;__rn_y&quot;</span><span class="p">:</span> <span class="n">nr_y</span><span class="p">})</span>
                                        <span class="p">)</span>
                              <span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="n">how</span>
                              <span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="n">on</span>
                              <span class="p">,</span> <span class="n">left_index</span> <span class="o">=</span> <span class="kc">False</span>
                              <span class="p">,</span> <span class="n">right_index</span> <span class="o">=</span> <span class="kc">False</span>
                              <span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">False</span>
                              <span class="p">,</span> <span class="n">suffixes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">suffix_y</span><span class="p">]</span>
                              <span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">True</span>
                              <span class="p">,</span> <span class="n">indicator</span> <span class="o">=</span> <span class="kc">False</span>
                              <span class="p">,</span> <span class="n">validate</span> <span class="o">=</span> <span class="kc">None</span>
                              <span class="p">)</span>
                       <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;__rn_x&quot;</span><span class="p">,</span> <span class="s2">&quot;__rn_y&quot;</span><span class="p">]</span>
                                    <span class="p">,</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span>
                                    <span class="p">)</span>
                       <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;__rn_x&quot;</span><span class="p">,</span> <span class="s2">&quot;__rn_y&quot;</span><span class="p">])</span>
                       <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span>
                       <span class="o">.</span><span class="n">__data</span>
                       <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;__rn_x&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nr_x</span><span class="p">)})</span>
                       <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">right</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                                        <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;__rn_y&quot;</span><span class="p">:</span> <span class="n">nr_y</span><span class="p">})</span>
                                        <span class="p">)</span>
                              <span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="n">how</span>
                              <span class="p">,</span> <span class="n">left_on</span> <span class="o">=</span> <span class="n">on_x</span>
                              <span class="p">,</span> <span class="n">right_on</span> <span class="o">=</span> <span class="n">on_y</span>
                              <span class="p">,</span> <span class="n">left_index</span> <span class="o">=</span> <span class="kc">False</span>
                              <span class="p">,</span> <span class="n">right_index</span> <span class="o">=</span> <span class="kc">False</span>
                              <span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">False</span>
                              <span class="p">,</span> <span class="n">suffixes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">suffix_y</span><span class="p">]</span>
                              <span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">True</span>
                              <span class="p">,</span> <span class="n">indicator</span> <span class="o">=</span> <span class="kc">False</span>
                              <span class="p">,</span> <span class="n">validate</span> <span class="o">=</span> <span class="kc">None</span>
                              <span class="p">)</span>
                       <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;__rn_x&quot;</span><span class="p">,</span> <span class="s2">&quot;__rn_y&quot;</span><span class="p">]</span>
                                    <span class="p">,</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span>
                                    <span class="p">)</span>
                       <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;__rn_x&quot;</span><span class="p">,</span> <span class="s2">&quot;__rn_y&quot;</span><span class="p">])</span>
                       <span class="p">)</span>
                <span class="c1"># remove the right keys</span>
                <span class="n">on_y_with_suffix</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="n">suffix_y</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">on_y</span><span class="p">]</span>
                <span class="n">right_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">on_y_with_suffix</span><span class="p">)</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">right_keys</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">on</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span>
                       <span class="o">.</span><span class="n">__data</span>
                       <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">right</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                              <span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="n">how</span>
                              <span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="n">on</span>
                              <span class="p">,</span> <span class="n">left_index</span> <span class="o">=</span> <span class="kc">False</span>
                              <span class="p">,</span> <span class="n">right_index</span> <span class="o">=</span> <span class="kc">False</span>
                              <span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">False</span>
                              <span class="p">,</span> <span class="n">suffixes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">suffix_y</span><span class="p">]</span>
                              <span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">True</span>
                              <span class="p">,</span> <span class="n">indicator</span> <span class="o">=</span> <span class="kc">False</span>
                              <span class="p">,</span> <span class="n">validate</span> <span class="o">=</span> <span class="kc">None</span>
                              <span class="p">)</span>
                       <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span>
                       <span class="o">.</span><span class="n">__data</span>
                       <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">right</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                              <span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="n">how</span>
                              <span class="p">,</span> <span class="n">left_on</span> <span class="o">=</span> <span class="n">on_x</span>
                              <span class="p">,</span> <span class="n">right_on</span> <span class="o">=</span> <span class="n">on_y</span>
                              <span class="p">,</span> <span class="n">left_index</span> <span class="o">=</span> <span class="kc">False</span>
                              <span class="p">,</span> <span class="n">right_index</span> <span class="o">=</span> <span class="kc">False</span>
                              <span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">False</span>
                              <span class="p">,</span> <span class="n">suffixes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">suffix_y</span><span class="p">]</span>
                              <span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">True</span>
                              <span class="p">,</span> <span class="n">indicator</span> <span class="o">=</span> <span class="kc">False</span>
                              <span class="p">,</span> <span class="n">validate</span> <span class="o">=</span> <span class="kc">None</span>
                              <span class="p">)</span>
                       <span class="p">)</span>
                <span class="c1"># remove the right keys</span>
                <span class="n">on_y_with_suffix</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="n">suffix_y</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">on_y</span><span class="p">]</span>
                <span class="n">right_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">on_y_with_suffix</span><span class="p">)</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">right_keys</span><span class="p">)</span>
        
        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">tidyframe</span><span class="p">(</span><span class="n">res</span>
                         <span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span>
                         <span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span>
                         <span class="p">)</span>
                <span class="o">.</span><span class="n">relocate</span><span class="p">(</span><span class="n">cn_x</span><span class="p">)</span>
                <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">res</span></div>
        
<div class="viewcode-block" id="tidyframe.inner_join"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.inner_join">[docs]</a>    <span class="k">def</span> <span class="nf">inner_join</span><span class="p">(</span><span class="bp">self</span>
                   <span class="p">,</span> <span class="n">y</span>
                   <span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="kc">None</span>
                   <span class="p">,</span> <span class="n">on_x</span> <span class="o">=</span> <span class="kc">None</span>
                   <span class="p">,</span> <span class="n">on_y</span> <span class="o">=</span> <span class="kc">None</span>
                   <span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">True</span>
                   <span class="p">,</span> <span class="n">suffix_y</span> <span class="o">=</span> <span class="s2">&quot;_y&quot;</span>
                   <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Joins columns of y to self by matching rows</span>
<span class="sd">        Includes only matching keys</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        y: tidyframe</span>
<span class="sd">        on: string or a list of strings</span>
<span class="sd">            Common column names to match</span>
<span class="sd">        on_x:</span>
<span class="sd">            Column names of self to be matched with arg &#39;on_y&#39;</span>
<span class="sd">        on_y:</span>
<span class="sd">            Column names of y to be matched with arg &#39;on_x&#39;</span>
<span class="sd">        sort: bool</span>
<span class="sd">            Whether to sort by row order of self and row order of y</span>
<span class="sd">        suffix_y: string</span>
<span class="sd">            suffix to append the columns of y which have same names as self&#39;s </span>
<span class="sd">            column names</span>
<span class="sd">          </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. Column names of self will not have a suffix.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy_s1 = (penguins_tidy.tail(n = 1, by = &#39;species&#39;)</span>
<span class="sd">        &gt;&gt;&gt;                                  .select([&#39;species&#39;, &#39;bill_length_mm&#39;, &#39;island&#39;])</span>
<span class="sd">        &gt;&gt;&gt;                                  )</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy_s2 = (penguins_tidy.head(n = 1, by = &#39;species&#39;)</span>
<span class="sd">        &gt;&gt;&gt;                                  .select([&#39;species&#39;, &#39;island&#39;, &#39;bill_depth_mm&#39;])</span>
<span class="sd">        &gt;&gt;&gt;                                  )</span>
<span class="sd">        &gt;&gt;&gt;                                  </span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy_s1.inner_join(penguins_tidy_s2, on = &#39;island&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
                       
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_join</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
                        <span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s2">&quot;inner&quot;</span>
                        <span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="n">on</span>
                        <span class="p">,</span> <span class="n">on_x</span> <span class="o">=</span> <span class="n">on_x</span>
                        <span class="p">,</span> <span class="n">on_y</span> <span class="o">=</span> <span class="n">on_y</span>
                        <span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="n">sort</span>
                        <span class="p">,</span> <span class="n">suffix_y</span> <span class="o">=</span> <span class="n">suffix_y</span>
                        <span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div>
    
    
<div class="viewcode-block" id="tidyframe.outer_join"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.outer_join">[docs]</a>    <span class="k">def</span> <span class="nf">outer_join</span><span class="p">(</span><span class="bp">self</span>
                   <span class="p">,</span> <span class="n">y</span>
                   <span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="kc">None</span>
                   <span class="p">,</span> <span class="n">on_x</span> <span class="o">=</span> <span class="kc">None</span>
                   <span class="p">,</span> <span class="n">on_y</span> <span class="o">=</span> <span class="kc">None</span>
                   <span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">True</span>
                   <span class="p">,</span> <span class="n">suffix_y</span> <span class="o">=</span> <span class="s2">&quot;_y&quot;</span>
                   <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Joins columns of y to self by matching rows</span>
<span class="sd">        Includes all keys</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        y: tidyframe</span>
<span class="sd">        on: string or a list of strings</span>
<span class="sd">            Common column names to match</span>
<span class="sd">        on_x:</span>
<span class="sd">            Column names of self to be matched with arg &#39;on_y&#39;</span>
<span class="sd">        on_y:</span>
<span class="sd">            Column names of y to be matched with arg &#39;on_x&#39;</span>
<span class="sd">        sort: bool</span>
<span class="sd">            Whether to sort by row order of self and row order of y</span>
<span class="sd">        suffix_y: string</span>
<span class="sd">            suffix to append the columns of y which have same names as self&#39;s </span>
<span class="sd">            column names</span>
<span class="sd">          </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. Column names of self will not have a suffix.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy_s1 = (penguins_tidy.tail(n = 1, by = &#39;species&#39;)</span>
<span class="sd">        &gt;&gt;&gt;                                  .select([&#39;species&#39;, &#39;bill_length_mm&#39;, &#39;island&#39;])</span>
<span class="sd">        &gt;&gt;&gt;                                  )</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy_s2 = (penguins_tidy.head(n = 1, by = &#39;species&#39;)</span>
<span class="sd">        &gt;&gt;&gt;                                  .select([&#39;species&#39;, &#39;island&#39;, &#39;bill_depth_mm&#39;])</span>
<span class="sd">        &gt;&gt;&gt;                                  )</span>
<span class="sd">        &gt;&gt;&gt;                     </span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy_s1.outer_join(penguins_tidy_s2, on = &#39;island&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>               
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_join</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
                        <span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s2">&quot;outer&quot;</span>
                        <span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="n">on</span>
                        <span class="p">,</span> <span class="n">on_x</span> <span class="o">=</span> <span class="n">on_x</span>
                        <span class="p">,</span> <span class="n">on_y</span> <span class="o">=</span> <span class="n">on_y</span>
                        <span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="n">sort</span>
                        <span class="p">,</span> <span class="n">suffix_y</span> <span class="o">=</span> <span class="n">suffix_y</span>
                        <span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div>
    
    <span class="n">full_join</span> <span class="o">=</span> <span class="n">outer_join</span>
        
<div class="viewcode-block" id="tidyframe.left_join"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.left_join">[docs]</a>    <span class="k">def</span> <span class="nf">left_join</span><span class="p">(</span><span class="bp">self</span>
                   <span class="p">,</span> <span class="n">y</span>
                   <span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="kc">None</span>
                   <span class="p">,</span> <span class="n">on_x</span> <span class="o">=</span> <span class="kc">None</span>
                   <span class="p">,</span> <span class="n">on_y</span> <span class="o">=</span> <span class="kc">None</span>
                   <span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">True</span>
                   <span class="p">,</span> <span class="n">suffix_y</span> <span class="o">=</span> <span class="s2">&quot;_y&quot;</span>
                   <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Joins columns of y to self by matching rows</span>
<span class="sd">        Includes all keys in self</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        y: tidyframe</span>
<span class="sd">        on: string or a list of strings</span>
<span class="sd">            Common column names to match</span>
<span class="sd">        on_x:</span>
<span class="sd">            Column names of self to be matched with arg &#39;on_y&#39;</span>
<span class="sd">        on_y:</span>
<span class="sd">            Column names of y to be matched with arg &#39;on_x&#39;</span>
<span class="sd">        sort: bool</span>
<span class="sd">            Whether to sort by row order of self and row order of y</span>
<span class="sd">        suffix_y: string</span>
<span class="sd">            suffix to append the columns of y which have same names as self&#39;s </span>
<span class="sd">            column names</span>
<span class="sd">          </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. Column names of self will not have a suffix.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy_s1 = (penguins_tidy.tail(n = 1, by = &#39;species&#39;)</span>
<span class="sd">        &gt;&gt;&gt;                                  .select([&#39;species&#39;, &#39;bill_length_mm&#39;, &#39;island&#39;])</span>
<span class="sd">        &gt;&gt;&gt;                                  )</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy_s2 = (penguins_tidy.head(n = 1, by = &#39;species&#39;)</span>
<span class="sd">        &gt;&gt;&gt;                                  .select([&#39;species&#39;, &#39;island&#39;, &#39;bill_depth_mm&#39;])</span>
<span class="sd">        &gt;&gt;&gt;                                  )</span>
<span class="sd">        &gt;&gt;&gt;                                  </span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy_s1.left_join(penguins_tidy_s2, on = &#39;island&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>               
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_join</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
                        <span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span>
                        <span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="n">on</span>
                        <span class="p">,</span> <span class="n">on_x</span> <span class="o">=</span> <span class="n">on_x</span>
                        <span class="p">,</span> <span class="n">on_y</span> <span class="o">=</span> <span class="n">on_y</span>
                        <span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="n">sort</span>
                        <span class="p">,</span> <span class="n">suffix_y</span> <span class="o">=</span> <span class="n">suffix_y</span>
                        <span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div>
        
<div class="viewcode-block" id="tidyframe.right_join"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.right_join">[docs]</a>    <span class="k">def</span> <span class="nf">right_join</span><span class="p">(</span><span class="bp">self</span>
                   <span class="p">,</span> <span class="n">y</span>
                   <span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="kc">None</span>
                   <span class="p">,</span> <span class="n">on_x</span> <span class="o">=</span> <span class="kc">None</span>
                   <span class="p">,</span> <span class="n">on_y</span> <span class="o">=</span> <span class="kc">None</span>
                   <span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">True</span>
                   <span class="p">,</span> <span class="n">suffix_y</span> <span class="o">=</span> <span class="s2">&quot;_y&quot;</span>
                   <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Joins columns of y to self by matching rows</span>
<span class="sd">        Includes all keys in y</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        y: tidyframe</span>
<span class="sd">        on: string or a list of strings</span>
<span class="sd">            Common column names to match</span>
<span class="sd">        on_x:</span>
<span class="sd">            Column names of self to be matched with arg &#39;on_y&#39;</span>
<span class="sd">        on_y:</span>
<span class="sd">            Column names of y to be matched with arg &#39;on_x&#39;</span>
<span class="sd">        sort: bool</span>
<span class="sd">            Whether to sort by row order of self and row order of y</span>
<span class="sd">        suffix_y: string</span>
<span class="sd">            suffix to append the columns of y which have same names as self&#39;s </span>
<span class="sd">            column names</span>
<span class="sd">          </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. Column names of self will not have a suffix.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy_s1 = (penguins_tidy.tail(n = 1, by = &#39;species&#39;)</span>
<span class="sd">        &gt;&gt;&gt;                                  .select([&#39;species&#39;, &#39;bill_length_mm&#39;, &#39;island&#39;])</span>
<span class="sd">        &gt;&gt;&gt;                                  )</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy_s2 = (penguins_tidy.head(n = 1, by = &#39;species&#39;)</span>
<span class="sd">        &gt;&gt;&gt;                                  .select([&#39;species&#39;, &#39;island&#39;, &#39;bill_depth_mm&#39;])</span>
<span class="sd">        &gt;&gt;&gt;                                  )</span>
<span class="sd">        &gt;&gt;&gt;                                  </span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy_s1.right_join(penguins_tidy_s2, on = &#39;island&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>               
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_join</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
                        <span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s2">&quot;right&quot;</span>
                        <span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="n">on</span>
                        <span class="p">,</span> <span class="n">on_x</span> <span class="o">=</span> <span class="n">on_x</span>
                        <span class="p">,</span> <span class="n">on_y</span> <span class="o">=</span> <span class="n">on_y</span>
                        <span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="n">sort</span>
                        <span class="p">,</span> <span class="n">suffix_y</span> <span class="o">=</span> <span class="n">suffix_y</span>
                        <span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div>
    
    <span class="c1"># row of A which match B</span>
<div class="viewcode-block" id="tidyframe.semi_join"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.semi_join">[docs]</a>    <span class="k">def</span> <span class="nf">semi_join</span><span class="p">(</span><span class="bp">self</span>
                   <span class="p">,</span> <span class="n">y</span>
                   <span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="kc">None</span>
                   <span class="p">,</span> <span class="n">on_x</span> <span class="o">=</span> <span class="kc">None</span>
                   <span class="p">,</span> <span class="n">on_y</span> <span class="o">=</span> <span class="kc">None</span>
                   <span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">True</span>
                   <span class="p">,</span> <span class="n">suffix_y</span> <span class="o">=</span> <span class="s2">&quot;_y&quot;</span>
                   <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Joins columns of y to self by matching rows</span>
<span class="sd">        Includes keys in self if present in y</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        y: tidyframe</span>
<span class="sd">        on: string or a list of strings</span>
<span class="sd">            Common column names to match</span>
<span class="sd">        on_x:</span>
<span class="sd">            Column names of self to be matched with arg &#39;on_y&#39;</span>
<span class="sd">        on_y:</span>
<span class="sd">            Column names of y to be matched with arg &#39;on_x&#39;</span>
<span class="sd">        sort: bool</span>
<span class="sd">            Whether to sort by row order of self and row order of y</span>
<span class="sd">        suffix_y: string</span>
<span class="sd">            suffix to append the columns of y which have same names as self&#39;s </span>
<span class="sd">            column names</span>
<span class="sd">          </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. Column names of self will not have a suffix.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy_s1 = (penguins_tidy.tail(n = 1, by = &#39;species&#39;)</span>
<span class="sd">        &gt;&gt;&gt;                                  .select([&#39;species&#39;, &#39;bill_length_mm&#39;, &#39;island&#39;])</span>
<span class="sd">        &gt;&gt;&gt;                                  )</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy_s2 = (penguins_tidy.head(n = 1, by = &#39;species&#39;)</span>
<span class="sd">        &gt;&gt;&gt;                                  .select([&#39;species&#39;, &#39;island&#39;, &#39;bill_depth_mm&#39;])</span>
<span class="sd">        &gt;&gt;&gt;                                  )</span>
<span class="sd">        &gt;&gt;&gt;                                  </span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy_s2.semi_join(penguins_tidy_s1, on = &#39;island&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_join</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
                            <span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s2">&quot;inner&quot;</span> <span class="c1"># this has no significance</span>
                            <span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="n">on</span>
                            <span class="p">,</span> <span class="n">on_x</span> <span class="o">=</span> <span class="n">on_x</span>
                            <span class="p">,</span> <span class="n">on_y</span> <span class="o">=</span> <span class="n">on_y</span>
                            <span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="n">sort</span>
                            <span class="p">,</span> <span class="n">suffix_y</span> <span class="o">=</span> <span class="n">suffix_y</span>
                            <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">on</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="n">on_y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="n">on</span><span class="p">)</span>
        
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_join</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">y2</span>
                         <span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s2">&quot;inner&quot;</span>
                         <span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="n">on</span>
                         <span class="p">,</span> <span class="n">on_x</span> <span class="o">=</span> <span class="n">on_x</span>
                         <span class="p">,</span> <span class="n">on_y</span> <span class="o">=</span> <span class="n">on_y</span>
                         <span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="n">sort</span>
                         <span class="p">,</span> <span class="n">suffix_y</span> <span class="o">=</span> <span class="n">suffix_y</span>
                         <span class="p">,</span> <span class="n">validate</span> <span class="o">=</span> <span class="kc">False</span>
                         <span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div>
    
    <span class="c1"># rows of A that do not match B</span>
<div class="viewcode-block" id="tidyframe.anti_join"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.anti_join">[docs]</a>    <span class="k">def</span> <span class="nf">anti_join</span><span class="p">(</span><span class="bp">self</span>
                   <span class="p">,</span> <span class="n">y</span>
                   <span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="kc">None</span>
                   <span class="p">,</span> <span class="n">on_x</span> <span class="o">=</span> <span class="kc">None</span>
                   <span class="p">,</span> <span class="n">on_y</span> <span class="o">=</span> <span class="kc">None</span>
                   <span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">True</span>
                   <span class="p">,</span> <span class="n">suffix_y</span> <span class="o">=</span> <span class="s2">&quot;_y&quot;</span>
                   <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Joins columns of y to self by matching rows</span>
<span class="sd">        Includes keys in self if not present in y</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        y: tidyframe</span>
<span class="sd">        on: string or a list of strings</span>
<span class="sd">            Common column names to match</span>
<span class="sd">        on_x:</span>
<span class="sd">            Column names of self to be matched with arg &#39;on_y&#39;</span>
<span class="sd">        on_y:</span>
<span class="sd">            Column names of y to be matched with arg &#39;on_x&#39;</span>
<span class="sd">        sort: bool</span>
<span class="sd">            Whether to sort by row order of self and row order of y</span>
<span class="sd">        suffix_y: string</span>
<span class="sd">            suffix to append the columns of y which have same names as self&#39;s </span>
<span class="sd">            column names</span>
<span class="sd">          </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. Column names of self will not have a suffix.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy_s1 = (penguins_tidy.tail(n = 1, by = &#39;species&#39;)</span>
<span class="sd">        &gt;&gt;&gt;                                  .select([&#39;species&#39;, &#39;bill_length_mm&#39;, &#39;island&#39;])</span>
<span class="sd">        &gt;&gt;&gt;                                  )</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy_s2 = (penguins_tidy.head(n = 1, by = &#39;species&#39;)</span>
<span class="sd">        &gt;&gt;&gt;                                  .select([&#39;species&#39;, &#39;island&#39;, &#39;bill_depth_mm&#39;])</span>
<span class="sd">        &gt;&gt;&gt;                                  )</span>
<span class="sd">        &gt;&gt;&gt;                                  </span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy_s2.anti_join(penguins_tidy_s1, on = &#39;island&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_join</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
                            <span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s2">&quot;inner&quot;</span> <span class="c1"># not significant</span>
                            <span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="n">on</span>
                            <span class="p">,</span> <span class="n">on_x</span> <span class="o">=</span> <span class="n">on_x</span>
                            <span class="p">,</span> <span class="n">on_y</span> <span class="o">=</span> <span class="n">on_y</span>
                            <span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="n">sort</span>
                            <span class="p">,</span> <span class="n">suffix_y</span> <span class="o">=</span> <span class="n">suffix_y</span>
                            <span class="p">)</span>
        
        <span class="n">string</span> <span class="o">=</span> <span class="n">_generate_new_string</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">on</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">on_value</span> <span class="o">=</span> <span class="n">on_y</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">on_value</span> <span class="o">=</span> <span class="n">on</span>
            
        <span class="n">res</span> <span class="o">=</span>  <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_join</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="n">on_value</span><span class="p">)</span><span class="o">.</span><span class="n">add_row_number</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">string</span><span class="p">)</span>
                           <span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span>
                           <span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="n">on</span>
                           <span class="p">,</span> <span class="n">on_x</span> <span class="o">=</span> <span class="n">on_x</span>
                           <span class="p">,</span> <span class="n">on_y</span> <span class="o">=</span> <span class="n">on_y</span>
                           <span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="n">sort</span>
                           <span class="p">,</span> <span class="n">suffix_y</span> <span class="o">=</span> <span class="n">suffix_y</span>
                           <span class="p">,</span> <span class="n">validate</span> <span class="o">=</span> <span class="kc">False</span>
                           <span class="p">)</span>
                    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">())</span>
                    <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">include</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                    <span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div>
    
    <span class="c1"># cross join</span>
<div class="viewcode-block" id="tidyframe.cross_join"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.cross_join">[docs]</a>    <span class="k">def</span> <span class="nf">cross_join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">suffix_y</span> <span class="o">=</span> <span class="s2">&quot;_y&quot;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Joins columns of y to self by matching rows</span>
<span class="sd">        Includes all cartersian product</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        y: tidyframe</span>
<span class="sd">        sort: bool</span>
<span class="sd">            Whether to sort by row order of self and row order of y</span>
<span class="sd">        suffix_y: string</span>
<span class="sd">            suffix to append the columns of y which have same names as self&#39;s </span>
<span class="sd">            column names</span>
<span class="sd">          </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. Column names of self will not have a suffix.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy_s1 = (penguins_tidy.tail(n = 1, by = &#39;species&#39;)</span>
<span class="sd">        &gt;&gt;&gt;                                  .select([&#39;species&#39;, &#39;bill_length_mm&#39;, &#39;island&#39;])</span>
<span class="sd">        &gt;&gt;&gt;                                  )</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy_s2 = (penguins_tidy.head(n = 1, by = &#39;species&#39;)</span>
<span class="sd">        &gt;&gt;&gt;                                  .select([&#39;species&#39;, &#39;island&#39;, &#39;bill_depth_mm&#39;])</span>
<span class="sd">        &gt;&gt;&gt;                                  )</span>
<span class="sd">        &gt;&gt;&gt;                                  </span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy_s2.cross_join(penguins_tidy_s1)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">tidyframe</span><span class="p">),</span>\
          <span class="s2">&quot;arg &#39;y&#39; should be a tidyframe&quot;</span>
          
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sort</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span>\
          <span class="s2">&quot;arg &#39;sort&#39; should be a bool&quot;</span>
        
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">suffix_y</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>\
          <span class="s2">&quot;arg &#39;suffix_y&#39; should be a string&quot;</span>
        
        <span class="k">assert</span> <span class="n">suffix_y</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>\
          <span class="s2">&quot;arg &#39;suffix_y&#39; should not be an empty string&quot;</span>
        
        <span class="k">if</span> <span class="n">sort</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                                 <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;__rn_x&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])})</span>
                                 <span class="p">)</span>
                            <span class="p">,</span> <span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                                <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;__rn_y&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])}))</span>
                            <span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s2">&quot;cross&quot;</span>
                            <span class="p">,</span> <span class="n">left_index</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="p">,</span> <span class="n">right_index</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="p">,</span> <span class="n">suffixes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">suffix_y</span><span class="p">]</span>
                            <span class="p">)</span>
                     <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;__rn_x&quot;</span><span class="p">,</span> <span class="s2">&quot;__rn_y&quot;</span><span class="p">]</span>
                                  <span class="p">,</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span>
                                  <span class="p">)</span>
                     <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;__rn_x&quot;</span><span class="p">,</span> <span class="s2">&quot;__rn_y&quot;</span><span class="p">])</span>
                     <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  
            <span class="n">res</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                           <span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                           <span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s2">&quot;cross&quot;</span>
                           <span class="p">,</span> <span class="n">left_index</span> <span class="o">=</span> <span class="kc">False</span>
                           <span class="p">,</span> <span class="n">right_index</span> <span class="o">=</span> <span class="kc">False</span>
                           <span class="p">,</span> <span class="n">suffixes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">suffix_y</span><span class="p">]</span>
                           <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></div>
    
    <span class="c1">##########################################################################</span>
    <span class="c1"># bind methods</span>
    <span class="c1">##########################################################################  </span>
      
<div class="viewcode-block" id="tidyframe.cbind"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.cbind">[docs]</a>    <span class="k">def</span> <span class="nf">cbind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        bind columns of y to self</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        y: a tidyframe with same number of rows</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. The tidyframe to be binded should same same number of rows.</span>
<span class="sd">        2. Column names of the tidyframe should be different from self.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; (penguins_tidy.select([&#39;species&#39;, &#39;island&#39;])</span>
<span class="sd">        &gt;&gt;&gt;               .cbind(penguins_tidy.select([&#39;bill_length_mm&#39;, &#39;bill_depth_mm&#39;]))</span>
<span class="sd">        &gt;&gt;&gt;               )</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">tidyframe</span><span class="p">)</span>
        <span class="c1"># column names should differ</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">colnames</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>\
            <span class="s2">&quot;Column names among the dataframes should not be common. Did you intend to `cross_join` instead of `cbind`?&quot;</span>
                <span class="c1"># number of rows should match</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrow</span> <span class="o">==</span> <span class="n">y</span><span class="o">.</span><span class="n">nrow</span><span class="p">,</span>\
            <span class="s2">&quot;Both dataframes should have same number of rows&quot;</span>
            
        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)]</span>
                        <span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="p">,</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># not to loose column names</span>
                        <span class="p">)</span>
                 <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                 <span class="p">)</span>
        <span class="k">return</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">res</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="tidyframe.rbind"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.rbind">[docs]</a>    <span class="k">def</span> <span class="nf">rbind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        bind rows of y to self</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        y: a tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. Result will have union of column names of self and y.</span>
<span class="sd">        2. Missing values are created when a column name is present in one</span>
<span class="sd">           dataframe and not in the other.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; (penguins_tidy.select([&#39;species&#39;, &#39;island&#39;])</span>
<span class="sd">        &gt;&gt;&gt;               .rbind(penguins_tidy.select([&#39;island&#39;, &#39;bill_length_mm&#39;, &#39;bill_depth_mm&#39;]))</span>
<span class="sd">        &gt;&gt;&gt;               )</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()]</span>
                         <span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span>
                         <span class="p">,</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span>
                         <span class="p">)</span>
                 <span class="p">)</span>
        <span class="k">return</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">res</span><span class="p">)</span></div>
    
    <span class="c1">##########################################################################</span>
    <span class="c1"># count and add_count</span>
    <span class="c1">##########################################################################</span>
    
<div class="viewcode-block" id="tidyframe.count"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.count">[docs]</a>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span>
              <span class="p">,</span> <span class="n">column_names</span> <span class="o">=</span> <span class="kc">None</span>
              <span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;n&#39;</span>
              <span class="p">,</span> <span class="n">decreasing</span> <span class="o">=</span> <span class="kc">True</span>
              <span class="p">,</span> <span class="n">wt</span> <span class="o">=</span> <span class="kc">None</span>
              <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        count rows by groups</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        column_names: None or string or a list of strings</span>
<span class="sd">            Column names to groupby before counting the rows. </span>
<span class="sd">            When None, counts all rows.</span>
<span class="sd">        name: string (default: &#39;n&#39;)</span>
<span class="sd">            Column name of the resulting count column</span>
<span class="sd">        decreasing: bool (default is True)</span>
<span class="sd">            Whether to sort the result in descending order of the count column</span>
<span class="sd">        wt: None or string</span>
<span class="sd">            When a string, should be a column name with numeric dtype. </span>
<span class="sd">            When wt is None, rows are counted.</span>
<span class="sd">            When wt is present, then wt column is summed up.</span>
<span class="sd">            </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # count rows</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.count()</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # count number of rows of &#39;sex&#39; column</span>
<span class="sd">        &gt;&gt;&gt; # count column is always ordered in descending order unless decreasing is False</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.count(&#39;sex&#39;, name = &quot;cnt&quot;)</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.count(&#39;sex&#39;, name = &quot;cnt&quot;, decreasing = False)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # sum up a column (weighted sum of rows)</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.count([&#39;sex&#39;, &#39;species&#39;], wt = &#39;year&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">assert</span> <span class="p">(</span><span class="n">column_names</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">or</span> <span class="n">_is_string_or_string_list</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span>
                <span class="p">),</span>\
            <span class="s2">&quot;arg &#39;column_names&#39; is either None or a list of strings&quot;</span>
        <span class="k">if</span> <span class="n">column_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_column_names</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;name&#39; should a string&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">decreasing</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;decreasing&#39; should be a boolean&quot;</span>
        <span class="k">if</span> <span class="n">wt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wt</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;wt&#39; should be a string&quot;</span>
            <span class="k">assert</span> <span class="n">wt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">,</span>\
                <span class="sa">f</span><span class="s2">&quot;&#39;wt&#39; column &#39;</span><span class="si">{</span><span class="n">wt</span><span class="si">}</span><span class="s2">&#39; should be a valid column name&quot;</span>
            <span class="k">assert</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_numeric_dtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pull</span><span class="p">(</span><span class="n">wt</span><span class="p">)),</span>\
                <span class="sa">f</span><span class="s2">&quot;&#39;wt&#39; column &#39;</span><span class="si">{</span><span class="n">wt</span><span class="si">}</span><span class="s2">&#39; should be of numeric dtype&quot;</span>
        
        <span class="k">if</span> <span class="n">decreasing</span><span class="p">:</span>
          <span class="n">sort_str</span> <span class="o">=</span> <span class="s2">&quot;desc&quot;</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">sort_str</span> <span class="o">=</span> <span class="s2">&quot;asc&quot;</span>
        
        <span class="k">if</span> <span class="n">column_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;name&#39; should be a string&quot;</span>
            <span class="k">assert</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">,</span>\
                <span class="p">(</span><span class="s2">&quot;arg &#39;name&#39; should not be an element of arg &quot;</span>
                 <span class="s2">&quot;&#39;column_names&#39;&quot;</span>
                 <span class="p">)</span>
            
            <span class="k">if</span> <span class="n">wt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                           <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">column_names</span>
                                    <span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">False</span>
                                    <span class="p">,</span> <span class="n">dropna</span> <span class="o">=</span> <span class="kc">False</span>
                                    <span class="p">)</span>
                           <span class="o">.</span><span class="n">size</span><span class="p">()</span>
                           <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                           <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">name</span><span class="p">})</span>
                           <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="n">name</span>
                                        <span class="p">,</span> <span class="n">axis</span>         <span class="o">=</span> <span class="mi">0</span>
                                        <span class="p">,</span> <span class="n">ascending</span>    <span class="o">=</span> <span class="p">(</span><span class="ow">not</span> <span class="n">decreasing</span><span class="p">)</span>
                                        <span class="p">,</span> <span class="n">inplace</span>      <span class="o">=</span> <span class="kc">False</span>
                                        <span class="p">,</span> <span class="n">kind</span>         <span class="o">=</span> <span class="s1">&#39;quicksort&#39;</span>
                                        <span class="p">,</span> <span class="n">na_position</span>  <span class="o">=</span> <span class="s1">&#39;first&#39;</span>
                                        <span class="p">,</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span>
                                        <span class="p">)</span>
                           <span class="p">)</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">summarise</span><span class="p">(</span>
                              <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">,</span> <span class="n">wt</span><span class="p">)}</span>
                               <span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">column_names</span>
                               <span class="p">,</span> <span class="n">wt</span> <span class="o">=</span> <span class="n">wt</span>
                               <span class="p">)</span>
                           <span class="o">.</span><span class="n">arrange</span><span class="p">([(</span><span class="n">name</span><span class="p">,</span> <span class="n">sort_str</span><span class="p">)])</span>
                           <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># column_names is None</span>
            <span class="k">if</span> <span class="n">wt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">name</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrow</span><span class="p">}</span>
                                   <span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                   <span class="p">)</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">summarise</span><span class="p">({</span><span class="n">name</span><span class="p">:</span> <span class="s2">&quot;np.sum(x[kwargs[&#39;wt&#39;]])&quot;</span><span class="p">}</span>
                                     <span class="p">,</span> <span class="n">wt</span> <span class="o">=</span> <span class="n">wt</span>
                                     <span class="p">)</span>
              
        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="tidyframe.add_count"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.add_count">[docs]</a>    <span class="k">def</span> <span class="nf">add_count</span><span class="p">(</span><span class="bp">self</span>
                  <span class="p">,</span> <span class="n">column_names</span> <span class="o">=</span> <span class="kc">None</span>
                  <span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;n&#39;</span>
                  <span class="p">,</span> <span class="n">wt</span> <span class="o">=</span> <span class="kc">None</span>
                  <span class="p">):</span>
        
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        adds counts of rows by groups as a column</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        column_names: None or string or a list of strings</span>
<span class="sd">            Column names to groupby before counting the rows. </span>
<span class="sd">            When None, counts all rows.</span>
<span class="sd">        name: string (default: &#39;n&#39;)</span>
<span class="sd">            Column name of the resulting count column</span>
<span class="sd">        wt: None or string</span>
<span class="sd">            When a string, should be a column name with numeric dtype. </span>
<span class="sd">            When wt is None, rows are counted.</span>
<span class="sd">            When wt is present, then wt column is summed up.</span>
<span class="sd">            </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # count rows</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.add_count()</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # count number of rows of &#39;sex&#39; column</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.add_count(&#39;sex&#39;, name = &quot;cnt&quot;)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # sum up a column (weighted sum of rows)</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.add_count([&#39;sex&#39;, &#39;species&#39;], wt = &#39;year&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="n">column_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;name&#39; should be a string&quot;</span>
            <span class="k">assert</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">,</span>\
                <span class="s2">&quot;arg &#39;name&#39; should not be an existing column name&quot;</span>
        
        <span class="n">count_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">column_names</span> <span class="o">=</span> <span class="n">column_names</span>
                                 <span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
                                 <span class="p">,</span> <span class="n">wt</span> <span class="o">=</span> <span class="n">wt</span>
                                 <span class="p">)</span>
                                 
        <span class="k">if</span> <span class="n">column_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">count_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">count_frame</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutate</span><span class="p">({</span><span class="n">name</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">count_value</span><span class="p">)})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_join</span><span class="p">(</span><span class="n">count_frame</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="n">column_names</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">res</span></div>
    
    <span class="c1"># pivot methods</span>
<div class="viewcode-block" id="tidyframe.pivot_wider"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.pivot_wider">[docs]</a>    <span class="k">def</span> <span class="nf">pivot_wider</span><span class="p">(</span><span class="bp">self</span>
                    <span class="p">,</span> <span class="n">names_from</span>
                    <span class="p">,</span> <span class="n">values_from</span>
                    <span class="p">,</span> <span class="n">values_fill</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="p">,</span> <span class="n">values_fn</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="p">,</span> <span class="n">id_cols</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;__&quot;</span>
                    <span class="p">,</span> <span class="n">names_prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Pivot data from long to wide</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        names_from: string or list of strings</span>
<span class="sd">            column names whose unique combinations are expected to become column</span>
<span class="sd">            new names in the result</span>
<span class="sd">        </span>
<span class="sd">        values_from: string or list of strings</span>
<span class="sd">            column names to fill the new columns with</span>
<span class="sd">        </span>
<span class="sd">        values_fill: scalar (default is None)</span>
<span class="sd">            A value to fill the missing values with</span>
<span class="sd">            When None, missing values are left as-is</span>
<span class="sd">        </span>
<span class="sd">        values_fn: function or a dict of functions (default is None)</span>
<span class="sd">            A function to handle multiple values per row in the result.</span>
<span class="sd">            When a dict, keys should be same as arg &#39;values_from&#39;</span>
<span class="sd">            When None, multiple values are in kept a list and a single value is</span>
<span class="sd">            not kept in a list (will be a scalar)</span>
<span class="sd">        </span>
<span class="sd">        id_cols: string or list of strings, default is None</span>
<span class="sd">            Names of the columns that should uniquely identify an observation </span>
<span class="sd">            (row) after widening (columns of the original dataframe that are</span>
<span class="sd">            supposed to stay put)</span>
<span class="sd">            </span>
<span class="sd">        sep: string</span>
<span class="sd">            seperator to use while creating resulting column names</span>
<span class="sd">            </span>
<span class="sd">        names_prefix: string</span>
<span class="sd">            prefix for new columns</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # generic widening leads to list-columns</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.pivot_wider(id_cols       = &quot;island&quot;</span>
<span class="sd">        &gt;&gt;&gt;                           , names_from  = &quot;sex&quot;</span>
<span class="sd">        &gt;&gt;&gt;                           , values_from = &quot;bill_length_mm&quot;</span>
<span class="sd">        &gt;&gt;&gt;                           )</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # aggregate with a function</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.pivot_wider(id_cols       = &quot;island&quot;</span>
<span class="sd">        &gt;&gt;&gt;                           , names_from  = &quot;sex&quot;</span>
<span class="sd">        &gt;&gt;&gt;                           , values_from = &quot;bill_length_mm&quot;</span>
<span class="sd">        &gt;&gt;&gt;                           , values_fn   = np.mean</span>
<span class="sd">        &gt;&gt;&gt;                           )</span>
<span class="sd">        &gt;&gt;&gt;                           </span>
<span class="sd">        &gt;&gt;&gt; # choose different aggregation logic for value_from columns</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.pivot_wider(</span>
<span class="sd">        &gt;&gt;&gt;   id_cols       = &quot;island&quot;</span>
<span class="sd">        &gt;&gt;&gt;   , names_from  = &quot;species&quot;</span>
<span class="sd">        &gt;&gt;&gt;   , values_from = [&quot;bill_length_mm&quot;, &quot;bill_depth_mm&quot;]</span>
<span class="sd">        &gt;&gt;&gt;   , values_fn   = {&quot;bill_length_mm&quot; : np.mean, &quot;bill_depth_mm&quot; : list}</span>
<span class="sd">        &gt;&gt;&gt;   )</span>
<span class="sd">        &gt;&gt;&gt;                           </span>
<span class="sd">        &gt;&gt;&gt; # aggregate with almost any function</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.pivot_wider(</span>
<span class="sd">        &gt;&gt;&gt;   id_cols       = &quot;island&quot;</span>
<span class="sd">        &gt;&gt;&gt;   , names_from  = &quot;species&quot;</span>
<span class="sd">        &gt;&gt;&gt;   , values_from = &quot;sex&quot;</span>
<span class="sd">        &gt;&gt;&gt;   , values_fn   = lambda x: dict(pd.Series(x).value_counts())</span>
<span class="sd">        &gt;&gt;&gt;   )</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # All three inputs: &#39;id_cols&#39;, &#39;names_from&#39;, &#39;values_from&#39; can be lists</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.pivot_wider(</span>
<span class="sd">        &gt;&gt;&gt;     id_cols       = [&quot;island&quot;, &quot;sex&quot;]</span>
<span class="sd">        &gt;&gt;&gt;     , names_from  = &quot;species&quot;</span>
<span class="sd">        &gt;&gt;&gt;     , values_from = &quot;bill_length_mm&quot;</span>
<span class="sd">        &gt;&gt;&gt;     )</span>
<span class="sd">        &gt;&gt;&gt;                           </span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.pivot_wider(</span>
<span class="sd">        &gt;&gt;&gt;     id_cols       = [&quot;island&quot;, &quot;sex&quot;]</span>
<span class="sd">        &gt;&gt;&gt;     , names_from  = &quot;species&quot;</span>
<span class="sd">        &gt;&gt;&gt;     , values_from = [&quot;bill_length_mm&quot;, &quot;bill_depth_mm&quot;]</span>
<span class="sd">        &gt;&gt;&gt;     )</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.pivot_wider(id_cols       = [&quot;island&quot;, &quot;sex&quot;]</span>
<span class="sd">        &gt;&gt;&gt;                           , names_from  = [&quot;species&quot;, &quot;year&quot;]</span>
<span class="sd">        &gt;&gt;&gt;                           , values_from = &quot;bill_length_mm&quot;</span>
<span class="sd">        &gt;&gt;&gt;                           )</span>
<span class="sd">        &gt;&gt;&gt;                           </span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.pivot_wider(</span>
<span class="sd">        &gt;&gt;&gt;     id_cols       = [&quot;island&quot;, &quot;sex&quot;]</span>
<span class="sd">        &gt;&gt;&gt;     , names_from  = [&quot;species&quot;, &quot;year&quot;]</span>
<span class="sd">        &gt;&gt;&gt;     , values_from = [&quot;bill_length_mm&quot;, &quot;bill_depth_mm&quot;]</span>
<span class="sd">        &gt;&gt;&gt;     )</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # when id_cols is empty, all columns except the columns from</span>
<span class="sd">        &gt;&gt;&gt; # `names_from` and `values_from` are considered as id_cols</span>
<span class="sd">        &gt;&gt;&gt; (penguins_tidy</span>
<span class="sd">        &gt;&gt;&gt;  .select([&#39;flipper_length_mm&#39;, &#39;body_mass_g&#39;], include = False)</span>
<span class="sd">        &gt;&gt;&gt;  .pivot_wider(names_from    = [&quot;species&quot;, &quot;year&quot;]</span>
<span class="sd">        &gt;&gt;&gt;               , values_from = [&quot;bill_length_mm&quot;, &quot;bill_depth_mm&quot;]</span>
<span class="sd">        &gt;&gt;&gt;               )</span>
<span class="sd">        &gt;&gt;&gt;  )</span>
<span class="sd">        &gt;&gt;&gt;                           </span>
<span class="sd">        &gt;&gt;&gt; # fill the missing values with something</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.pivot_wider(id_cols       = &quot;island&quot;</span>
<span class="sd">        &gt;&gt;&gt;                           , names_from  = &quot;species&quot;</span>
<span class="sd">        &gt;&gt;&gt;                           , values_from = &quot;bill_length_mm&quot;</span>
<span class="sd">        &gt;&gt;&gt;                           , values_fn   = np.mean</span>
<span class="sd">        &gt;&gt;&gt;                           , values_fill = 0</span>
<span class="sd">        &gt;&gt;&gt;                           )</span>
<span class="sd">        &gt;&gt;&gt; # use some prefix for new columns</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.pivot_wider(id_cols       = &quot;island&quot;</span>
<span class="sd">        &gt;&gt;&gt;                           , names_from  = &quot;sex&quot;</span>
<span class="sd">        &gt;&gt;&gt;                           , values_from = &quot;bill_length_mm&quot;</span>
<span class="sd">        &gt;&gt;&gt;                           , names_prefix = &quot;gender_&quot;</span>
<span class="sd">        &gt;&gt;&gt;                           )</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>
        
        <span class="k">assert</span> <span class="n">_is_string_or_string_list</span><span class="p">(</span><span class="n">names_from</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;names_from&#39; should be string or a list of strings&quot;</span>
        <span class="n">names_from</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">names_from</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">_is_unique_list</span><span class="p">(</span><span class="n">names_from</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;names_from&#39; should have unique strings&quot;</span>
        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">names_from</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">cn</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;names_from&#39; should be a subset of existing column names&quot;</span>
        
        <span class="k">assert</span> <span class="n">_is_string_or_string_list</span><span class="p">(</span><span class="n">values_from</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;values_from&#39; should be string or a list of strings&quot;</span>
        <span class="n">values_from</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">values_from</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">values_from</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">cn</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;names_from&#39; should have unique strings&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">values_from</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">names_from</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>\
            <span class="p">(</span><span class="s2">&quot;arg &#39;names_from&#39; and &#39;values_from&#39; should not &quot;</span>
             <span class="s2">&quot;have common column names&quot;</span>
             <span class="p">)</span>
        <span class="n">names_values_from</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">values_from</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">names_from</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">id_cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">id_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">names_values_from</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">id_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="p">(</span><span class="s2">&quot;&#39;id_cols&#39; is turning out to be empty. Choose the &quot;</span>
                     <span class="s2">&quot;&#39;names_from&#39; and &#39;values_from&#39; appropriately or specify &quot;</span>
                     <span class="s2">&quot;&#39;id_cols&#39; explicitly.&quot;</span>
                     <span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&#39;id_cols&#39; chosen: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">id_cols</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">_is_string_or_string_list</span><span class="p">(</span><span class="n">id_cols</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;id_cols&#39; should be string or a list of strings&quot;</span>
            <span class="n">id_cols</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">id_cols</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">_is_unique_list</span><span class="p">(</span><span class="n">id_cols</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;id_cols&#39; should have unique strings&quot;</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">id_cols</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">names_values_from</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>\
                <span class="p">(</span><span class="s2">&quot;arg &#39;id_cols&#39; should not have common names with either &quot;</span>
                 <span class="s2">&quot;&#39;names_from&#39; or &#39;values_from&#39;&quot;</span>
                 <span class="p">)</span>
        <span class="k">if</span> <span class="n">values_fill</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">values_fill</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;values_fill&#39; should be a scalar&quot;</span>
        
        <span class="k">assert</span> <span class="p">(</span><span class="n">values_fn</span> <span class="ow">is</span> <span class="kc">None</span> 
                <span class="ow">or</span> <span class="n">callable</span><span class="p">(</span><span class="n">values_fn</span><span class="p">)</span> 
                <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values_fn</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)),</span>\
            <span class="s2">&quot;When not None, arg &#39;values_fn&#39; should be a callable or dict&quot;</span>
        
        <span class="k">if</span> <span class="n">values_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="k">def</span> <span class="nf">unlist_scalar</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">x</span>
            
            <span class="n">values_fn</span> <span class="o">=</span> <span class="n">unlist_scalar</span>
            
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values_fn</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values_fn</span><span class="p">,</span> <span class="nb">dict</span><span class="p">),</span>\
                <span class="p">(</span><span class="s2">&quot;When arg &#39;values_fn&#39; is not a scalar, it should either be &quot;</span>
                 <span class="s2">&quot;a dict&quot;</span>
                 <span class="p">)</span>
            <span class="n">keys_fn</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">values_fn</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">values_from</span><span class="p">)</span> <span class="o">==</span> <span class="n">keys_fn</span><span class="p">,</span>\
                <span class="p">(</span><span class="s2">&quot;When arg &#39;values_fn&#39; is a dict, keys should match &quot;</span>
                 <span class="s2">&quot;arg &#39;values_from&#39;&quot;</span>
                 <span class="p">)</span>
            <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">callable</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">values_fn</span><span class="o">.</span><span class="n">values</span><span class="p">()]),</span>\
                <span class="s2">&quot;When arg &#39;values_fn&#39; is a dict, values should be functions&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;sep&#39; should be a string&quot;</span>
            
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">names_prefix</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;names_prefix&#39; should be a string without spaces&quot;</span>
        <span class="k">assert</span> <span class="s1">&#39; &#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">names_prefix</span><span class="p">,</span>\
            <span class="s2">&quot;arg &#39;names_prefix&#39; should be a string without spaces&quot;</span>
        
        <span class="c1"># make values_from a scalar if it is</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values_from</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">values_from</span> <span class="o">=</span> <span class="n">values_from</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># core pivoting logic</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">data</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                             <span class="p">,</span> <span class="n">index</span>      <span class="o">=</span> <span class="n">id_cols</span>
                             <span class="p">,</span> <span class="n">columns</span>    <span class="o">=</span> <span class="n">names_from</span>
                             <span class="p">,</span> <span class="n">values</span>     <span class="o">=</span> <span class="n">values_from</span>
                             <span class="p">,</span> <span class="n">fill_value</span> <span class="o">=</span> <span class="n">values_fill</span>
                             <span class="p">,</span> <span class="n">aggfunc</span>    <span class="o">=</span> <span class="n">values_fn</span>
                             <span class="p">,</span> <span class="n">margins</span>    <span class="o">=</span> <span class="kc">False</span>
                             <span class="p">,</span> <span class="n">dropna</span>     <span class="o">=</span> <span class="kc">False</span>
                             <span class="p">,</span> <span class="n">observed</span>   <span class="o">=</span> <span class="kc">True</span>
                             <span class="p">)</span>
        
        <span class="n">res</span> <span class="o">=</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">simplify</span><span class="p">(</span><span class="n">res</span><span class="p">),</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        
        <span class="c1"># add names prefix</span>
        <span class="k">if</span> <span class="n">names_prefix</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">org_cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>
            <span class="n">new_cn</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">colnames</span>
            <span class="n">fresh_cn</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">new_cn</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">org_cn</span><span class="p">))</span>
            <span class="n">fresh_cn_prefixed</span> <span class="o">=</span> <span class="p">[</span><span class="n">names_prefix</span> <span class="o">+</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fresh_cn</span><span class="p">]</span>
            <span class="n">dict_for_renaming</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">fresh_cn</span><span class="p">,</span> <span class="n">fresh_cn_prefixed</span><span class="p">))</span>
            
            <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">dict_for_renaming</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">res</span></div>
            
    <span class="c1">###########################################################################</span>
    <span class="c1"># pivot_longer</span>
    <span class="c1">###########################################################################</span>
    
<div class="viewcode-block" id="tidyframe.pivot_longer"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.pivot_longer">[docs]</a>    <span class="k">def</span> <span class="nf">pivot_longer</span><span class="p">(</span><span class="bp">self</span>
                     <span class="p">,</span> <span class="n">cols</span>
                     <span class="p">,</span> <span class="n">names_to</span> <span class="o">=</span> <span class="s2">&quot;name&quot;</span>
                     <span class="p">,</span> <span class="n">values_to</span> <span class="o">=</span> <span class="s2">&quot;value&quot;</span>
                     <span class="p">,</span> <span class="n">include</span> <span class="o">=</span> <span class="kc">True</span>
                     <span class="p">,</span> <span class="n">values_drop_na</span> <span class="o">=</span> <span class="kc">False</span>
                     <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Pivot from wide to long</span>
<span class="sd">        aka melt</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cols: list of strings</span>
<span class="sd">          Column names to be melted.</span>
<span class="sd">          The dtypes of the columns should match.</span>
<span class="sd">          Leftover columns are considered as &#39;id&#39; columns.</span>
<span class="sd">          When include is False, &#39;cols&#39; refers to leftover columns.</span>
<span class="sd">        names_to: string (default: &#39;name&#39;)</span>
<span class="sd">          Name of the resulting column which will hold the names of the columns</span>
<span class="sd">          to be melted</span>
<span class="sd">        values_to: string (default: &#39;value&#39;)</span>
<span class="sd">          Name of the resulting column which will hold the values of the columns</span>
<span class="sd">          to be melted</span>
<span class="sd">        include: bool</span>
<span class="sd">          If True, cols are used to melt. Else, cols are considered as &#39;id&#39;</span>
<span class="sd">          columns</span>
<span class="sd">        values_drop_na: bool</span>
<span class="sd">          Whether to drop the rows corresponding to missing value in the result</span>
<span class="sd">          </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # pivot to bring values from columns ending with &#39;mm&#39;</span>
<span class="sd">        &gt;&gt;&gt; cns = [&#39;species&#39;</span>
<span class="sd">        &gt;&gt;&gt;        , &#39;bill_length_mm&#39;</span>
<span class="sd">        &gt;&gt;&gt;        , &#39;bill_depth_mm&#39;</span>
<span class="sd">        &gt;&gt;&gt;        , &#39;flipper_length_mm&#39;</span>
<span class="sd">        &gt;&gt;&gt;        ]</span>
<span class="sd">        &gt;&gt;&gt; (penguins_tidy.select(cns)</span>
<span class="sd">        &gt;&gt;&gt;               .pivot_longer(cols = [&#39;bill_length_mm&#39;,</span>
<span class="sd">        &gt;&gt;&gt;                                     &#39;bill_depth_mm&#39;,</span>
<span class="sd">        &gt;&gt;&gt;                                     &#39;flipper_length_mm&#39;]</span>
<span class="sd">        &gt;&gt;&gt;                             )</span>
<span class="sd">        &gt;&gt;&gt;               )</span>
<span class="sd">        &gt;&gt;&gt;               </span>
<span class="sd">        &gt;&gt;&gt; # pivot by specifying &#39;id&#39; columns to obtain the same result as above</span>
<span class="sd">        &gt;&gt;&gt; # this is helpful when there are many columns to melt</span>
<span class="sd">        &gt;&gt;&gt; (penguins_tidy.select(cns)</span>
<span class="sd">        &gt;&gt;&gt;               .pivot_longer(cols = &#39;species&#39;,</span>
<span class="sd">        &gt;&gt;&gt;                             include = False</span>
<span class="sd">        &gt;&gt;&gt;                             )</span>
<span class="sd">        &gt;&gt;&gt;               )</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># assertions</span>
        <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>
        <span class="k">assert</span> <span class="n">_is_string_or_string_list</span><span class="p">(</span><span class="n">cols</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;cols&#39; should be a string or a list of strings&quot;</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">cn</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;cols&#39; should be a subset of existing column names&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">include</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;include&#39; should be a bool&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">include</span><span class="p">:</span>
           <span class="n">cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">setlist</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">cols</span><span class="p">))</span>
           <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>\
               <span class="s2">&quot;At least one column should be selected for melt&quot;</span>
        
        <span class="n">id_vars</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">names_to</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;names_to&#39; should be a string&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values_to</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;values_to&#39; should be a string&quot;</span>
        <span class="k">assert</span> <span class="n">names_to</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">id_vars</span><span class="p">,</span>\
            <span class="s2">&quot;arg &#39;names_to&#39; should not match a id column&quot;</span>
        <span class="k">assert</span> <span class="n">values_to</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">id_vars</span><span class="p">,</span>\
            <span class="s2">&quot;arg &#39;values_to&#39; should not match a id column&quot;</span>
        
        <span class="c1"># core operation</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                   <span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span>         <span class="o">=</span> <span class="n">id_vars</span>
                         <span class="p">,</span> <span class="n">value_vars</span>    <span class="o">=</span> <span class="n">cols</span>
                         <span class="p">,</span> <span class="n">var_name</span>      <span class="o">=</span> <span class="n">names_to</span>
                         <span class="p">,</span> <span class="n">value_name</span>    <span class="o">=</span> <span class="n">values_to</span>
                         <span class="p">,</span> <span class="n">ignore_index</span>  <span class="o">=</span> <span class="kc">True</span>
                         <span class="p">)</span>
                   <span class="p">)</span>
                   
        <span class="n">res</span> <span class="o">=</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">values_drop_na</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">drop_na</span><span class="p">(</span><span class="n">values_to</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">res</span></div>
    
    <span class="c1">##########################################################################</span>
    <span class="c1"># slice extensions</span>
    <span class="c1">##########################################################################</span>
    
<div class="viewcode-block" id="tidyframe.slice_head"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.slice_head">[docs]</a>    <span class="k">def</span> <span class="nf">slice_head</span><span class="p">(</span><span class="bp">self</span>
                   <span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="kc">None</span>
                   <span class="p">,</span> <span class="n">prop</span> <span class="o">=</span> <span class="kc">None</span>
                   <span class="p">,</span> <span class="n">rounding_type</span> <span class="o">=</span> <span class="s2">&quot;round&quot;</span>
                   <span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="kc">None</span>
                   <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Subset first few rows</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n: int</span>
<span class="sd">            Number of rows to subset, should be atleast 1</span>
<span class="sd">        prop: float</span>
<span class="sd">            proportion of rows to subset, should be between 0(exclusive) and 1 </span>
<span class="sd">            (inclusive)</span>
<span class="sd">        rounding_type: string</span>
<span class="sd">            When prop is provided, rounding method to be used.</span>
<span class="sd">            Options: &#39;round&#39; (default), &#39;floor&#39;, &#39;ceiling&#39;</span>
<span class="sd">        by: string or list of strings</span>
<span class="sd">            column names to group by</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. Only one argument among &#39;n&#39; and &#39;prop&#39; should be provided.</span>
<span class="sd">        2. Row order is preserved by the method.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice_head(n = 3)</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice_head(prop = 0.01)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice_head(n = 1, by = &#39;species&#39;)</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice_head(prop = 0.01, by = &#39;species&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrow</span>
        <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>

        <span class="c1"># exactly one of then should be none</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="p">((</span><span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">prop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)),</span>\
            <span class="s2">&quot;Exactly one arg among &#39;n&#39;, &#39;prop&#39; should be provided&quot;</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="p">((</span><span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">prop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)),</span>\
            <span class="s2">&quot;Exactly one arg among &#39;n&#39;, &#39;prop&#39; should be provided&quot;</span>
            
        <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;n&#39; should be a positive integer&quot;</span>
            <span class="k">assert</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>\
                <span class="s2">&quot;arg &#39;n&#39; should be atleast 1&quot;</span>
            <span class="n">case_prop</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">prop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)),</span>\
                <span class="s2">&quot;arg &#39;prop&#39; should be a positive float or int not exceeding 1&quot;</span>
            <span class="k">assert</span> <span class="n">prop</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">prop</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span>\
                <span class="s2">&quot;arg &#39;prop&#39; should be a positive float or int not exceeding 1&quot;</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">prop</span> <span class="o">*</span> <span class="n">nr</span><span class="p">))</span>
            <span class="n">case_prop</span> <span class="o">=</span> <span class="kc">True</span>
            
        <span class="k">if</span> <span class="n">by</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>\
                <span class="s2">&quot;arg &#39;n&#39; should not exceed the number of rows of the dataframe&quot;</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">tidyframe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                                      <span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span>
                                      <span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span>
                                      <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_by</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
            <span class="n">by</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">case_prop</span><span class="p">:</span>
                <span class="n">min_group_size</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                                      <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dropna</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                                      <span class="o">.</span><span class="n">size</span><span class="p">()</span>
                                      <span class="o">.</span><span class="n">min</span><span class="p">()</span>
                                      <span class="p">)</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="n">min_group_size</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Minimum group size is &quot;</span><span class="p">,</span> <span class="n">min_group_size</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">min_group_size</span><span class="p">,</span>\
                    <span class="s2">&quot;arg &#39;n&#39; should not exceed the size of any chunk after grouping&quot;</span>
                
                <span class="n">ro_name</span> <span class="o">=</span> <span class="n">_generate_new_string</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span> 
                <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_modify</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
                                         <span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">by</span>
                                         <span class="p">,</span> <span class="n">preserve_row_order</span> <span class="o">=</span> <span class="kc">True</span>
                                         <span class="p">,</span> <span class="n">row_order_column_name</span> <span class="o">=</span> <span class="n">ro_name</span>
                                         <span class="p">)</span>
                           <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rounding_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>\
                    <span class="s2">&quot;arg &#39;ties_method&#39; should be a string&quot;</span>
                <span class="k">assert</span> <span class="n">rounding_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="s1">&#39;ceiling&#39;</span><span class="p">,</span> <span class="s1">&#39;floor&#39;</span><span class="p">],</span>\
                    <span class="p">(</span><span class="s2">&quot;arg &#39;rounding_type&#39; should be one among: &#39;round&#39; (default)&quot;</span>
                     <span class="s2">&quot; , &#39;ceiling&#39;, &#39;floor&#39;&quot;</span>
                     <span class="p">)</span>
                
                <span class="k">if</span> <span class="n">rounding_type</span> <span class="o">==</span> <span class="s2">&quot;round&quot;</span><span class="p">:</span>
                    <span class="n">roundf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span>
                <span class="k">elif</span> <span class="n">rounding_type</span> <span class="o">==</span> <span class="s2">&quot;ceiling&quot;</span><span class="p">:</span>
                    <span class="n">roundf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">roundf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span>
                
                <span class="n">ro_name</span> <span class="o">=</span> <span class="n">_generate_new_string</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span>    
                <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_modify</span><span class="p">(</span>
                          <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">roundf</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">prop</span><span class="p">))))</span>
                          <span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">by</span>
                          <span class="p">,</span> <span class="n">preserve_row_order</span> <span class="o">=</span> <span class="kc">True</span>
                          <span class="p">,</span> <span class="n">row_order_column_name</span> <span class="o">=</span> <span class="n">ro_name</span>
                          <span class="p">)</span>
            
        <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">relocate</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span></div>
    
    <span class="n">head</span> <span class="o">=</span> <span class="n">slice_head</span>
    
<div class="viewcode-block" id="tidyframe.slice_tail"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.slice_tail">[docs]</a>    <span class="k">def</span> <span class="nf">slice_tail</span><span class="p">(</span><span class="bp">self</span>
                   <span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="kc">None</span>
                   <span class="p">,</span> <span class="n">prop</span> <span class="o">=</span> <span class="kc">None</span>
                   <span class="p">,</span> <span class="n">rounding_type</span> <span class="o">=</span> <span class="s2">&quot;round&quot;</span>
                   <span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="kc">None</span>
                   <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Subset last few rows</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n: int</span>
<span class="sd">            Number of rows to subset, should be atleast 1</span>
<span class="sd">        prop: float</span>
<span class="sd">            proportion of rows to subset, should be between 0(exclusive) and 1(inclusive)</span>
<span class="sd">        rounding_type: string</span>
<span class="sd">            When prop is provided, rounding method to be used. </span>
<span class="sd">            Options: &#39;round&#39; (default), &#39;floor&#39;, &#39;ceiling&#39;</span>
<span class="sd">        by: string or list of strings</span>
<span class="sd">            column names to group by</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. Only one argument among &#39;n&#39; and &#39;prop&#39; should be provided.</span>
<span class="sd">        2. Row order is preserved by the method.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice_tail(n = 3)</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice_tail(prop = 0.01)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice_tail(n = 1, by = &#39;species&#39;)</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice_tail(prop = 0.01, by = &#39;species&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrow</span>
        <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>

        <span class="c1"># exactly one of then should be none</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="p">((</span><span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">prop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)),</span>\
            <span class="s2">&quot;Exactly one arg among &#39;n&#39;, &#39;prop&#39; should be provided&quot;</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="p">((</span><span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">prop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)),</span>\
            <span class="s2">&quot;Exactly one arg among &#39;n&#39;, &#39;prop&#39; should be provided&quot;</span>
            
        <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;n&#39; should be a positive integer&quot;</span>
            <span class="k">assert</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>\
                <span class="s2">&quot;arg &#39;n&#39; should be atleast 1&quot;</span>
            <span class="n">case_prop</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">prop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)),</span>\
                <span class="s2">&quot;arg &#39;prop&#39; should be a positive float or int not exceeding 1&quot;</span>
            <span class="k">assert</span> <span class="n">prop</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">prop</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span>\
                <span class="s2">&quot;arg &#39;prop&#39; should be a positive float or int not exceeding 1&quot;</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">prop</span> <span class="o">*</span> <span class="n">nr</span><span class="p">))</span>
            <span class="n">case_prop</span> <span class="o">=</span> <span class="kc">True</span>
            
        <span class="k">if</span> <span class="n">by</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>\
                <span class="s2">&quot;arg &#39;n&#39; should not exceed the number of rows of the dataframe&quot;</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">tidyframe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                                      <span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span>
                                      <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_by</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
            <span class="n">by</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">case_prop</span><span class="p">:</span>
                <span class="n">min_group_size</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                                      <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dropna</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                                      <span class="o">.</span><span class="n">size</span><span class="p">()</span>
                                      <span class="o">.</span><span class="n">min</span><span class="p">()</span>
                                      <span class="p">)</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="n">min_group_size</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Minimum group size is &quot;</span><span class="p">,</span> <span class="n">min_group_size</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">min_group_size</span><span class="p">,</span>\
                    <span class="s2">&quot;arg &#39;n&#39; should not exceed the size of any chunk after grouping&quot;</span>
                
                <span class="n">ro_name</span> <span class="o">=</span> <span class="n">_generate_new_string</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span> 
                <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_modify</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                                             <span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">by</span>
                                             <span class="p">,</span> <span class="n">is_pandas_udf</span> <span class="o">=</span> <span class="kc">True</span>
                                             <span class="p">,</span> <span class="n">preserve_row_order</span> <span class="o">=</span> <span class="kc">True</span>
                                             <span class="p">,</span> <span class="n">row_order_column_name</span> <span class="o">=</span> <span class="n">ro_name</span>
                                             <span class="p">)</span>
                           <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rounding_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>\
                    <span class="s2">&quot;arg &#39;ties_method&#39; should be a string&quot;</span>
                <span class="k">assert</span> <span class="n">rounding_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="s1">&#39;ceiling&#39;</span><span class="p">,</span> <span class="s1">&#39;floor&#39;</span><span class="p">],</span>\
                    <span class="s2">&quot;arg &#39;ties_method&#39; should be one among: &#39;round&#39; (default), &#39;ceiling&#39;, &#39;floor&#39;&quot;</span>
                
                <span class="k">if</span> <span class="n">rounding_type</span> <span class="o">==</span> <span class="s2">&quot;round&quot;</span><span class="p">:</span>
                    <span class="n">roundf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span>
                <span class="k">elif</span> <span class="n">rounding_type</span> <span class="o">==</span> <span class="s2">&quot;ceiling&quot;</span><span class="p">:</span>
                    <span class="n">roundf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">roundf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span>
                
                <span class="n">ro_name</span> <span class="o">=</span> <span class="n">_generate_new_string</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span>    
                <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_modify</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">roundf</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">prop</span><span class="p">)))</span>
                                <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                                <span class="p">)</span>
                    <span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">by</span>
                    <span class="p">,</span> <span class="n">is_pandas_udf</span>      <span class="o">=</span> <span class="kc">True</span>
                    <span class="p">,</span> <span class="n">preserve_row_order</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="p">,</span> <span class="n">row_order_column_name</span> <span class="o">=</span> <span class="n">ro_name</span>
                    <span class="p">))</span>
            
        <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">relocate</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span></div>
    
    <span class="n">tail</span> <span class="o">=</span> <span class="n">slice_tail</span>
    
<div class="viewcode-block" id="tidyframe.slice_sample"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.slice_sample">[docs]</a>    <span class="k">def</span> <span class="nf">slice_sample</span><span class="p">(</span><span class="bp">self</span>
                     <span class="p">,</span> <span class="n">n</span>            <span class="o">=</span> <span class="kc">None</span>
                     <span class="p">,</span> <span class="n">prop</span>         <span class="o">=</span> <span class="kc">None</span>
                     <span class="p">,</span> <span class="n">replace</span>      <span class="o">=</span> <span class="kc">False</span>
                     <span class="p">,</span> <span class="n">weights</span>      <span class="o">=</span> <span class="kc">None</span>
                     <span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="kc">None</span>
                     <span class="p">,</span> <span class="n">by</span>           <span class="o">=</span> <span class="kc">None</span>
                     <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Sample a few rows</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n: int</span>
<span class="sd">            Number of rows to sample, should be atleast 1</span>
<span class="sd">        prop: float</span>
<span class="sd">            Proportion of rows to subset, should be non-negative</span>
<span class="sd">        replace: bool, default is False</span>
<span class="sd">            Whether to sampling should be done with replacement</span>
<span class="sd">        weights: string, pandas series, numpy array (Default is None)</span>
<span class="sd">            When a string, it should be an column of numeric dtype</span>
<span class="sd">            When None, no weights are used</span>
<span class="sd">        random_state: positive integer (Default is None)</span>
<span class="sd">            Seed to keep the sampling reproducible</span>
<span class="sd">            When None, a pseudorandom seed is chosen</span>
<span class="sd">        by: string or list of strings</span>
<span class="sd">            column names to group by</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. Only one argument among &#39;n&#39; and &#39;prop&#39; should be provided.</span>
<span class="sd">        2. Row order is not preserved by the method.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # swor: sample without replacement</span>
<span class="sd">        &gt;&gt;&gt; # swr: sample with replacement</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # sample by specifiying count</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice_sample(n = 5)                    # swor</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice_sample(n = 5, replace = True)    # swr, smaller than input</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice_sample(n = 1000, replace = True) # swr, larger than input</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # sample by specifiying proportion of number of rows of the input</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice_sample(prop = 0.3)                 # swor</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice_sample(prop = 0.3, replace = True) # swr, smaller than input</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice_sample(prop = 1.1, replace = True) # swr, larger than input</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # sample with weights</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice_sample(prop = 0.3, weights = &#39;year&#39;)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # sampling is reproducible by setting a random state</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice_sample(n = 3, random_state = 42)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # per group sampling</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice_sample(n = 5, by = &#39;species&#39;, random_state = 1)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrow</span>
        <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>

        <span class="c1"># exactly one of then should be none</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="p">((</span><span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">prop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)),</span>\
            <span class="s2">&quot;Exactly one arg among &#39;n&#39;, &#39;prop&#39; should be provided&quot;</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="p">((</span><span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">prop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)),</span>\
            <span class="s2">&quot;Exactly one arg among &#39;n&#39;, &#39;prop&#39; should be provided&quot;</span>
            
        <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;n&#39; should be a positive integer&quot;</span>
            <span class="k">assert</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>\
                <span class="s2">&quot;arg &#39;n&#39; should be atleast 1&quot;</span>
        <span class="k">if</span> <span class="n">prop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)),</span>\
                <span class="s2">&quot;arg &#39;prop&#39; should be a positive float or int&quot;</span>
            <span class="k">assert</span> <span class="n">prop</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>\
                <span class="s2">&quot;arg &#39;prop&#39; should be a positive float or int&quot;</span>
        
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">replace</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span>\
            <span class="s2">&quot;Arg &#39;replace&#39; should be True or False&quot;</span>
        <span class="k">if</span> <span class="n">prop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">prop</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">replace</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;When arg &#39;prop&#39; &gt; 1, arg &#39;replace&#39; should be True&quot;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="n">nr</span> <span class="ow">and</span> <span class="n">replace</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;When arg &#39;n&#39; is greater than the number of rows of the input, arg &#39;replace&#39; should be True&quot;</span><span class="p">)</span>
            
        <span class="c1"># Arg weights is not validated</span>
        <span class="c1"># Arg random_state is not validated</span>
        
        <span class="k">if</span> <span class="n">by</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                           <span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span>              <span class="o">=</span> <span class="n">n</span>
                                   <span class="p">,</span> <span class="n">axis</span>         <span class="o">=</span> <span class="s2">&quot;index&quot;</span>
                                   <span class="p">,</span> <span class="n">replace</span>      <span class="o">=</span> <span class="n">replace</span>
                                   <span class="p">,</span> <span class="n">weights</span>      <span class="o">=</span> <span class="n">weights</span>
                                   <span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="n">random_state</span>
                                   <span class="p">)</span>
                           <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                           <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                           <span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span>           <span class="o">=</span> <span class="n">prop</span>
                                   <span class="p">,</span> <span class="n">axis</span>         <span class="o">=</span> <span class="s2">&quot;index&quot;</span>
                                   <span class="p">,</span> <span class="n">replace</span>      <span class="o">=</span> <span class="n">replace</span>
                                   <span class="p">,</span> <span class="n">weights</span>      <span class="o">=</span> <span class="n">weights</span>
                                   <span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="n">random_state</span>
                                   <span class="p">)</span>
                           <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                           <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">by</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_by</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
            <span class="n">n_groups</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dropna</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                            <span class="o">.</span><span class="n">ngroups</span>
                            <span class="p">)</span>
            
            <span class="k">if</span> <span class="n">random_state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>
            <span class="n">seeds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">n_groups</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">n_groups</span><span class="p">,</span> <span class="n">replace</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
            
            <span class="n">groups_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">by</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
            <span class="n">grp_name</span> <span class="o">=</span> <span class="n">_generate_new_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span>
            <span class="n">groups_frame</span><span class="p">[</span><span class="n">grp_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">groups_frame</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> 
            <span class="n">groups_frame</span><span class="p">[</span><span class="s2">&quot;__seed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">seeds</span>
            
            <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">min_group_size</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                                      <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dropna</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                                      <span class="o">.</span><span class="n">size</span><span class="p">()</span>
                                      <span class="o">.</span><span class="n">min</span><span class="p">()</span>
                                      <span class="p">)</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="n">min_group_size</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Minimum group size is &quot;</span><span class="p">,</span> <span class="n">min_group_size</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">min_group_size</span><span class="p">,</span>\
                    <span class="s2">&quot;arg &#39;n&#39; should not exceed the size of any chunk after grouping&quot;</span>
                
                <span class="k">def</span> <span class="nf">sample_chunk_n</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                    <span class="n">rs</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;__seed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span>              <span class="o">=</span> <span class="n">n</span>
                                    <span class="p">,</span> <span class="n">axis</span>         <span class="o">=</span> <span class="s2">&quot;index&quot;</span>
                                    <span class="p">,</span> <span class="n">replace</span>      <span class="o">=</span> <span class="n">replace</span>
                                    <span class="p">,</span> <span class="n">weights</span>      <span class="o">=</span> <span class="n">weights</span>
                                    <span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="n">rs</span>
                                    <span class="p">)</span>
                            <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                            <span class="p">)</span>
                    <span class="k">return</span> <span class="n">res</span>
                
                <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                           <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">groups_frame</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="n">by</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span>
                           <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">grp_name</span><span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dropna</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                           <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">sample_chunk_n</span><span class="p">)</span>
                           <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                           <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;__seed&quot;</span><span class="p">,</span> <span class="n">grp_name</span><span class="p">])</span>
                           <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">def</span> <span class="nf">sample_chunk_prop</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                    <span class="n">rs</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;__seed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span>           <span class="o">=</span> <span class="n">prop</span>
                                    <span class="p">,</span> <span class="n">axis</span>         <span class="o">=</span> <span class="s2">&quot;index&quot;</span>
                                    <span class="p">,</span> <span class="n">replace</span>      <span class="o">=</span> <span class="n">replace</span>
                                    <span class="p">,</span> <span class="n">weights</span>      <span class="o">=</span> <span class="n">weights</span>
                                    <span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="n">rs</span>
                                    <span class="p">)</span>
                            <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                            <span class="p">)</span>
                    <span class="k">return</span> <span class="n">res</span>
                
                <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                           <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">groups_frame</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="n">by</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span>
                           <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">grp_name</span><span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dropna</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                           <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">sample_chunk_prop</span><span class="p">)</span>
                           <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                           <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;__seed&quot;</span><span class="p">,</span> <span class="n">grp_name</span><span class="p">])</span>
                           <span class="p">)</span>
            
            <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="n">random_state</span><span class="p">)</span>
                      <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                      <span class="p">)</span>
            
        <span class="k">return</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="o">.</span><span class="n">relocate</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span></div>
    
    <span class="n">sample</span> <span class="o">=</span> <span class="n">slice_sample</span>
    
    <span class="c1">##########################################################################</span>
    <span class="c1"># slice min/max</span>
    <span class="c1">##########################################################################</span>
    
<div class="viewcode-block" id="tidyframe.slice_min"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.slice_min">[docs]</a>    <span class="k">def</span> <span class="nf">slice_min</span><span class="p">(</span><span class="bp">self</span>
                  <span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="kc">None</span>
                  <span class="p">,</span> <span class="n">prop</span> <span class="o">=</span> <span class="kc">None</span>
                  <span class="p">,</span> <span class="n">order_by_column</span> <span class="o">=</span> <span class="kc">None</span>
                  <span class="p">,</span> <span class="n">with_ties</span> <span class="o">=</span> <span class="kc">True</span>
                  <span class="p">,</span> <span class="n">rounding_type</span> <span class="o">=</span> <span class="s2">&quot;round&quot;</span>
                  <span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="kc">None</span>
                  <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Subset top rows ordered by some columns</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n: int</span>
<span class="sd">            Number of rows to subset, should be atleast 1</span>
<span class="sd">        prop: float</span>
<span class="sd">            Proportion of rows to subset, should be non-negative</span>
<span class="sd">        order_by_column: string or list of strings</span>
<span class="sd">            column to order by</span>
<span class="sd">        with_ties: bool (default: True)</span>
<span class="sd">            Whether to return all rows when ordering results in ties. If True, </span>
<span class="sd">            the output might have more than n/prop rows</span>
<span class="sd">        rounding_type: string (Default is None)</span>
<span class="sd">            Rounding type to used when prop is provided. &#39;rounding_type&#39; should </span>
<span class="sd">            be one among: &#39;round&#39;, &#39;ceiling&#39;, &#39;floor&#39;</span>
<span class="sd">        by: string or list of strings</span>
<span class="sd">            column names to group by</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. Only one argument among &#39;n&#39; and &#39;prop&#39; should be provided.S</span>
<span class="sd">        2. Row order is not preserved by the method.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # subset atleast 4 rows corresponding to ascending &#39;body_mass_g&#39;</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice_min(n = 4, order_by_column = &#39;body_mass_g&#39;)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # subset exactly 4 rows corresponding to ascending &#39;body_mass_g&#39;</span>
<span class="sd">        &gt;&gt;&gt; # when more than &#39;n&#39; rows exist, top n rows in the row order are chosen</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice_min(n = 4, order_by_column = &#39;body_mass_g&#39;, with_ties = False)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # subset a fraction of rows corresponding to ascending &#39;body_mass_g&#39;</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice_min(prop = 0.1, order_by_column = &#39;body_mass_g&#39;)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # subset atleast 3 rows corresponding to ascending &#39;bill_length_mm&#39; per each &#39;species&#39;</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice_min(n = 2, order_by_column = &#39;bill_length_mm&#39;, by = &#39;sex&#39;)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # subset atleast 1% corresponding to ascending &#39;bill_length_mm&#39; per each &#39;species&#39;</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice_min(prop = 0.01, order_by_column = &#39;bill_length_mm&#39;, by = &#39;sex&#39;)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # order by column &#39;bill_length_mm&#39; and break ties using &#39;bill_depth_mm&#39;</span>
<span class="sd">        &gt;&gt;&gt; # in decreasing order and then pick the min 5 rows</span>
<span class="sd">        &gt;&gt;&gt; (penguins_tidy</span>
<span class="sd">        &gt;&gt;&gt;  .mutate({&#39;rank&#39;: (lambda x, y: dense_rank([x, y],</span>
<span class="sd">        &gt;&gt;&gt;                                            ascending = [True, False]</span>
<span class="sd">        &gt;&gt;&gt;                                            ),</span>
<span class="sd">        &gt;&gt;&gt;                    [&quot;bill_length_mm&quot;, &quot;bill_depth_mm&quot;]</span>
<span class="sd">        &gt;&gt;&gt;                    )</span>
<span class="sd">        &gt;&gt;&gt;          })</span>
<span class="sd">        &gt;&gt;&gt;  .slice_min(n = 5, order_by_column = &quot;rank&quot;)</span>
<span class="sd">        &gt;&gt;&gt;  .select(&quot;rank&quot;, include = False)</span>
<span class="sd">        &gt;&gt;&gt;  )</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrow</span>
        <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>

        <span class="c1"># exactly one of then should be none</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="p">((</span><span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">prop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)),</span>\
            <span class="s2">&quot;Exactly one arg among &#39;n&#39;, &#39;prop&#39; should be provided&quot;</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="p">((</span><span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">prop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)),</span>\
            <span class="s2">&quot;Exactly one arg among &#39;n&#39;, &#39;prop&#39; should be provided&quot;</span>
            
        <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;n&#39; should be a positive integer&quot;</span>
            <span class="k">assert</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>\
                <span class="s2">&quot;arg &#39;n&#39; should be atleast 1&quot;</span>
            <span class="n">case_prop</span> <span class="o">=</span> <span class="kc">False</span>
            
        <span class="k">if</span> <span class="n">prop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)),</span>\
                <span class="s2">&quot;arg &#39;prop&#39; should be a positive float or int not exceeding 1&quot;</span>
            <span class="k">assert</span> <span class="n">prop</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">prop</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span>\
                <span class="s2">&quot;arg &#39;prop&#39; should be a positive float or int not exceeding 1&quot;</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">prop</span> <span class="o">*</span> <span class="n">nr</span><span class="p">))</span>
            <span class="n">case_prop</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="k">if</span> <span class="n">order_by_column</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;arg &#39;order_by&#39; should not be None&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">order_by_column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">,</span>\
                <span class="s2">&quot;&#39;order_by_column&#39; should be a existing column name&quot;</span>
          
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">with_ties</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;with_ties&#39; should be a bool&quot;</span>
            
        <span class="k">if</span> <span class="n">with_ties</span><span class="p">:</span>
            <span class="n">keep_value</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">keep_value</span> <span class="o">=</span> <span class="s2">&quot;first&quot;</span>
        
        <span class="k">if</span> <span class="n">by</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ro_name</span> <span class="o">=</span> <span class="n">_generate_new_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_row_number</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">ro_name</span><span class="p">)</span>
                       <span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                       <span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">order_by_column</span><span class="p">,</span> <span class="n">keep</span> <span class="o">=</span> <span class="n">keep_value</span><span class="p">)</span>
                       <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                       <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ro_name</span><span class="p">,</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                       <span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">cn</span><span class="p">]</span>
                       <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">))</span>
                       <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_by</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
            <span class="n">by</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">case_prop</span><span class="p">:</span> <span class="c1"># grouped prop</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rounding_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>\
                    <span class="s2">&quot;arg &#39;ties_method&#39; should be a string&quot;</span>
                <span class="k">assert</span> <span class="n">rounding_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="s1">&#39;ceiling&#39;</span><span class="p">,</span> <span class="s1">&#39;floor&#39;</span><span class="p">],</span>\
                    <span class="p">(</span><span class="s2">&quot;arg &#39;ties_method&#39; should be one among: &#39;round&#39; (default),&quot;</span>
                     <span class="s2">&quot; &#39;ceiling&#39;, &#39;floor&#39;&quot;</span>
                     <span class="p">)</span>
                
                <span class="k">if</span> <span class="n">rounding_type</span> <span class="o">==</span> <span class="s2">&quot;round&quot;</span><span class="p">:</span>
                    <span class="n">roundf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span>
                <span class="k">elif</span> <span class="n">rounding_type</span> <span class="o">==</span> <span class="s2">&quot;ceiling&quot;</span><span class="p">:</span>
                    <span class="n">roundf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">roundf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span>

                <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_modify</span><span class="p">(</span>
                              <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                                          <span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">roundf</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">prop</span><span class="p">))</span>
                                                    <span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">order_by_column</span>
                                                    <span class="p">,</span> <span class="n">keep</span> <span class="o">=</span> <span class="n">keep_value</span>
                                                    <span class="p">)</span>
                                          <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">tidyframe</span>
                                                <span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span>
                                                <span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span>
                                                <span class="p">)</span>
                                        <span class="p">)</span>
                              <span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">by</span>
                              <span class="p">,</span> <span class="n">preserve_row_order</span> <span class="o">=</span> <span class="kc">True</span>
                              <span class="p">,</span> <span class="n">row_order_column_name</span> <span class="o">=</span> <span class="n">_generate_new_string</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span>
                              <span class="p">)</span>
                           <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span>
                           <span class="o">.</span><span class="n">arrange</span><span class="p">(</span><span class="n">order_by_column</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">by</span><span class="p">)</span>
                           <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># grouped n</span>
                <span class="n">min_group_size</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                                      <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dropna</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                                      <span class="o">.</span><span class="n">size</span><span class="p">()</span>
                                      <span class="o">.</span><span class="n">min</span><span class="p">()</span>
                                      <span class="p">)</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="n">min_group_size</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Minimum group size is &quot;</span><span class="p">,</span> <span class="n">min_group_size</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">min_group_size</span><span class="p">,</span>\
                    <span class="p">(</span><span class="s2">&quot;arg &#39;n&#39; should not exceed the size of any chunk after &quot;</span>
                    <span class="s2">&quot;grouping&quot;</span><span class="p">)</span>
                
                <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_modify</span><span class="p">(</span>
                              <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                                          <span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="n">n</span>
                                                    <span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">order_by_column</span>
                                                    <span class="p">,</span> <span class="n">keep</span> <span class="o">=</span> <span class="n">keep_value</span>
                                                    <span class="p">)</span>
                                          <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">tidyframe</span>
                                                <span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span>
                                                <span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span>
                                                <span class="p">)</span>
                                        <span class="p">)</span>
                              <span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">by</span>
                              <span class="p">,</span> <span class="n">preserve_row_order</span> <span class="o">=</span> <span class="kc">True</span>
                              <span class="p">,</span> <span class="n">row_order_column_name</span> <span class="o">=</span> <span class="n">_generate_new_string</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span>
                              <span class="p">)</span>
                           <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span>
                           <span class="o">.</span><span class="n">arrange</span><span class="p">(</span><span class="n">order_by_column</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">by</span><span class="p">)</span>
                           <span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">relocate</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="tidyframe.slice_max"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.slice_max">[docs]</a>    <span class="k">def</span> <span class="nf">slice_max</span><span class="p">(</span><span class="bp">self</span>
                  <span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="kc">None</span>
                  <span class="p">,</span> <span class="n">prop</span> <span class="o">=</span> <span class="kc">None</span>
                  <span class="p">,</span> <span class="n">order_by_column</span> <span class="o">=</span> <span class="kc">None</span>
                  <span class="p">,</span> <span class="n">with_ties</span> <span class="o">=</span> <span class="kc">True</span>
                  <span class="p">,</span> <span class="n">rounding_type</span> <span class="o">=</span> <span class="s2">&quot;round&quot;</span>
                  <span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="kc">None</span>
                  <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Subset top rows ordered by some columns</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n: int</span>
<span class="sd">            Number of rows to subset, should be atleast 1</span>
<span class="sd">        prop: float</span>
<span class="sd">            Proportion of rows to subset, should be non-negative</span>
<span class="sd">        order_by_column: string or list of strings</span>
<span class="sd">            column to order by</span>
<span class="sd">        with_ties: bool (default: True)</span>
<span class="sd">            Whether to return all rows when ordering results in ties. If True, </span>
<span class="sd">            the output might have more than n/prop rows</span>
<span class="sd">        rounding_type: string (Default is None)</span>
<span class="sd">            Rounding type to used when prop is provided. &#39;rounding_type&#39; should </span>
<span class="sd">            be one among: &#39;round&#39;, &#39;ceiling&#39;, &#39;floor&#39;</span>
<span class="sd">        by: string or list of strings</span>
<span class="sd">            column names to group by</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. Only one argument among &#39;n&#39; and &#39;prop&#39; should be provided.</span>
<span class="sd">        2. Row order is not preserved by the method.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # subset atleast 4 rows corresponding to descending &#39;body_mass_g&#39;</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice_max(n = 4, order_by_column = &#39;body_mass_g&#39;)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # subset exactly 4 rows corresponding to descending &#39;body_mass_g&#39;</span>
<span class="sd">        &gt;&gt;&gt; # when more than &#39;n&#39; rows exist, top n rows in the row order are chosen</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice_max(n = 4, order_by_column = &#39;body_mass_g&#39;, with_ties = False)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # subset a fraction of rows corresponding to descending &#39;body_mass_g&#39;</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice_max(prop = 0.1, order_by_column = &#39;body_mass_g&#39;)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # subset atleast 3 rows corresponding to descending &#39;bill_length_mm&#39; per each &#39;species&#39;</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice_max(n = 2, order_by_column = &#39;bill_length_mm&#39;, by = &#39;sex&#39;)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # subset atleast 1% corresponding to descending &#39;bill_length_mm&#39; per each &#39;species&#39;</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.slice_max(prop = 0.01, order_by_column = &#39;bill_length_mm&#39;, by = &#39;sex&#39;)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # order by column &#39;bill_length_mm&#39; and break ties using &#39;bill_depth_mm&#39;</span>
<span class="sd">        &gt;&gt;&gt; # in decreasing order and then pick the min 5 rows</span>
<span class="sd">        &gt;&gt;&gt; (penguins_tidy</span>
<span class="sd">        &gt;&gt;&gt;  .mutate({&#39;rank&#39;: (lambda x, y: dense_rank([x, y],</span>
<span class="sd">        &gt;&gt;&gt;                                            ascending = [True, False]</span>
<span class="sd">        &gt;&gt;&gt;                                            ),</span>
<span class="sd">        &gt;&gt;&gt;                    [&quot;bill_length_mm&quot;, &quot;bill_depth_mm&quot;]</span>
<span class="sd">        &gt;&gt;&gt;                    )</span>
<span class="sd">        &gt;&gt;&gt;          })</span>
<span class="sd">        &gt;&gt;&gt;  .slice_max(n = 5, order_by_column = &quot;rank&quot;)</span>
<span class="sd">        &gt;&gt;&gt;  .select(&quot;rank&quot;, include = False)</span>
<span class="sd">        &gt;&gt;&gt;  )</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrow</span>
        <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>

        <span class="c1"># exactly one of then should be none</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="p">((</span><span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">prop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)),</span>\
            <span class="s2">&quot;Exactly one arg among &#39;n&#39;, &#39;prop&#39; should be provided&quot;</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="p">((</span><span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">prop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)),</span>\
            <span class="s2">&quot;Exactly one arg among &#39;n&#39;, &#39;prop&#39; should be provided&quot;</span>
            
        <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>\
                <span class="s2">&quot;arg &#39;n&#39; should be a positive integer&quot;</span>
            <span class="k">assert</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>\
                <span class="s2">&quot;arg &#39;n&#39; should be atleast 1&quot;</span>
            <span class="n">case_prop</span> <span class="o">=</span> <span class="kc">False</span>
            
        <span class="k">if</span> <span class="n">prop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)),</span>\
                <span class="s2">&quot;arg &#39;prop&#39; should be a positive float or int not exceeding 1&quot;</span>
            <span class="k">assert</span> <span class="n">prop</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">prop</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span>\
                <span class="s2">&quot;arg &#39;prop&#39; should be a positive float or int not exceeding 1&quot;</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">prop</span> <span class="o">*</span> <span class="n">nr</span><span class="p">))</span>
            <span class="n">case_prop</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="k">if</span> <span class="n">order_by_column</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;arg &#39;order_by&#39; should not be None&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">order_by_column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">,</span>\
                <span class="s2">&quot;&#39;order_by_column&#39; should be a existing column name&quot;</span>
          
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">with_ties</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;with_ties&#39; should be a bool&quot;</span>
            
        <span class="k">if</span> <span class="n">with_ties</span><span class="p">:</span>
            <span class="n">keep_value</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">keep_value</span> <span class="o">=</span> <span class="s2">&quot;first&quot;</span>
        
        <span class="k">if</span> <span class="n">by</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ro_name</span> <span class="o">=</span> <span class="n">_generate_new_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_row_number</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">ro_name</span><span class="p">)</span>
                       <span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                       <span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">order_by_column</span><span class="p">,</span> <span class="n">keep</span> <span class="o">=</span> <span class="n">keep_value</span><span class="p">)</span>
                       <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                       <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ro_name</span><span class="p">,</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                       <span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">cn</span><span class="p">]</span>
                       <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">))</span>
                       <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_by</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
            <span class="n">by</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">case_prop</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rounding_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>\
                    <span class="s2">&quot;arg &#39;ties_method&#39; should be a string&quot;</span>
                <span class="k">assert</span> <span class="n">rounding_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="s1">&#39;ceiling&#39;</span><span class="p">,</span> <span class="s1">&#39;floor&#39;</span><span class="p">],</span>\
                    <span class="p">(</span><span class="s2">&quot;arg &#39;ties_method&#39; should be one among: &#39;round&#39; (default),&quot;</span>
                     <span class="s2">&quot; &#39;ceiling&#39;, &#39;floor&#39;&quot;</span>
                     <span class="p">)</span>
                
                <span class="k">if</span> <span class="n">rounding_type</span> <span class="o">==</span> <span class="s2">&quot;round&quot;</span><span class="p">:</span>
                    <span class="n">roundf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span>
                <span class="k">elif</span> <span class="n">rounding_type</span> <span class="o">==</span> <span class="s2">&quot;ceiling&quot;</span><span class="p">:</span>
                    <span class="n">roundf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">roundf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span>

                <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_modify</span><span class="p">(</span>
                              <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                                          <span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">roundf</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">prop</span><span class="p">))</span>
                                                    <span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">order_by_column</span>
                                                    <span class="p">,</span> <span class="n">keep</span> <span class="o">=</span> <span class="n">keep_value</span>
                                                    <span class="p">)</span>
                                          <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">tidyframe</span>
                                                <span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span>
                                                <span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span>
                                                <span class="p">)</span>
                                        <span class="p">)</span>
                              <span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">by</span>
                              <span class="p">,</span> <span class="n">preserve_row_order</span> <span class="o">=</span> <span class="kc">True</span>
                              <span class="p">,</span> <span class="n">row_order_column_name</span> <span class="o">=</span> <span class="n">_generate_new_string</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span>
                              <span class="p">)</span>
                           <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span>
                           <span class="o">.</span><span class="n">arrange</span><span class="p">(</span><span class="n">order_by_column</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">by</span><span class="p">)</span>
                      <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># grouped n</span>
                <span class="n">min_group_size</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                                      <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dropna</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                                      <span class="o">.</span><span class="n">size</span><span class="p">()</span>
                                      <span class="o">.</span><span class="n">min</span><span class="p">()</span>
                                      <span class="p">)</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="n">min_group_size</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Minimum group size is &quot;</span><span class="p">,</span> <span class="n">min_group_size</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">min_group_size</span><span class="p">,</span>\
                    <span class="p">(</span><span class="s2">&quot;arg &#39;n&#39; should not exceed the size of any chunk after &quot;</span>
                    <span class="s2">&quot;grouping&quot;</span><span class="p">)</span>
                
                <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_modify</span><span class="p">(</span>
                              <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                                          <span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">n</span>
                                                    <span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">order_by_column</span>
                                                    <span class="p">,</span> <span class="n">keep</span> <span class="o">=</span> <span class="n">keep_value</span>
                                                    <span class="p">)</span>
                                          <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">tidyframe</span>
                                                <span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span>
                                                <span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span>
                                                <span class="p">)</span>
                                        <span class="p">)</span>
                              <span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">by</span>
                              <span class="p">,</span> <span class="n">preserve_row_order</span> <span class="o">=</span> <span class="kc">True</span>
                              <span class="p">,</span> <span class="n">row_order_column_name</span> <span class="o">=</span> <span class="n">_generate_new_string</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span>
                              <span class="p">)</span>
                           <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span>
                           <span class="o">.</span><span class="n">arrange</span><span class="p">(</span><span class="n">order_by_column</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">by</span><span class="p">)</span>
                           <span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">relocate</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span></div>
    
    <span class="c1"># set like methods</span>
<div class="viewcode-block" id="tidyframe.union"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.union">[docs]</a>    <span class="k">def</span> <span class="nf">union</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Union of rows y with the self</span>
<span class="sd">        Equivalent to outer join over all columns</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        y: tidyframe with same columns as x</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy[0:5, :].union(penguins_tidy[1:6, :])</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">colnames</span><span class="p">),</span>\
            <span class="s2">&quot;union expects the column names to match&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)])</span>
                 <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">keep</span> <span class="o">=</span> <span class="s2">&quot;first&quot;</span><span class="p">)</span>
                 <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                 <span class="p">)</span>
        <span class="k">return</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="tidyframe.intersection"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.intersection">[docs]</a>    <span class="k">def</span> <span class="nf">intersection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Intersection of rows y with the self</span>
<span class="sd">        Equivalent to inner join over all columns</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        y: tidyframe with same columns as x</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy[0:5, :].intersection(penguins_tidy[1:6, :])</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">colnames</span><span class="p">),</span>\
            <span class="s2">&quot;intersection expects the column names to match&quot;</span>

        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)])</span>
                 <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;__is_dup&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)})</span>
                 <span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrow</span><span class="p">),</span> <span class="p">:]</span>
                 <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;__is_dup&quot;</span><span class="p">)</span>
                 <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="s2">&quot;__is_dup&quot;</span><span class="p">)</span>
                 <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                 <span class="p">)</span>
        <span class="k">return</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></div>
      
<div class="viewcode-block" id="tidyframe.setdiff"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.setdiff">[docs]</a>    <span class="k">def</span> <span class="nf">setdiff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Keep rows of self which are not in y</span>
<span class="sd">        Equivalent to anti join over all columns</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        y: tidyframe with same columns as x</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy[0:5, :].setdiff(penguins_tidy[1:6, :])</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">colnames</span><span class="p">),</span>\
            <span class="s2">&quot;setdiff expects the column names to match&quot;</span>

        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)])</span>
                 <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;__is_dup&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)})</span>
                 <span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrow</span><span class="p">),</span> <span class="p">:]</span>
                 <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;~__is_dup&quot;</span><span class="p">)</span>
                 <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="s2">&quot;__is_dup&quot;</span><span class="p">)</span>
                 <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                 <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></div>
    
    
    <span class="c1"># na handling methods</span>
    
    <span class="c1">############################################################################</span>
    <span class="c1"># any_na</span>
    <span class="c1">############################################################################</span>
<div class="viewcode-block" id="tidyframe.any_na"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.any_na">[docs]</a>    <span class="k">def</span> <span class="nf">any_na</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Is there a missing value in the dataframe?</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if there is a missing value, False otherwise</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                   <span class="o">.</span><span class="n">isna</span><span class="p">()</span> <span class="c1"># same dim as input</span>
                   <span class="o">.</span><span class="n">any</span><span class="p">()</span>  <span class="c1"># series of booleans per column</span>
                   <span class="o">.</span><span class="n">any</span><span class="p">()</span>  <span class="c1"># single value</span>
                   <span class="p">)</span>
                   
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">res</span><span class="p">)</span></div>
    
  <span class="c1">##############################################################################</span>
  <span class="c1"># replace_na</span>
  <span class="c1">##############################################################################</span>
    
<div class="viewcode-block" id="tidyframe.replace_na"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.replace_na">[docs]</a>    <span class="k">def</span> <span class="nf">replace_na</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Replace missing values with a specified value</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value: dict or a scalar</span>
<span class="sd">            When a dict, key should be a column name and value should be the</span>
<span class="sd">            value to replace by missing values of the column</span>
<span class="sd">            When a scalar, missing values of all columns will be replaced with</span>
<span class="sd">            value</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">            </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.replace_na({&#39;sex&#39;: &#39;unknown&#39;})</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.select(predicate = dtypes.is_numeric_dtype).replace_na(1)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">tidyframe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                          <span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span>
                          <span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span>
                          <span class="p">)</span></div>
    
<div class="viewcode-block" id="tidyframe.drop_na"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.drop_na">[docs]</a>    <span class="k">def</span> <span class="nf">drop_na</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_names</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Drops rows if missing values are present in specified columns</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        column_names: string or list of strings</span>
<span class="sd">            Drop a row if there is a missing value in any of the </span>
<span class="sd">            column_names. When None, all columns are considered.</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">            </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.drop_na() # remove a row if any column has a NA</span>
<span class="sd">        &gt;&gt;&gt; # remove a row only if there is a missing value in &#39;bill_length_mm&#39;</span>
<span class="sd">        &gt;&gt;&gt; # column</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.drop_na(&#39;bill_length_mm&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>
        <span class="k">if</span> <span class="n">column_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_column_names</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="n">cn</span>
        
        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                   <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="s2">&quot;index&quot;</span>
                           <span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s2">&quot;any&quot;</span>
                           <span class="p">,</span> <span class="n">subset</span> <span class="o">=</span> <span class="n">column_names</span>
                           <span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">False</span>
                           <span class="p">)</span>
                   <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                   <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></div>
    
    <span class="c1">############################################################################</span>
    <span class="c1"># fill_na (fill)</span>
    <span class="c1">############################################################################</span>
        
<div class="viewcode-block" id="tidyframe.fill_na"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.fill_na">[docs]</a>    <span class="k">def</span> <span class="nf">fill_na</span><span class="p">(</span><span class="bp">self</span>
                <span class="p">,</span> <span class="n">column_direction_dict</span>
                <span class="p">,</span> <span class="n">order_by</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="p">,</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="p">,</span> <span class="n">na_position</span> <span class="o">=</span> <span class="s2">&quot;last&quot;</span>
                <span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Fill missing values from neighboring values per column</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        column_direction_dict: dict</span>
<span class="sd">            where key is a column name and value is the direction to fill.</span>
<span class="sd">            Direction should be one among: &#39;up&#39;, &#39;down&#39;, &#39;updown&#39; and &#39;downup&#39;</span>
<span class="sd">        order_by: string or list of strings</span>
<span class="sd">            Column names to order by before filling</span>
<span class="sd">        ascending: bool or a list of bools (default: True)</span>
<span class="sd">            Used when order_by is specified</span>
<span class="sd">        na_position: string (default: &#39;last&#39;)</span>
<span class="sd">            One among: &#39;first&#39;, &#39;last&#39;</span>
<span class="sd">        by: string or list of strings</span>
<span class="sd">            Column names to group by </span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. The output might still have missing values after applying fill_na.</span>
<span class="sd">        2. The method preserves the row order.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; df = tidyframe(</span>
<span class="sd">        &gt;&gt;&gt;          pd.DataFrame({&#39;A&#39;: [pd.NA, 1, 1, 2, 2, 3, pd.NA],</span>
<span class="sd">        &gt;&gt;&gt;                        &#39;B&#39;: [pd.NA, pd.NA, 1, 2, pd.NA, pd.NA, 3],</span>
<span class="sd">        &gt;&gt;&gt;                        &#39;C&#39;: [1, 2, 1, 2, 1, 2, 1]</span>
<span class="sd">        &gt;&gt;&gt;                        }</span>
<span class="sd">        &gt;&gt;&gt;                       )</span>
<span class="sd">        &gt;&gt;&gt;          )</span>
<span class="sd">        &gt;&gt;&gt; df</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; df.fill_na({&#39;B&#39;: &#39;up&#39;})</span>
<span class="sd">        &gt;&gt;&gt; df.fill_na({&#39;B&#39;: &#39;down&#39;})</span>
<span class="sd">        &gt;&gt;&gt; df.fill_na({&#39;B&#39;: &#39;downup&#39;})</span>
<span class="sd">        &gt;&gt;&gt; df.fill_na({&#39;B&#39;: &#39;updown&#39;})</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; df.fill_na({&#39;B&#39;: &#39;up&#39;}, by = &#39;A&#39;)</span>
<span class="sd">        &gt;&gt;&gt; df.fill_na({&#39;B&#39;: &#39;down&#39;}, by = &#39;A&#39;)</span>
<span class="sd">        &gt;&gt;&gt; df.fill_na({&#39;B&#39;: &#39;updown&#39;}, by = &#39;A&#39;)</span>
<span class="sd">        &gt;&gt;&gt; df.fill_na({&#39;B&#39;: &#39;downup&#39;}, by = &#39;A&#39;)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; df.fill_na({&#39;B&#39;: &#39;updown&#39;}, order_by = &quot;C&quot;)</span>
<span class="sd">        &gt;&gt;&gt; df.fill_na({&#39;B&#39;: &#39;updown&#39;}, order_by = &quot;C&quot;, by = &quot;A&quot;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column_direction_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;column_direction_dict&#39; should be a dict&quot;</span>
        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">column_direction_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">cn</span><span class="p">),</span>\
            <span class="p">(</span><span class="s2">&quot;keys of &#39;column_direction_dict&#39; should be a subset of existing &quot;</span>
             <span class="s2">&quot;column names&quot;</span>
             <span class="p">)</span>
        <span class="n">valid_methods</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;up&quot;</span><span class="p">,</span> <span class="s2">&quot;down&quot;</span><span class="p">,</span> <span class="s2">&quot;updown&quot;</span><span class="p">,</span> <span class="s2">&quot;downup&quot;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">column_direction_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">valid_methods</span><span class="p">),</span>\
            <span class="p">(</span><span class="s2">&quot;values of &#39;column_direction_dict&#39; should be one among:  &quot;</span>
             <span class="s2">&quot;&#39;up&#39;, &#39;down&#39;, &#39;updown&#39;, &#39;downup&#39;&quot;</span>
             <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">order_by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">order_by</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_order_by</span><span class="p">(</span><span class="n">order_by</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_by</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
            <span class="n">by</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
            
            <span class="c1"># by columns should not be altered</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="n">column_direction_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">by</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">keys</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>\
                <span class="p">(</span><span class="s2">&quot;&#39;by&#39; columns cannot be altered. keys of &#39;column_direction_dict&#39;&quot;</span>
                 <span class="s2">&quot; should not intersect with &#39;by&#39;&quot;</span>
                 <span class="p">)</span>
            
            <span class="c1"># by columns should not intersect with order_by columns</span>
            <span class="k">if</span> <span class="n">order_by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">by</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">order_by</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>\
                    <span class="s2">&quot;&#39;by&#39; columns should not intersect with &#39;order_by&#39; columns&quot;</span>

        <span class="k">def</span> <span class="nf">fill_chunk</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cdd</span><span class="p">):</span>
            
            <span class="n">chunk</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            
            <span class="k">for</span> <span class="n">akey</span> <span class="ow">in</span> <span class="n">cdd</span><span class="p">:</span>
                <span class="n">method</span> <span class="o">=</span> <span class="n">cdd</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;up&quot;</span><span class="p">:</span>
                    <span class="n">chunk</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span> <span class="o">=</span> <span class="n">chunk</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">:</span>
                    <span class="n">chunk</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span> <span class="o">=</span> <span class="n">chunk</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span><span class="o">.</span><span class="n">ffill</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;updown&quot;</span><span class="p">:</span>
                    <span class="n">chunk</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span> <span class="o">=</span> <span class="n">chunk</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span>
                    <span class="n">chunk</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span> <span class="o">=</span> <span class="n">chunk</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span><span class="o">.</span><span class="n">ffill</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">chunk</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span> <span class="o">=</span> <span class="n">chunk</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span><span class="o">.</span><span class="n">ffill</span><span class="p">()</span>
                    <span class="n">chunk</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span> <span class="o">=</span> <span class="n">chunk</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span>
                
            <span class="k">return</span> <span class="n">chunk</span>
        
        <span class="k">if</span> <span class="n">order_by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ro_name</span> <span class="o">=</span> <span class="n">_generate_new_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_row_number</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">ro_name</span><span class="p">)</span><span class="o">.</span><span class="n">arrange</span><span class="p">(</span><span class="n">order_by</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span>
        
        
        
        <span class="k">if</span> <span class="n">by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">group_modify</span><span class="p">(</span>
              <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">fill_chunk</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">column_direction_dict</span><span class="p">)</span>
              <span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">by</span>
              <span class="p">,</span> <span class="n">preserve_row_order</span> <span class="o">=</span> <span class="kc">True</span>
              <span class="p">,</span> <span class="n">is_pandas_udf</span> <span class="o">=</span> <span class="kc">True</span>
              <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                      <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">fill_chunk</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">column_direction_dict</span><span class="p">))</span>
                      <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">))</span>
                      <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">order_by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">arrange</span><span class="p">(</span><span class="n">ro_name</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">ro_name</span><span class="p">,</span> <span class="n">include</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
         
        <span class="k">return</span> <span class="n">res</span></div>
    
    <span class="n">fill</span> <span class="o">=</span> <span class="n">fill_na</span>
    
    <span class="c1"># string utilities</span>
<div class="viewcode-block" id="tidyframe.separate"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.separate">[docs]</a>    <span class="k">def</span> <span class="nf">separate</span><span class="p">(</span><span class="bp">self</span>
                 <span class="p">,</span> <span class="n">column_name</span>
                 <span class="p">,</span> <span class="n">into</span>
                 <span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39;[^[:alnum:]]+&#39;</span>
                 <span class="p">,</span> <span class="n">strict</span> <span class="o">=</span> <span class="kc">True</span>
                 <span class="p">,</span> <span class="n">keep</span> <span class="o">=</span> <span class="kc">False</span>
                 <span class="p">):</span>
        
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Split a string column into multiple string columns rowwise</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        column_name: string</span>
<span class="sd">            Name of the column to split</span>
<span class="sd">        into: list of strings</span>
<span class="sd">            Name of the new columns after slitting the column</span>
<span class="sd">        sep: string</span>
<span class="sd">            Regex to identify the separator</span>
<span class="sd">        strict: bool (default: True)</span>
<span class="sd">            When True, results in an exception if column splits to exactly</span>
<span class="sd">            to result into &#39;into&#39; number of columns.</span>
<span class="sd">        keep: bool (default: False)</span>
<span class="sd">            Whether to keep the original column after splitting</span>
<span class="sd">            </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; df = tidyframe(pd.DataFrame({&#39;col&#39;: [&quot;a_b&quot;, &quot;c_d&quot;, &quot;e_f_g&quot;]}))</span>
<span class="sd">        &gt;&gt;&gt; print(df)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # separate into three columns</span>
<span class="sd">        &gt;&gt;&gt; df.separate(&#39;col&#39;, into = [&quot;col_1&quot;, &quot;col_2&quot;, &quot;col_3&quot;], sep = &quot;_&quot;)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # separate into two columns and ignore the last piece</span>
<span class="sd">        &gt;&gt;&gt; df.separate(&#39;col&#39;, into = [&quot;col_1&quot;, &quot;col_2&quot;], sep = &quot;_&quot;, strict = False)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;column_name&#39; should be a string&quot;</span>
        <span class="k">assert</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">,</span>\
            <span class="s2">&quot;arg &#39;column_name&#39; should be an existing column name&quot;</span>
        <span class="k">assert</span> <span class="n">_is_string_or_string_list</span><span class="p">(</span><span class="n">into</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;into&#39; should be a list of strings&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">into</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span>\
            <span class="s2">&quot;arg &#39;into&#39; should be a list of strings&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;sep&#39; should be a string&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">strict</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;strict&#39; should be a bool&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keep</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;keep&#39; should be a bool&quot;</span> 
            
        <span class="c1"># split  and form a pandas df</span>
        <span class="n">split_df</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">]</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">else</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull</span><span class="p">(</span><span class="n">column_name</span><span class="p">)])</span>
                      <span class="o">.</span><span class="n">convert_dtypes</span><span class="p">()</span>
                      <span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">into</span><span class="p">)</span> <span class="o">==</span> <span class="n">split_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">split_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">into</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">into</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">split_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="c1"># more pieces than expected</span>
            <span class="k">if</span> <span class="n">strict</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">((</span><span class="s2">&quot;Column is split into more number of columns&quot;</span>
                                 <span class="s2">&quot; than the length of &#39;into&#39;&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># keep only &#39;into&#39; columns</span>
                <span class="n">split_df</span> <span class="o">=</span> <span class="n">split_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">into</span><span class="p">)]</span>
                <span class="n">split_df</span> <span class="o">=</span> <span class="n">split_df</span><span class="o">.</span><span class="n">set_axis</span><span class="p">(</span><span class="n">into</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="s1">&#39;columns&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># less pieces than expected</span>
            <span class="k">if</span> <span class="n">strict</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">((</span><span class="s2">&quot;Column is split into less number of columns&quot;</span>
                                 <span class="s2">&quot; than the length of &#39;into&#39;&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">split_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">into</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">split_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>     
            
        <span class="k">if</span> <span class="n">keep</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbind</span><span class="p">(</span><span class="n">tidyframe</span><span class="p">(</span><span class="n">split_df</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbind</span><span class="p">(</span><span class="n">tidyframe</span><span class="p">(</span><span class="n">split_df</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">))</span>
                       <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">column_name</span><span class="p">,</span> <span class="n">include</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                       <span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div>
    
<div class="viewcode-block" id="tidyframe.unite"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.unite">[docs]</a>    <span class="k">def</span> <span class="nf">unite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_names</span><span class="p">,</span> <span class="n">into</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">keep</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Split a string column into multiple string columns rowwise</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        column_name: string</span>
<span class="sd">            Name of the column to split</span>
<span class="sd">        into: list of strings</span>
<span class="sd">            Name of the new columns after slitting the column</span>
<span class="sd">        sep: string</span>
<span class="sd">            Regex to identify the separator</span>
<span class="sd">        strict: bool (default: True)</span>
<span class="sd">            When True, results in an exception if column splits to exactly</span>
<span class="sd">            to result into &#39;into&#39; number of columns.</span>
<span class="sd">        keep: bool (default: False)</span>
<span class="sd">            Whether to keep the original column after splitting</span>
<span class="sd">            </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; df = tidyframe(pd.DataFrame({&#39;col&#39;: [&quot;a_b&quot;, &quot;c_d&quot;, &quot;e_f_g&quot;]}))</span>
<span class="sd">        &gt;&gt;&gt; print(df)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # separate into three columns</span>
<span class="sd">        &gt;&gt;&gt; (df.separate(&#39;col&#39;, into = [&quot;col_1&quot;, &quot;col_2&quot;, &quot;col_3&quot;], sep = &quot;_&quot;)</span>
<span class="sd">        &gt;&gt;&gt;    .unite(column_names = [&quot;col_1&quot;, &quot;col_2&quot;, &quot;col_3&quot;], into = &quot;united&quot;, sep = &quot;_&quot;)</span>
<span class="sd">        &gt;&gt;&gt;    )</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # separate into two columns and ignore the last piece</span>
<span class="sd">        &gt;&gt;&gt; df.separate(&#39;col&#39;, into = [&quot;col_1&quot;, &quot;col_2&quot;], sep = &quot;_&quot;, strict = False)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        
        <span class="k">def</span> <span class="nf">reduce_join</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">sep</span><span class="p">):</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
            <span class="n">slist</span> <span class="o">=</span> <span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">]</span>
            <span class="n">red_series</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">sep</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span> <span class="n">slist</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">slist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">red_series</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">into</span><span class="p">)</span>
                
        <span class="n">joined</span> <span class="o">=</span> <span class="n">reduce_join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">,</span> <span class="n">column_names</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">keep</span><span class="p">:</span>
           <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbind</span><span class="p">(</span><span class="n">tidyframe</span><span class="p">(</span><span class="n">joined</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">))</span>
                      <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">column_names</span><span class="p">,</span> <span class="n">include</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>    
                      <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
           <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbind</span><span class="p">(</span><span class="n">tidyframe</span><span class="p">(</span><span class="n">joined</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">))</span> 
         
        <span class="k">return</span> <span class="n">res</span></div>
    
<div class="viewcode-block" id="tidyframe.separate_rows"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.separate_rows">[docs]</a>    <span class="k">def</span> <span class="nf">separate_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_name</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39;;&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        split a string column using a seperator and create a row for each</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        column_name: string</span>
<span class="sd">            A column name to split</span>
<span class="sd">        </span>
<span class="sd">        sep: string</span>
<span class="sd">            regex to split</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; temp = tidyframe(pd.DataFrame({&quot;A&quot;: [&quot;hello;world&quot;, &quot;hey,mister;o/mister&quot;]}))</span>
<span class="sd">        &gt;&gt;&gt; temp</span>
<span class="sd">        &gt;&gt;&gt; temp.separate_rows(&#39;A&#39;, sep = &quot;,|;&quot;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;column_name&#39; should be a string&quot;</span>
        <span class="k">assert</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">,</span>\
            <span class="s2">&quot;arg &#39;column_name&#39; should be an exisiting column name&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;sep&#39; should be a string&quot;</span>
        
        <span class="k">def</span> <span class="nf">splitter</span><span class="p">(</span><span class="n">str_col</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">str_col</span><span class="p">]</span>
            
        <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                   <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">column_name</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">splitter</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">column_name</span><span class="p">])})</span>
                   <span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="n">column_name</span><span class="p">,</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                   <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></div>
    
    <span class="c1">##########################################################################</span>
    <span class="c1"># nest and unnest</span>
    <span class="c1">##########################################################################</span>
    
    
    <span class="c1">##########################################################################</span>
    <span class="c1"># nest_by</span>
    <span class="c1">##########################################################################</span>
<div class="viewcode-block" id="tidyframe.nest_by"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.nest_by">[docs]</a>    <span class="k">def</span> <span class="nf">nest_by</span><span class="p">(</span><span class="bp">self</span>
                <span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="p">,</span> <span class="n">nest_column_name</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span>
                <span class="p">,</span> <span class="n">drop_by</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Nest all columns of tidy dataframe with respect to &#39;by&#39; columns</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        by: str or list of strings</span>
<span class="sd">            Columns to stay, rest of them are nested</span>
<span class="sd">        nest_column_name: str</span>
<span class="sd">            Name of the resulting nested column (pandas Series)</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. &#39;by&#39; should not contain all column names (some columns should be left</span>
<span class="sd">           for nesting)</span>
<span class="sd">           </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>

<span class="sd">        &gt;&gt;&gt; penguins_tidy.nest_by(by = &#39;species&#39;)</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.nest_by(by = [&#39;species&#39;, &#39;sex&#39;])</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_by</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
        <span class="n">by</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">by</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">cn</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;by&#39; should not contain all exisiting column names&quot;</span>
        
        <span class="k">assert</span> <span class="n">nest_column_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cn</span><span class="p">,</span>\
            <span class="s2">&quot;arg &#39;nest_column_name&#39; should not be an exisiting column name&quot;</span>
            
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_by</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span>\
            <span class="s2">&quot;arg &#39;drop_by&#39; should be a bool&quot;</span>
        
        <span class="n">pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        
        <span class="n">extra</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">by</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">extra</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">new_colname</span> <span class="o">=</span> <span class="n">_generate_new_string</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span>
            <span class="n">by</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_colname</span><span class="p">]</span> <span class="o">+</span> <span class="n">by</span> <span class="c1"># note that by has changed</span>
    
        <span class="k">if</span> <span class="n">extra</span><span class="p">:</span>
            <span class="n">go</span> <span class="o">=</span> <span class="p">(</span><span class="n">pdf</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">new_colname</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
                     <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dropna</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                     <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">go</span> <span class="o">=</span> <span class="n">pdf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dropna</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                      
        <span class="n">res</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">by</span><span class="p">)</span>
          
        
        <span class="c1"># add data into nest_column_name column</span>
        <span class="k">if</span> <span class="n">drop_by</span><span class="p">:</span>
            <span class="n">res</span><span class="p">[</span><span class="n">nest_column_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">by</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">),</span>
                              <span class="nb">dict</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">go</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                              <span class="p">)</span>
                          <span class="p">)</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># drop the extra column in the nested column</span>
            <span class="k">if</span> <span class="n">extra</span><span class="p">:</span>
                <span class="n">res</span><span class="p">[</span><span class="n">nest_column_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">new_colname</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">),</span>
                                  <span class="nb">dict</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">go</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                                  <span class="p">)</span>
                              <span class="p">)</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span><span class="p">[</span><span class="n">nest_column_name</span><span class="p">]</span> <span class="o">=</span>\
                    <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">),</span>
                                  <span class="nb">dict</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">go</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                                  <span class="p">)</span>
                              <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">extra</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">new_colname</span><span class="p">)</span>
        
        <span class="n">res</span><span class="p">[</span><span class="n">nest_column_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span> 
            <span class="n">res</span><span class="p">[</span><span class="n">nest_column_name</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">tidyframe</span><span class="p">(</span>
                                                    <span class="n">x</span>
                                                    <span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span>
                                                    <span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span>
                                                    <span class="p">)</span>
                                        <span class="p">)</span>
                                <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></div>
                                   
    <span class="c1">##########################################################################</span>
    <span class="c1"># nest</span>
    <span class="c1">##########################################################################                               </span>
<div class="viewcode-block" id="tidyframe.nest"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.nest">[docs]</a>    <span class="k">def</span> <span class="nf">nest</span><span class="p">(</span><span class="bp">self</span>
             <span class="p">,</span> <span class="n">column_names</span> <span class="o">=</span> <span class="kc">None</span>
             <span class="p">,</span> <span class="n">nest_column_name</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span>
             <span class="p">,</span> <span class="n">include</span> <span class="o">=</span> <span class="kc">True</span>
             <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Nest columns of tidy dataframe</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        column_names: str or list of strings</span>
<span class="sd">            Columns to be nested</span>
<span class="sd">        nest_column_name: str</span>
<span class="sd">            Name of the resulting nested column (pandas Series)</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. &#39;column_names&#39; should not contain all column names.</span>
<span class="sd">           </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.nest([&#39;bill_length_mm&#39;, &#39;bill_depth_mm&#39;,</span>
<span class="sd">        &gt;&gt;&gt;                     &#39;flipper_length_mm&#39;, &#39;body_mass_g&#39;]</span>
<span class="sd">        &gt;&gt;&gt;                    )</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.nest([&#39;species&#39;, &#39;sex&#39;], include = False)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_column_names</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">include</span><span class="p">:</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">setlist</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">column_names</span><span class="p">))</span>
        <span class="n">by</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">setlist</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">column_names</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">by</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>\
            <span class="s2">&quot;arg &#39;column_names&#39; should not have all existing column names&quot;</span>
            
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nest_by</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="n">by</span><span class="p">,</span> <span class="n">nest_column_name</span> <span class="o">=</span> <span class="n">nest_column_name</span><span class="p">)</span></div>
        
    <span class="c1">##########################################################################</span>
    <span class="c1"># unnest</span>
    <span class="c1">##########################################################################    </span>
<div class="viewcode-block" id="tidyframe.unnest"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.unnest">[docs]</a>    <span class="k">def</span> <span class="nf">unnest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nest_column_name</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Unnest a nested column of a tidy dataframe</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nest_column_name: str</span>
<span class="sd">            Name of the column to be unnested</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. unnest does not support a mix of nested lists and dataframe in the</span>
<span class="sd">           same column</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; nested_pdf = pd.DataFrame({&quot;A&quot;: [1,2,3, 4],</span>
<span class="sd">        &gt;&gt;&gt;                            &quot;B&quot;: pd.Series([[10, 20, 30],</span>
<span class="sd">        &gt;&gt;&gt;                                            [40, 50],</span>
<span class="sd">        &gt;&gt;&gt;                                            [60],</span>
<span class="sd">        &gt;&gt;&gt;                                            70</span>
<span class="sd">        &gt;&gt;&gt;                                           ]</span>
<span class="sd">        &gt;&gt;&gt;                                          )</span>
<span class="sd">        &gt;&gt;&gt;                   })</span>
<span class="sd">        &gt;&gt;&gt; nested_pdf</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # unnest nested lists</span>
<span class="sd">        &gt;&gt;&gt; tidyframe(nested_pdf).unnest(&#39;B&#39;)</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins = load_penguins().convert_dtypes()</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(penguins)</span>
<span class="sd">        &gt;&gt;&gt; pen_nested_by_species = penguins_tidy.nest_by(&#39;species&#39;)</span>
<span class="sd">        &gt;&gt;&gt; pen_nested_by_species</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # unnest nested dataframes</span>
<span class="sd">        &gt;&gt;&gt; pen_nested_by_species.unnest(&#39;data&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrow</span>
        <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>
        
        <span class="k">assert</span> <span class="n">nest_column_name</span> <span class="ow">in</span> <span class="n">cn</span><span class="p">,</span>\
            <span class="s2">&quot;arg &#39;nest_column_name&#39; should be a exisiting column name&quot;</span>
            
        <span class="n">all_are_tidy</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tidyframe</span><span class="p">)</span>
                               <span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">[</span><span class="n">nest_column_name</span><span class="p">])</span>
                               <span class="p">)</span>
                           <span class="p">)</span>
        
        <span class="k">def</span> <span class="nf">is_list_scalar_na</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">arrays</span><span class="o">.</span><span class="n">floating</span><span class="o">.</span><span class="n">FloatingArray</span><span class="p">)):</span>
                <span class="n">res</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="n">res</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="n">res</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="n">res</span>
        
        <span class="n">all_are_list</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">is_list_scalar_na</span>
                               <span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">[</span><span class="n">nest_column_name</span><span class="p">])</span>
                               <span class="p">)</span>
                           <span class="p">)</span>
         
        <span class="k">assert</span> <span class="n">all_are_tidy</span> <span class="ow">or</span> <span class="n">all_are_list</span><span class="p">,</span>\
            <span class="p">(</span><span class="s2">&quot;arg &#39;nest_column_name&#39; column is neither a column of &quot;</span>
             <span class="s2">&quot;tidyframes nor a column or lists or scalars&quot;</span>
             <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">all_are_tidy</span><span class="p">:</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">setlist</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">([</span><span class="n">nest_column_name</span><span class="p">]))</span>
            <span class="c1"># create a filled up dataframe per row via cross join and rbind them</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">x</span><span class="p">],</span> <span class="n">cols</span><span class="p">]</span>
                      <span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">[</span><span class="n">nest_column_name</span><span class="p">][</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                      <span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;cross&#39;</span>
                      <span class="p">)</span>
                    <span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">nr</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="s1">&#39;index&#39;</span>
                <span class="p">,</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
                       <span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="n">column</span> <span class="o">=</span> <span class="n">nest_column_name</span><span class="p">)</span>
                       <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                       <span class="p">)</span>
                
        <span class="k">return</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">res</span><span class="p">)</span></div>
    
    <span class="c1">##########################################################################</span>
    <span class="c1"># split (group_split)</span>
    <span class="c1">##########################################################################</span>
<div class="viewcode-block" id="tidyframe.split"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.split">[docs]</a>    <span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">by</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        split</span>
<span class="sd">        split rows of a dataframe by groups</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        by: string or a list of strings</span>
<span class="sd">            columns to group by</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of tidyframes</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.split(by = &quot;species&quot;)t</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_by</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
        <span class="n">by</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
        <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>
        <span class="n">group_cn</span> <span class="o">=</span> <span class="n">_generate_new_string</span><span class="p">(</span><span class="n">cn</span><span class="p">)</span>
        
        <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">tuple</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">add_group_number</span><span class="p">(</span><span class="n">by</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">group_cn</span><span class="p">)</span>
                                        <span class="o">.</span><span class="n">__data</span>
                                        <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">group_cn</span>
                                                 <span class="p">,</span> <span class="n">dropna</span> <span class="o">=</span> <span class="kc">False</span>
                                                 <span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">False</span>
                                                 <span class="p">)</span>
                                        <span class="p">))]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">[(</span><span class="n">tidyframe</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">),</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
               <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">group_cn</span><span class="p">,</span> <span class="n">include</span> <span class="o">=</span> <span class="kc">False</span><span class="p">))</span>
               <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">res</span>
               <span class="p">]</span>
        <span class="k">return</span> <span class="n">res</span></div>
    
    <span class="n">group_split</span> <span class="o">=</span> <span class="n">split</span>
    
    <span class="c1">##########################################################################</span>
    <span class="c1"># getitem and setitem based on pandas loc</span>
    <span class="c1">##########################################################################</span>
    
<div class="viewcode-block" id="tidyframe.__getitem__"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.__getitem__">[docs]</a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
      <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">      Subset some and columns of the dataframe</span>
<span class="sd">      Always returns a copy and not a view</span>
<span class="sd">      </span>
<span class="sd">      Parameters</span>
<span class="sd">      ----------</span>
<span class="sd">      key: tuple of x and y subset operations</span>
<span class="sd">      </span>
<span class="sd">      Returns</span>
<span class="sd">      -------</span>
<span class="sd">      tidyframe</span>
<span class="sd">      </span>
<span class="sd">      Notes</span>
<span class="sd">      -----</span>
<span class="sd">      1. Rows can be subset by specifying integer positions </span>
<span class="sd">         (as int, list, slice and range objects) or by providing a boolean mask.</span>
<span class="sd">      </span>
<span class="sd">      2. Columns can be subset by specifiying integer positions </span>
<span class="sd">         (as int, list, slice and range objects) or by specifying a list of unique </span>
<span class="sd">         column names or by providing a boolean mask.</span>
<span class="sd">      </span>
<span class="sd">      3. Any combination of row and column specifications work together.</span>
<span class="sd">      </span>
<span class="sd">      Examples</span>
<span class="sd">      --------</span>
<span class="sd">      &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">      &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">      &gt;&gt;&gt; </span>
<span class="sd">      &gt;&gt;&gt; # Rows can be subset with integer indexes with slice objects</span>
<span class="sd">      &gt;&gt;&gt; # right end is not included in slice objects</span>
<span class="sd">      &gt;&gt;&gt; # first four rows</span>
<span class="sd">      &gt;&gt;&gt; penguins_tidy[0:4,:]</span>
<span class="sd">      &gt;&gt;&gt; </span>
<span class="sd">      &gt;&gt;&gt; # a row can be subset with a single integer</span>
<span class="sd">      &gt;&gt;&gt; # moreover subsetting always returns a dataframe</span>
<span class="sd">      &gt;&gt;&gt; penguins_tidy[10, :]</span>
<span class="sd">      &gt;&gt;&gt; </span>
<span class="sd">      &gt;&gt;&gt; # Rows can be subset with a boolean mask </span>
<span class="sd">      &gt;&gt;&gt; penguins_tidy[penguins_tidy.pull(&#39;bill_length_mm&#39;) &gt; 40, :]</span>
<span class="sd">      &gt;&gt;&gt; </span>
<span class="sd">      &gt;&gt;&gt; # Columns can be subset using column names</span>
<span class="sd">      &gt;&gt;&gt; penguins_tidy[0:5, [&quot;species&quot;, &quot;year&quot;]]</span>
<span class="sd">      &gt;&gt;&gt; </span>
<span class="sd">      &gt;&gt;&gt; # A single column can be subset by specifying column name as a string</span>
<span class="sd">      &gt;&gt;&gt; # moreover subsetting always returns a dataframe </span>
<span class="sd">      &gt;&gt;&gt; penguins_tidy[0:5, &quot;species&quot;] # same as: penguins_tidy[0:5, [&quot;species&quot;]]</span>
<span class="sd">      &gt;&gt;&gt; </span>
<span class="sd">      &gt;&gt;&gt; # columns can be subset by integer position</span>
<span class="sd">      &gt;&gt;&gt; penguins_tidy[[7, 6, 5], 0:3]</span>
<span class="sd">      &gt;&gt;&gt; </span>
<span class="sd">      &gt;&gt;&gt; # row and columns can be subset with different types of specifications</span>
<span class="sd">      &gt;&gt;&gt; penguins_tidy[0:2, 1] # same as: penguins_tidy[[0, 1], &#39;island&#39;]</span>
<span class="sd">      &#39;&#39;&#39;</span>
      <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>
      <span class="n">key</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
      
      <span class="c1"># handle a single integer for row</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
      <span class="c1"># slice should work like regular python (right end is not included)</span>
      <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">slice</span><span class="p">):</span>
        <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrow</span><span class="p">)[</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        
      <span class="c1"># handle integer indexing for columns</span>
      <span class="n">is_int</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span>
      <span class="n">is_int_list</span> <span class="o">=</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> 
                     <span class="ow">and</span> 
                     <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                     <span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">is_int</span> <span class="ow">or</span> <span class="n">is_int_list</span><span class="p">):</span>
        <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">assert</span> <span class="n">_is_unique_list</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>\
            <span class="s2">&quot;Integer index for columns should be unique&quot;</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span>\
            <span class="s2">&quot;Integer index for columns should be non-negative&quot;</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncol</span><span class="p">,</span>\
            <span class="s2">&quot;Integer index for columns is beyond the range&quot;</span>
        
        <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">cn</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
      <span class="c1"># slice should work like regular python (right end is not included)</span>
      <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">slice</span><span class="p">):</span>
        <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cn</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
      <span class="c1"># handle single string column index</span>
      <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      
      <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                 <span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                 <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                 <span class="p">)</span>
      <span class="k">return</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="tidyframe.__setitem__"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.__setitem__">[docs]</a>    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
      <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">      Change a subset of the dataframe in-place</span>
<span class="sd">      </span>
<span class="sd">      Parameters</span>
<span class="sd">      ----------</span>
<span class="sd">      key: tuple of x and y subset operations</span>
<span class="sd">      value: value to be assigned</span>
<span class="sd">      </span>
<span class="sd">      Returns</span>
<span class="sd">      -------</span>
<span class="sd">      tidyframe</span>
<span class="sd">      </span>
<span class="sd">      Notes</span>
<span class="sd">      -----</span>
<span class="sd">      1. Rows can be subset by specifying integer positions </span>
<span class="sd">         (as int, list, slice and range objects) or by providing a boolean mask.</span>
<span class="sd">      </span>
<span class="sd">      2. Columns can be subset by specifiying integer positions </span>
<span class="sd">         (as int, list, slice and range objects) or by specifying a list of unique </span>
<span class="sd">         column names or by providing a boolean mask.</span>
<span class="sd">      </span>
<span class="sd">      3. Any combination of row and column specifications work together.</span>
<span class="sd">      </span>
<span class="sd">      4. Assignment is done by &quot;pdf.loc[exp1, exp2] = value&quot;. Incompatible value</span>
<span class="sd">         assignment exceptions are handled by this method and they will cascade.</span>
<span class="sd">      </span>
<span class="sd">      Examples</span>
<span class="sd">      --------</span>
<span class="sd">      &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">      &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">      &gt;&gt;&gt; </span>
<span class="sd">      &gt;&gt;&gt; # assign a single value with correct type</span>
<span class="sd">      &gt;&gt;&gt; penguins_tidy[0,0] = &quot;a&quot;</span>
<span class="sd">      &gt;&gt;&gt; penguins_tidy[0:5, :]</span>
<span class="sd">      &gt;&gt;&gt; </span>
<span class="sd">      &gt;&gt;&gt; # assign a multiple values with correct type</span>
<span class="sd">      &gt;&gt;&gt; penguins_tidy[0:3,0] = &quot;b&quot;</span>
<span class="sd">      &gt;&gt;&gt; penguins_tidy[0:5, :]</span>
<span class="sd">      &gt;&gt;&gt; </span>
<span class="sd">      &gt;&gt;&gt; # assign a row partially by a list of appropriate types</span>
<span class="sd">      &gt;&gt;&gt; penguins_tidy[0, [&#39;species&#39;, &#39;bill_length_mm&#39;]] = [&#39;c&#39;, 1]</span>
<span class="sd">      &gt;&gt;&gt; penguins_tidy[0:5, :]</span>
<span class="sd">      &gt;&gt;&gt; </span>
<span class="sd">      &gt;&gt;&gt; # assign a subset with another tidyframe</span>
<span class="sd">      &gt;&gt;&gt; penguins_tidy[0:2, 0:2] = pd.DataFrame({&#39;species&#39;: [&#39;d&#39;, &#39;e&#39;]</span>
<span class="sd">      &gt;&gt;&gt;                                         , &#39;island&#39;: [&#39;f&#39;, &#39;g&#39;]</span>
<span class="sd">      &gt;&gt;&gt;                                      &quot;&quot;   }).pipe(tidyframe)</span>
<span class="sd">      &gt;&gt;&gt; penguins_tidy[0:5, :]</span>
<span class="sd">      &#39;&#39;&#39;</span>
      <span class="n">cn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>
      <span class="n">key</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
      
      <span class="c1"># handle a single integer for row</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
      <span class="c1"># slice should work like regular python (right end is not included)</span>
      <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">slice</span><span class="p">):</span>
        <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrow</span><span class="p">)[</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        
      <span class="c1"># handle integer indexing for columns</span>
      <span class="n">is_int</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span>
      <span class="n">is_int_list</span> <span class="o">=</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> 
               <span class="ow">and</span> 
               <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
               <span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">is_int</span> <span class="ow">or</span> <span class="n">is_int_list</span><span class="p">):</span>
        <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">assert</span> <span class="n">_is_unique_list</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>\
            <span class="s2">&quot;Integer index for columns should be unique&quot;</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span>\
            <span class="s2">&quot;Integer index for columns should be non-negative&quot;</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncol</span><span class="p">,</span>\
            <span class="s2">&quot;Integer index for columns is beyond the range&quot;</span>
        
        <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">cn</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
      <span class="c1"># slice should work like regular python (right end is not included)</span>
      <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">slice</span><span class="p">):</span>
        <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cn</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
      <span class="c1"># handle single string column index</span>
      <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">_enlist</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      
      <span class="c1"># handle the case when value is a pandas dataframe</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
                            <span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">groupby</span><span class="o">.</span><span class="n">generic</span><span class="o">.</span><span class="n">DataFrameGroupBy</span>
                            <span class="p">)):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;When arg &#39;value&#39; is a dataframe, then it should be a &quot;</span>
               <span class="s2">&quot;tidyframe and not a pandas dataframe&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
      
      <span class="c1"># handle when value is a tidy pdf</span>
      <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">tidyframe</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
      
      <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">value</span></div>
      <span class="c1"># nothing to return as this is an inplace operation</span>
    
    <span class="c1">############################################################################</span>
    <span class="c1"># expand</span>
    <span class="c1">############################################################################</span>
    
<div class="viewcode-block" id="tidyframe._crossing"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe._crossing">[docs]</a>    <span class="k">def</span> <span class="nf">_crossing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col_list</span><span class="p">):</span>
        
        <span class="c1"># I/O are tidyframes</span>
        <span class="k">def</span> <span class="nf">pick_distinct</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">colname</span><span class="p">):</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pull</span><span class="p">(</span><span class="n">colname</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;category&#39;</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">tidyframe</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">colname</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="p">)}))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="n">colname</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">res</span>
                
        <span class="k">if</span> <span class="n">_is_string_or_string_list</span><span class="p">(</span><span class="n">col_list</span><span class="p">):</span>
            <span class="n">d_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">pick_distinct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">col_list</span><span class="p">))]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># each element is a tidyframe</span>
            <span class="n">d_list</span> <span class="o">=</span> <span class="n">col_list</span>
        
        <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">cross_join</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">(),</span> <span class="n">d_list</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="tidyframe._nesting"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe._nesting">[docs]</a>    <span class="k">def</span> <span class="nf">_nesting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_string_or_string_list</span><span class="p">(</span><span class="n">col_list</span><span class="p">):</span>
            <span class="c1"># each element is a tidyframe</span>
            <span class="n">d_list</span> <span class="o">=</span> <span class="n">col_list</span>
            <span class="n">col_list</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">colnames</span><span class="p">),</span>
                                        <span class="n">d_list</span>
                                        <span class="p">)</span>
            <span class="n">col_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">col_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="n">col_list</span><span class="p">)</span></div>
        
        
<div class="viewcode-block" id="tidyframe._flatten"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe._flatten">[docs]</a>    <span class="k">def</span> <span class="nf">_flatten</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec_list</span><span class="p">,</span> <span class="n">is_tuple</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec_list</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">_is_nested</span><span class="p">(</span><span class="n">spec_list</span><span class="p">):</span>
            <span class="c1"># break down each element to a dataframe</span>
            <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spec_list</span><span class="p">)):</span>
                <span class="c1"># simple column</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec_list</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="c1"># get single column distinct tidyframe</span>
                    <span class="n">res</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="n">spec_list</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec_list</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">set</span><span class="p">)),</span>\
                        <span class="s2">&quot;every element of spec should be a string, tuple or a set&quot;</span>
                    <span class="c1"># tuple or a set</span>
                    <span class="k">if</span> <span class="n">_is_nested</span><span class="p">(</span><span class="n">spec_list</span><span class="p">[</span><span class="n">ind</span><span class="p">]):</span>
                        <span class="c1"># recursive call when nested</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec_list</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
                            <span class="n">res</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">spec_list</span><span class="p">[</span><span class="n">ind</span><span class="p">]),</span>
                                                     <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec_list</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">)</span>
                                                     <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># set, thereby nesting, simply flatten inside</span>
                            <span class="n">res</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nesting</span><span class="p">(</span><span class="n">_flatten_strings</span><span class="p">(</span><span class="n">spec_list</span><span class="p">[</span><span class="n">ind</span><span class="p">]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># now that we have a flat structure</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec_list</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
                            <span class="n">res</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crossing</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">spec_list</span><span class="p">[</span><span class="n">ind</span><span class="p">]))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">res</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nesting</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">spec_list</span><span class="p">[</span><span class="n">ind</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">spec_list</span>
        
        <span class="c1"># now handle the outer list &#39;res&#39;          </span>
        <span class="k">if</span> <span class="n">is_tuple</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crossing</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nesting</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        
        <span class="c1"># handle categorical dtype</span>
        <span class="n">is_cat</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">copy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                      <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;category&#39;</span><span class="p">)</span>
                      <span class="p">)</span>
        <span class="n">cat_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">is_cat</span><span class="o">.</span><span class="n">index</span><span class="p">))[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">is_cat</span><span class="p">))])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cat_cols</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">acatcol</span> <span class="ow">in</span> <span class="n">cat_cols</span><span class="p">:</span>
                <span class="n">res</span><span class="o">.</span><span class="n">__data</span><span class="p">[</span><span class="n">acatcol</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">pull</span><span class="p">(</span><span class="n">acatcol</span><span class="p">),</span>
                                                     <span class="n">categories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pull</span><span class="p">(</span><span class="n">acatcol</span><span class="p">)</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span>
                                                     <span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="tidyframe._expand"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe._expand">[docs]</a>    <span class="k">def</span> <span class="nf">_expand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">set</span><span class="p">)),</span>\
            <span class="s2">&quot;spec should be a tuple or a set&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span><span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span>\
            <span class="s2">&quot;minimum length of spec should be 2&quot;</span>
        <span class="k">assert</span> <span class="n">_nested_is_unique</span><span class="p">(</span><span class="n">spec</span><span class="p">),</span>\
            <span class="s2">&quot;column names should be unique&quot;</span>
        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">_flatten_strings</span><span class="p">(</span><span class="n">spec</span><span class="p">))</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">),</span>\
            <span class="s2">&quot;all strings in spec should be valid column names&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">spec</span><span class="p">),</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="tidyframe.expand"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.expand">[docs]</a>    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Creates combinations of columns using specification</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        spec: tuple or set</span>
<span class="sd">            See Notes and Examples</span>
<span class="sd">        by: string or a list of strings</span>
<span class="sd">            Column names to group by</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        A specification is a nested combination of two types:</span>
<span class="sd">            1. crossing: Generates all possible distinct combinations of columns</span>
<span class="sd">                        example: (&#39;col_1&#39;, &#39;col_2&#39;)</span>
<span class="sd">            2. nesting: Generates only exisiting distinct combinations of columns</span>
<span class="sd">                        example: {&#39;col_1&#39;, &#39;col_2&#39;, &#39;col_3&#39;}</span>
<span class="sd">            </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from tidypandas import tidyframe</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # crossing: tuple bracket</span>
<span class="sd">        &gt;&gt;&gt; # nesting: set bracket</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # simple crossing</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.expand((&quot;species&quot;, &quot;island&quot;))</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # simple nesting</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.expand({&quot;species&quot;, &quot;island&quot;})</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # nest outside and crossing inside</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.expand({&quot;sex&quot;, (&quot;species&quot;, &quot;island&quot;)})</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # crossing outside and nesting inside</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.expand((&quot;sex&quot;, {&quot;species&quot;, &quot;island&quot;}))</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # more &#39;nesting&#39;</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.expand(((&quot;year&quot;, &quot;bill_length_mm&quot;), {&quot;species&quot;, &quot;island&quot;}))</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # grouped expand</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.expand({&quot;species&quot;, &quot;island&quot;}, by = &#39;sex&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">by</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_by</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">by</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">_flatten_strings</span><span class="p">(</span><span class="n">spec</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>\
                <span class="s2">&quot;&#39;by&#39; columns should not be present in &#39;spec&#39;&quot;</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_modify</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">_expand</span><span class="p">(</span><span class="n">spec</span><span class="p">),</span> <span class="n">by</span> <span class="o">=</span> <span class="n">by</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="tidyframe._complete"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe._complete">[docs]</a>    <span class="k">def</span> <span class="nf">_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">expanded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="n">cn</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">expanded</span><span class="o">.</span><span class="n">colnames</span><span class="p">))</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_join</span><span class="p">(</span><span class="n">expanded</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="n">cn</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fill</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">replace_na</span><span class="p">(</span><span class="n">fill</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div>
    
<div class="viewcode-block" id="tidyframe.complete"><a class="viewcode-back" href="../../autoapi/tidypandas/tidyframe_class/index.html#tidypandas.tidyframe.complete">[docs]</a>    <span class="k">def</span> <span class="nf">complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Completes a tidyframe with missing combinations of data</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        spec: tuple or set</span>
<span class="sd">            See Notes and Examples</span>
<span class="sd">        fill: scalar, dict</span>
<span class="sd">            scalar value to fill missing values or</span>
<span class="sd">            dict (key: column name, value: value to fill)</span>
<span class="sd">        by: string or a list of strings</span>
<span class="sd">            Column names to group by</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tidyframe</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        A specification is a nested combination of two types:</span>
<span class="sd">            1. crossing: Generates all possible distinct combinations of columns</span>
<span class="sd">                        example: (&#39;col_1&#39;, &#39;col_2&#39;)</span>
<span class="sd">            2. nesting: Generates only exisiting distinct combinations of columns</span>
<span class="sd">                        example: {&#39;col_1&#39;, &#39;col_2&#39;, &#39;col_3&#39;}</span>
<span class="sd">            </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from tidypandas import tidyframe</span>
<span class="sd">        &gt;&gt;&gt; from palmerpenguins import load_penguins</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy = tidyframe(load_penguins())</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # crossing: tuple bracket</span>
<span class="sd">        &gt;&gt;&gt; # nesting: set bracket</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # simple crossing</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.complete((&quot;species&quot;, &quot;island&quot;))</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # simple nesting</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.complete({&quot;species&quot;, &quot;island&quot;})</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # nest outside and crossing inside</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.complete({&quot;sex&quot;, (&quot;species&quot;, &quot;island&quot;)})</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # crossing outside and nesting inside</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.complete((&quot;sex&quot;, {&quot;species&quot;, &quot;island&quot;}))</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # more &#39;nesting&#39;</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.complete(((&quot;year&quot;, &quot;bill_length_mm&quot;), {&quot;species&quot;, &quot;island&quot;}))</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # filling missing values</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.complete((&quot;sex&quot;, {&quot;species&quot;, &quot;island&quot;}), fill = {&#39;bill_length_mm&#39;: 100})</span>
<span class="sd">        &gt;&gt;&gt; </span>
<span class="sd">        &gt;&gt;&gt; # grouped complete</span>
<span class="sd">        &gt;&gt;&gt; penguins_tidy.complete({&quot;species&quot;, &quot;island&quot;}, by = &#39;sex&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">by</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_complete</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">fill</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_by</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">by</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">_flatten_strings</span><span class="p">(</span><span class="n">spec</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>\
                <span class="s2">&quot;&#39;by&#39; columns should not be present in &#39;spec&#39;&quot;</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_modify</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">_complete</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span>
                                                          <span class="n">fill</span> <span class="o">=</span> <span class="n">fill</span>
                                                          <span class="p">),</span>
                                    <span class="n">by</span> <span class="o">=</span> <span class="n">by</span>
                                    <span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div></div>
</pre></div>

              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright MIT License.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>